-- Obfuscated with Simple Lua Obfuscator
local _lmTUVWXyzABCDnopqrstuvwxyzABCDEFGHIJKLMNOPQwxyzAByzABCDEFGHIJKLMNOPDEFGHIJKLMNOPQRSTUVWXYZ = (function()
    local b='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
    return function(data)
        data = string.gsub(data, '[^'%w+%=]', '')
        return (data:gsub('.', function(x)
            if (x == '=') then return '' end
            local r,f='',(b:find(x)-1)
            for i=6,1,-1 do r=r..(f%2^i-f%2^(i-1)>0 and '1' or '0') end
            return r;
        end):gsub('........', function(x)
            local c=0
            for i=1,8 do c=c+(x:sub(i,i)=='1' and 2^(8-i) or 0) end
            return string.char(c)
        end))
    end
end)()
local _bcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWcdefghijklmnbcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMstughijklmnopqrstu = "LS0gU0VSVklDRVMgWUFORyBESUJVVFVIS0FOCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBUd2VlblNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlR3ZWVuU2VydmljZSIpCmxvY2FsIFJ1blNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKQpsb2NhbCBVc2VySW5wdXRTZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJVc2VySW5wdXRTZXJ2aWNlIikKbG9jYWwgV29ya3NwYWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKQpsb2NhbCBDb3JlR3VpID0gZ2FtZTpHZXRTZXJ2aWNlKCJDb3JlR3VpIikKbG9jYWwgUmVwbGljYXRlZFN0b3JhZ2UgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikKbG9jYWwgcGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgoKLS0gTE9BRCBMSUJSQVJZCmxvY2FsIExpYnJhcnkgPSBsb2Fkc3RyaW5nKGdhbWU6SHR0cEdldCgiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0N5cnVzT2ZmYy9zY3JpcHRjeXJ1cy9yZWZzL2hlYWRzL21haW4vbGlicmFyeS9yZWR6djIubHVhIikpKCkKCi0tIENSRUFURSBNQUlOIFdJTkRPVwpsb2NhbCBXaW5kb3cgPSBMaWJyYXJ5OkNyZWF0ZVdpbmRvdyh7CiAgICBUaXRsZSA9ICJDeXJ1cyBIdWIgWCIsCiAgICBTdWJUaXRsZSA9ICJFc2NhcGUgVHN1bmFtaSBGb3IgQnJhaW5yb3QiLAogICAgU2l6ZSA9IFVEaW0yLm5ldygwLCA0NDAsIDAsIDI2NSksCiAgICBUYWJXaWR0aCA9IDE0MCwKICAgIFRoZW1lID0gIkN5cnVzSHViWCIsCiAgICBBY3J5bGljID0gZmFsc2UsCn0pCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi0tIFJFTU9WRSBWSVAgTU9ERUwgT05MWQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpsb2NhbCBmdW5jdGlvbiByZW1vdmVWSVBNb2RlbHMoKQogICAgZm9yIF8sIG9iaiBpbiBpcGFpcnMoV29ya3NwYWNlOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgaWYgb2JqOklzQSgiTW9kZWwiKSBhbmQgb2JqLk5hbWU6bG93ZXIoKTpmaW5kKCJ2aXAiKSB0aGVuCiAgICAgICAgICAgIG9iajpEZXN0cm95KCkKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmZ1bmN0aW9uIFdhbGxEZWxldGUoKQogICAgLS0gQ2FyaSBmb2xkZXIgV2FsbHMgZGkgcGF0aCB5YW5nIHNlc3VhaQogICAgbG9jYWwgZGVmYXVsdE1hcCA9IGdhbWUuV29ya3NwYWNlOkZpbmRGaXJzdENoaWxkKCJEZWZhdWx0TWFwIikKICAgIAogICAgaWYgZGVmYXVsdE1hcCB0aGVuCiAgICAgICAgbG9jYWwgd2FsbHNGb2xkZXIgPSBkZWZhdWx0TWFwOkZpbmRGaXJzdENoaWxkKCJXYWxscyIpCiAgICAgICAgCiAgICAgICAgaWYgd2FsbHNGb2xkZXIgdGhlbgogICAgICAgICAgICAtLSBIYXB1cyBmb2xkZXIgV2FsbHMgYmVzZXJ0YSBzZW11YSBpc2lueWEKICAgICAgICAgICAgd2FsbHNGb2xkZXI6RGVzdHJveSgpCiAgICAgICAgICAgIHByaW50KCLinIUgRm9sZGVyIFdhbGxzIGJlcmhhc2lsIGRpaGFwdXMhIikKICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICBlbHNlCiAgICAgICAgICAgIHdhcm4oIuKaoO+4jyBGb2xkZXIgV2FsbHMgdGlkYWsgZGl0ZW11a2FuIikKICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgd2Fybigi4pqg77iPIERlZmF1bHRNYXAgdGlkYWsgZGl0ZW11a2FuIikKICAgICAgICByZXR1cm4gZmFsc2UKICAgIGVuZAplbmQKCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi0tIEdPRCBNT0RFIFdBTEwgLSBPUFRJTUlaRUQgVkVSU0lPTgotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKLS0gU3RvcmFnZSB1bnR1ayBzZW11YSBwYXJ0cyB5YW5nIGRpYnVhdApsb2NhbCBnb2RNb2RlUGFydHMgPSB7CiAgICBuZW9uUGF0aHMgPSB7fSwKICAgIGJhcnJpZXJzID0ge30KfQoKbG9jYWwgZ29kTW9kZVdhbGxFbmFibGVkID0gZmFsc2UKCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi0tIENPTkZJR1VSQVRJT04gKG11ZGFoIGRpdWJhaCkKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KbG9jYWwgR29kTW9kZUNvbmZpZyA9IHsKICAgIC0tIE5lb24gUGF0aCBTZXR0aW5ncwogICAgcGF0aHMgPSB7CiAgICAgICAge3Bvc2l0aW9uID0gVmVjdG9yMy5uZXcoMjAwLCAtMi45NzUsIDEzMyksIHNpemUgPSBWZWN0b3IzLm5ldyg2LjA1LCAxNCwgMjA0Nyl9LAogICAgICAgIHtwb3NpdGlvbiA9IFZlY3RvcjMubmV3KDE5MDAsIC0yLjk3NSwgMTM1KSwgc2l6ZSA9IFZlY3RvcjMubmV3KDYuMDUsIDE0LCAyMDQ3KX0sCiAgICAgICAge3Bvc2l0aW9uID0gVmVjdG9yMy5uZXcoMzE0MS45LCAtMi45NzUsIDEzNSksIHNpemUgPSBWZWN0b3IzLm5ldyg2LjA1LCAxNCwgMjA0Nyl9CiAgICB9LAogICAgCiAgICAtLSBCYXJyaWVyIFNldHRpbmdzCiAgICBiYXJyaWVycyA9IHsKICAgICAgICB7cG9zaXRpb24gPSBWZWN0b3IzLm5ldygxMTg1LjUsIDQzLjU1LCAxMzgpLCBzaXplID0gVmVjdG9yMy5uZXcoMjA0NywgMTAwLCAyKX0sCiAgICAgICAge3Bvc2l0aW9uID0gVmVjdG9yMy5uZXcoMTkwMCwgLTIuOTc1LCAxMzgpLCBzaXplID0gVmVjdG9yMy5uZXcoMjA0NywgMTAwLCAyKX0sCiAgICAgICAge3Bvc2l0aW9uID0gVmVjdG9yMy5uZXcoMzE0MS45LCAtMi45NzUsIDEzOCksIHNpemUgPSBWZWN0b3IzLm5ldygyMDQ3LCAxMDAsIDIpfQogICAgfSwKICAgIAogICAgLS0gVmlzdWFsIFNldHRpbmdzCiAgICBwYXRoQ29sb3IgPSBDb2xvcjMuZnJvbVJHQigwLCAxNzAsIDI1NSksIC0tIEJpcnUKICAgIGJhcnJpZXJDb2xvciA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMCwgMCksIC0tIE1lcmFoCiAgICBwYXRoVHJhbnNwYXJlbmN5ID0gMC4yLAogICAgYmFycmllclRyYW5zcGFyZW5jeSA9IDAuMywKICAgIHJvdGF0aW9uID0gVmVjdG9yMy5uZXcoLTkwLCA5MCwgMCkKfQoKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLS0gSEVMUEVSOiBDUkVBVEUgUEFSVAotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpsb2NhbCBmdW5jdGlvbiBjcmVhdGVHb2RNb2RlUGFydChwYXJ0VHlwZSwgaW5kZXgsIGNvbmZpZykKICAgIGxvY2FsIHBhcnQgPSBJbnN0YW5jZS5uZXcoIlBhcnQiKQogICAgcGFydC5OYW1lID0gcGFydFR5cGUgLi4gaW5kZXgKICAgIHBhcnQuU2l6ZSA9IGNvbmZpZy5zaXplCiAgICBwYXJ0LlBvc2l0aW9uID0gY29uZmlnLnBvc2l0aW9uCiAgICBwYXJ0LlJvdGF0aW9uID0gR29kTW9kZUNvbmZpZy5yb3RhdGlvbgogICAgcGFydC5BbmNob3JlZCA9IHRydWUKICAgIHBhcnQuQ2FuQ29sbGlkZSA9IHRydWUKICAgIHBhcnQuTWF0ZXJpYWwgPSBFbnVtLk1hdGVyaWFsLk5lb24KICAgIAogICAgaWYgcGFydFR5cGU6ZmluZCgiUGF0aCIpIHRoZW4KICAgICAgICBwYXJ0LkNvbG9yID0gR29kTW9kZUNvbmZpZy5wYXRoQ29sb3IKICAgICAgICBwYXJ0LlRyYW5zcGFyZW5jeSA9IEdvZE1vZGVDb25maWcucGF0aFRyYW5zcGFyZW5jeQogICAgZWxzZQogICAgICAgIHBhcnQuQ29sb3IgPSBHb2RNb2RlQ29uZmlnLmJhcnJpZXJDb2xvcgogICAgICAgIHBhcnQuVHJhbnNwYXJlbmN5ID0gR29kTW9kZUNvbmZpZy5iYXJyaWVyVHJhbnNwYXJlbmN5CiAgICAgICAgcGFydC5Sb3RhdGlvbiA9IFZlY3RvcjMubmV3KDAsIDAsIDApIC0tIEJhcnJpZXJzIGRvbid0IHJvdGF0ZQogICAgZW5kCiAgICAKICAgIHBhcnQuUGFyZW50ID0gd29ya3NwYWNlCiAgICByZXR1cm4gcGFydAplbmQKCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi0tIEhFTFBFUjogUkVNT1ZFIE1BUCBXQUxMUwotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpsb2NhbCBmdW5jdGlvbiByZW1vdmVNYXBXYWxscygpCiAgICBsb2NhbCBtYXBzVG9DaGVjayA9IHsiRGVmYXVsdE1hcCIsICJWYWxlbnRpbmVzTWFwIn0KICAgIGxvY2FsIHJlbW92ZWQgPSBmYWxzZQogICAgCiAgICBmb3IgXywgbWFwTmFtZSBpbiBpcGFpcnMobWFwc1RvQ2hlY2spIGRvCiAgICAgICAgbG9jYWwgbWFwID0gd29ya3NwYWNlOkZpbmRGaXJzdENoaWxkKG1hcE5hbWUpCiAgICAgICAgaWYgbWFwIHRoZW4KICAgICAgICAgICAgbG9jYWwgcmlnaHRXYWxscyA9IG1hcDpGaW5kRmlyc3RDaGlsZCgiUmlnaHRXYWxscyIpCiAgICAgICAgICAgIGlmIHJpZ2h0V2FsbHMgdGhlbgogICAgICAgICAgICAgICAgcmlnaHRXYWxsczpEZXN0cm95KCkKICAgICAgICAgICAgICAgIHByaW50KCLinIUgUmlnaHRXYWxscyByZW1vdmVkIGZyb20iLCBtYXBOYW1lKQogICAgICAgICAgICAgICAgcmVtb3ZlZCA9IHRydWUKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgaWYgbm90IHJlbW92ZWQgdGhlbgogICAgICAgIHdhcm4oIuKaoO+4jyBObyBSaWdodFdhbGxzIGZvdW5kIGluIGFueSBtYXAiKQogICAgZW5kCiAgICAKICAgIHJldHVybiByZW1vdmVkCmVuZAoKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLS0gRU5BQkxFIEdPRCBNT0RFIFdBTEwKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KbG9jYWwgZnVuY3Rpb24gZW5hYmxlR29kTW9kZVdhbGwoKQogICAgaWYgZ29kTW9kZVdhbGxFbmFibGVkIHRoZW4KICAgICAgICBwcmludCgi4pqg77iPIEdvZCBNb2RlIFdhbGwgYWxyZWFkeSBlbmFibGVkIikKICAgICAgICByZXR1cm4gdHJ1ZQogICAgZW5kCiAgICAKICAgIHByaW50KCLwn5SEIEVuYWJsaW5nIEdvZCBNb2RlIFdhbGwuLi4iKQogICAgCiAgICAtLSBTdGVwIDE6IFJlbW92ZSBleGlzdGluZyBtYXAgd2FsbHMKICAgIHJlbW92ZU1hcFdhbGxzKCkKICAgIAogICAgLS0gU3RlcCAyOiBDcmVhdGUgTmVvbiBQYXRocwogICAgZm9yIGksIHBhdGhDb25maWcgaW4gaXBhaXJzKEdvZE1vZGVDb25maWcucGF0aHMpIGRvCiAgICAgICAgbG9jYWwgc3VjY2VzcywgcGFydCA9IHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZUdvZE1vZGVQYXJ0KCJHb2RNb2RlUGF0aCIsIGksIHBhdGhDb25maWcpCiAgICAgICAgZW5kKQogICAgICAgIAogICAgICAgIGlmIHN1Y2Nlc3MgYW5kIHBhcnQgdGhlbgogICAgICAgICAgICB0YWJsZS5pbnNlcnQoZ29kTW9kZVBhcnRzLm5lb25QYXRocywgcGFydCkKICAgICAgICAgICAgcHJpbnQoc3RyaW5nLmZvcm1hdCgi4pyFIE5lb24gUGF0aCAlZCBjcmVhdGVkIGF0ICVzIiwgaSwgdG9zdHJpbmcocGF0aENvbmZpZy5wb3NpdGlvbikpKQogICAgICAgIGVsc2UKICAgICAgICAgICAgd2FybihzdHJpbmcuZm9ybWF0KCLinYwgRmFpbGVkIHRvIGNyZWF0ZSBOZW9uIFBhdGggJWQiLCBpKSkKICAgICAgICBlbmQKICAgIGVuZAogICAgCiAgICAtLSBTdGVwIDM6IENyZWF0ZSBCYXJyaWVycwogICAgZm9yIGksIGJhcnJpZXJDb25maWcgaW4gaXBhaXJzKEdvZE1vZGVDb25maWcuYmFycmllcnMpIGRvCiAgICAgICAgbG9jYWwgc3VjY2VzcywgcGFydCA9IHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZUdvZE1vZGVQYXJ0KCJHb2RNb2RlQmFycmllciIsIGksIGJhcnJpZXJDb25maWcpCiAgICAgICAgZW5kKQogICAgICAgIAogICAgICAgIGlmIHN1Y2Nlc3MgYW5kIHBhcnQgdGhlbgogICAgICAgICAgICB0YWJsZS5pbnNlcnQoZ29kTW9kZVBhcnRzLmJhcnJpZXJzLCBwYXJ0KQogICAgICAgICAgICBwcmludChzdHJpbmcuZm9ybWF0KCLinIUgQmFycmllciAlZCBjcmVhdGVkIGF0ICVzIiwgaSwgdG9zdHJpbmcoYmFycmllckNvbmZpZy5wb3NpdGlvbikpKQogICAgICAgIGVsc2UKICAgICAgICAgICAgd2FybihzdHJpbmcuZm9ybWF0KCLinYwgRmFpbGVkIHRvIGNyZWF0ZSBCYXJyaWVyICVkIiwgaSkpCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgZ29kTW9kZVdhbGxFbmFibGVkID0gdHJ1ZQogICAgcHJpbnQoc3RyaW5nLmZvcm1hdCgi4pyFIEdvZCBNb2RlIFdhbGwgZW5hYmxlZCEgQ3JlYXRlZCAlZCBwYXRocyBhbmQgJWQgYmFycmllcnMiLCAKICAgICAgICAjZ29kTW9kZVBhcnRzLm5lb25QYXRocywgI2dvZE1vZGVQYXJ0cy5iYXJyaWVycykpCiAgICAKICAgIHJldHVybiB0cnVlCmVuZAoKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLS0gRElTQUJMRSBHT0QgTU9ERSBXQUxMCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmxvY2FsIGZ1bmN0aW9uIGRpc2FibGVHb2RNb2RlV2FsbCgpCiAgICBpZiBub3QgZ29kTW9kZVdhbGxFbmFibGVkIHRoZW4KICAgICAgICBwcmludCgi4pqg77iPIEdvZCBNb2RlIFdhbGwgYWxyZWFkeSBkaXNhYmxlZCIpCiAgICAgICAgcmV0dXJuIHRydWUKICAgIGVuZAogICAgCiAgICBwcmludCgi8J+UhCBEaXNhYmxpbmcgR29kIE1vZGUgV2FsbC4uLiIpCiAgICAKICAgIGxvY2FsIHRvdGFsUmVtb3ZlZCA9IDAKICAgIAogICAgLS0gUmVtb3ZlIGFsbCBuZW9uIHBhdGhzCiAgICBmb3IgaSA9ICNnb2RNb2RlUGFydHMubmVvblBhdGhzLCAxLCAtMSBkbwogICAgICAgIGxvY2FsIHBhcnQgPSBnb2RNb2RlUGFydHMubmVvblBhdGhzW2ldCiAgICAgICAgaWYgcGFydCBhbmQgcGFydC5QYXJlbnQgdGhlbgogICAgICAgICAgICBwYXJ0OkRlc3Ryb3koKQogICAgICAgICAgICB0b3RhbFJlbW92ZWQgPSB0b3RhbFJlbW92ZWQgKyAxCiAgICAgICAgZW5kCiAgICAgICAgdGFibGUucmVtb3ZlKGdvZE1vZGVQYXJ0cy5uZW9uUGF0aHMsIGkpCiAgICBlbmQKICAgIAogICAgLS0gUmVtb3ZlIGFsbCBiYXJyaWVycwogICAgZm9yIGkgPSAjZ29kTW9kZVBhcnRzLmJhcnJpZXJzLCAxLCAtMSBkbwogICAgICAgIGxvY2FsIHBhcnQgPSBnb2RNb2RlUGFydHMuYmFycmllcnNbaV0KICAgICAgICBpZiBwYXJ0IGFuZCBwYXJ0LlBhcmVudCB0aGVuCiAgICAgICAgICAgIHBhcnQ6RGVzdHJveSgpCiAgICAgICAgICAgIHRvdGFsUmVtb3ZlZCA9IHRvdGFsUmVtb3ZlZCArIDEKICAgICAgICBlbmQKICAgICAgICB0YWJsZS5yZW1vdmUoZ29kTW9kZVBhcnRzLmJhcnJpZXJzLCBpKQogICAgZW5kCiAgICAKICAgIGdvZE1vZGVXYWxsRW5hYmxlZCA9IGZhbHNlCiAgICBwcmludChzdHJpbmcuZm9ybWF0KCLinIUgR29kIE1vZGUgV2FsbCBkaXNhYmxlZCEgUmVtb3ZlZCAlZCBwYXJ0cyIsIHRvdGFsUmVtb3ZlZCkpCiAgICAKICAgIHJldHVybiB0cnVlCmVuZAoKLS0gPT09PT09PT09PT09PT09PT09PT0gQ09ORklHVVJBU0kgVElOR0dJID09PT09PT09PT09PT09PT09PT09CmxvY2FsIEdPRF9NT0RFX0hFQUxUSCA9IDk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTkKbG9jYWwgR09EX01PREVfTUFYX0hFQUxUSCA9IDk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5CgotLSA9PT09PT09PT09PT09PT09PT09PSBWQVJJQUJFTCBHTE9CQUwgPT09PT09PT09PT09PT09PT09PQpsb2NhbCBnb2RNb2RlRW5hYmxlZCA9IGZhbHNlCmxvY2FsIHByb3RlY3Rpb25Db25uZWN0aW9ucyA9IHt9CgotLSA9PT09PT09PT09PT09PT09PT09PSBMQVlFUiAxOiBCQVNJQyBHT0QgTU9ERSA9PT09PT09PT09PT09PT09PT09PQpsb2NhbCBmdW5jdGlvbiBhcHBseUJhc2ljR29kTW9kZShjaGFyYWN0ZXIpCiAgICBpZiBub3QgY2hhcmFjdGVyIHRoZW4gcmV0dXJuIGVuZAogICAgCiAgICBsb2NhbCBodW1hbm9pZCA9IGNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkIiwgNSkKICAgIGlmIG5vdCBodW1hbm9pZCB0aGVuIHJldHVybiBlbmQKICAgIAogICAgLS0gU2V0IGhlYWx0aCBrZSBuaWxhaSBzYW5nYXQgdGluZ2dpCiAgICBodW1hbm9pZC5NYXhIZWFsdGggPSBHT0RfTU9ERV9NQVhfSEVBTFRICiAgICBodW1hbm9pZC5IZWFsdGggPSBHT0RfTU9ERV9IRUFMVEgKICAgIAogICAgLS0gTm9uYWt0aWZrYW4gbWVrYW5pc21lIGtlbWF0aWFuCiAgICBodW1hbm9pZC5CcmVha0pvaW50c09uRGVhdGggPSBmYWxzZQogICAgaHVtYW5vaWQuUmVxdWlyZXNOZWNrID0gZmFsc2UKICAgIAogICAgLS0gVGFtYmFoIHJlZ2VuIHJhdGUgbWFrc2ltYWwKICAgIGlmIGh1bWFub2lkOkZpbmRGaXJzdENoaWxkKCJIZWFsdGhSZXBsaWNhdGlvbiIpIHRoZW4KICAgICAgICBodW1hbm9pZC5IZWFsdGhSZXBsaWNhdGlvbi5IZWFsdGhSZXAgPSBHT0RfTU9ERV9IRUFMVEgKICAgIGVuZAplbmQKCi0tID09PT09PT09PT09PT09PT09PT09IExBWUVSIDI6IERBTUFHRSBJTlRFUkNFUFRJT04gPT09PT09PT09PT09PT09PT09PT0KbG9jYWwgZnVuY3Rpb24gc2V0dXBEYW1hZ2VJbnRlcmNlcHRpb24oY2hhcmFjdGVyKQogICAgLS0gSW50ZXJjZXB0IHNlbXVhIGRhbWFnZQogICAgaWYgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIHRoZW4KICAgICAgICBsb2NhbCBodW1hbm9pZCA9IGNoYXJhY3Rlci5IdW1hbm9pZAogICAgICAgIAogICAgICAgIC0tIE1ldGhvZCAxOiBUYWtlRGFtYWdlIGhvb2sKICAgICAgICBpZiBub3QgcHJvdGVjdGlvbkNvbm5lY3Rpb25zWyJUYWtlRGFtYWdlIl0gdGhlbgogICAgICAgICAgICBsb2NhbCBvbGRUYWtlRGFtYWdlCiAgICAgICAgICAgIG9sZFRha2VEYW1hZ2UgPSBob29rZnVuY3Rpb24oaHVtYW5vaWQuVGFrZURhbWFnZSwgZnVuY3Rpb24oc2VsZiwgZGFtYWdlKQogICAgICAgICAgICAgICAgaWYgZ29kTW9kZUVuYWJsZWQgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybiAwICAtLSBSZXR1cm4gMCBkYW1hZ2UKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgcmV0dXJuIG9sZFRha2VEYW1hZ2Uoc2VsZiwgZGFtYWdlKQogICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIHByb3RlY3Rpb25Db25uZWN0aW9uc1siVGFrZURhbWFnZSJdID0gdHJ1ZQogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIC0tIE1ldGhvZCAyOiBIZWFsdGggY2hhbmdlZCBldmVudAogICAgICAgIGlmIG5vdCBwcm90ZWN0aW9uQ29ubmVjdGlvbnNbIkhlYWx0aENoYW5nZWQiXSB0aGVuCiAgICAgICAgICAgIHByb3RlY3Rpb25Db25uZWN0aW9uc1siSGVhbHRoQ2hhbmdlZCJdID0gaHVtYW5vaWQuSGVhbHRoQ2hhbmdlZDpDb25uZWN0KGZ1bmN0aW9uKG5ld0hlYWx0aCkKICAgICAgICAgICAgICAgIGlmIGdvZE1vZGVFbmFibGVkIGFuZCBuZXdIZWFsdGggPCBHT0RfTU9ERV9IRUFMVEggdGhlbgogICAgICAgICAgICAgICAgICAgIGh1bWFub2lkLkhlYWx0aCA9IEdPRF9NT0RFX0hFQUxUSAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAtLSBNZXRob2QgMzogRGllZCBldmVudAogICAgICAgIGlmIG5vdCBwcm90ZWN0aW9uQ29ubmVjdGlvbnNbIkRpZWQiXSB0aGVuCiAgICAgICAgICAgIHByb3RlY3Rpb25Db25uZWN0aW9uc1siRGllZCJdID0gaHVtYW5vaWQuRGllZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGlmIGdvZE1vZGVFbmFibGVkIHRoZW4KICAgICAgICAgICAgICAgICAgICAtLSBJbnN0YW50IHJlc3Bhd24KICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgIGlmIGNoYXJhY3Rlci5QYXJlbnQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBodW1hbm9pZC5IZWFsdGggPSBHT0RfTU9ERV9IRUFMVEgKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgotLSA9PT09PT09PT09PT09PT09PT09PSBMQVlFUiAzOiBBTlRJLVJBR0RPTEwgJiBTVEFURVMgPT09PT09PT09PT09PT09PT09PT0KbG9jYWwgZnVuY3Rpb24gZGlzYWJsZURlYXRoU3RhdGVzKGNoYXJhY3RlcikKICAgIGxvY2FsIGh1bWFub2lkID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpCiAgICBpZiBub3QgaHVtYW5vaWQgdGhlbiByZXR1cm4gZW5kCiAgICAKICAgIC0tIE5vbmFrdGlma2FuIHNlbXVhIHN0YXRlIHlhbmcgYmVyaHVidW5nYW4gZGVuZ2FuIGtlbWF0aWFuCiAgICBmb3IgXywgc3RhdGUgaW4gaXBhaXJzKHsKICAgICAgICBFbnVtLkh1bWFub2lkU3RhdGVUeXBlLkRlYWQsCiAgICAgICAgRW51bS5IdW1hbm9pZFN0YXRlVHlwZS5GYWxsaW5nRG93biwKICAgICAgICBFbnVtLkh1bWFub2lkU3RhdGVUeXBlLlJhZ2RvbGwsCiAgICAgICAgRW51bS5IdW1hbm9pZFN0YXRlVHlwZS5QaHlzaWNzCiAgICB9KSBkbwogICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgaHVtYW5vaWQ6U2V0U3RhdGVFbmFibGVkKHN0YXRlLCBmYWxzZSkKICAgICAgICBlbmQpCiAgICBlbmQKICAgIAogICAgLS0gRm9yY2Ugc3RhdGUga2Ugbm9ybWFsCiAgICBodW1hbm9pZDpDaGFuZ2VTdGF0ZShFbnVtLkh1bWFub2lkU3RhdGVUeXBlLlJ1bm5pbmcpCmVuZAoKLS0gPT09PT09PT09PT09PT09PT09PT0gTEFZRVIgNDogRk9SQ0UgRklFTEQgUEVSTUFORU4gPT09PT09PT09PT09PT09PT09PT0KbG9jYWwgZnVuY3Rpb24gYXBwbHlGb3JjZUZpZWxkKGNoYXJhY3RlcikKICAgIC0tIEhhcHVzIGZvcmNlIGZpZWxkIGxhbWEKICAgIGZvciBfLCBjaGlsZCBpbiBpcGFpcnMoY2hhcmFjdGVyOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgY2hpbGQ6SXNBKCJGb3JjZUZpZWxkIikgdGhlbgogICAgICAgICAgICBjaGlsZDpEZXN0cm95KCkKICAgICAgICBlbmQKICAgIGVuZAogICAgCiAgICAtLSBCdWF0IGZvcmNlIGZpZWxkIGJhcnUKICAgIGxvY2FsIGZvcmNlRmllbGQgPSBJbnN0YW5jZS5uZXcoIkZvcmNlRmllbGQiKQogICAgZm9yY2VGaWVsZC5WaXNpYmxlID0gdHJ1ZQogICAgZm9yY2VGaWVsZC5QYXJlbnQgPSBjaGFyYWN0ZXIKICAgIAogICAgLS0gQ3VzdG9tIGZvcmNlIGZpZWxkIGFnYXIgbGViaWgga3VhdAogICAgbG9jYWwgYXR0YWNobWVudCA9IEluc3RhbmNlLm5ldygiQXR0YWNobWVudCIpCiAgICBhdHRhY2htZW50LlBhcmVudCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIG9yIGNoYXJhY3Rlci5QcmltYXJ5UGFydAogICAgCiAgICBsb2NhbCBwYXJ0aWNsZSA9IEluc3RhbmNlLm5ldygiUGFydGljbGVFbWl0dGVyIikKICAgIHBhcnRpY2xlLlBhcmVudCA9IGF0dGFjaG1lbnQKICAgIHBhcnRpY2xlLlRleHR1cmUgPSAicmJ4YXNzZXRpZDovLzI0Mjg0MjY2OCIgIC0tIFNoaWVsZCB0ZXh0dXJlCiAgICBwYXJ0aWNsZS5SYXRlID0gNTAKICAgIHBhcnRpY2xlLkxpZmV0aW1lID0gTnVtYmVyUmFuZ2UubmV3KDEpCiAgICBwYXJ0aWNsZS5TaXplID0gTnVtYmVyU2VxdWVuY2UubmV3KHtOdW1iZXJTZXF1ZW5jZUtleXBvaW50Lm5ldygwLCAyKSwgTnVtYmVyU2VxdWVuY2VLZXlwb2ludC5uZXcoMSwgMCl9KQogICAgcGFydGljbGUuVHJhbnNwYXJlbmN5ID0gTnVtYmVyU2VxdWVuY2UubmV3KHtOdW1iZXJTZXF1ZW5jZUtleXBvaW50Lm5ldygwLCAwLjUpLCBOdW1iZXJTZXF1ZW5jZUtleXBvaW50Lm5ldygxLCAxKX0pCiAgICBwYXJ0aWNsZS5Db2xvciA9IENvbG9yU2VxdWVuY2UubmV3KENvbG9yMy5mcm9tUkdCKDAsIDI1NSwgMjU1KSkKICAgIAogICAgcHJvdGVjdGlvbkNvbm5lY3Rpb25zWyJGb3JjZUZpZWxkIl0gPSBmb3JjZUZpZWxkCmVuZAoKLS0gPT09PT09PT09PT09PT09PT09PT0gTEFZRVIgNTogTE9PUCBQUk9URUNUSU9OID09PT09PT09PT09PT09PT09PT09CmxvY2FsIGZ1bmN0aW9uIHN0YXJ0UHJvdGVjdGlvbkxvb3AoKQogICAgaWYgcHJvdGVjdGlvbkNvbm5lY3Rpb25zWyJMb29wIl0gdGhlbgogICAgICAgIHByb3RlY3Rpb25Db25uZWN0aW9uc1siTG9vcCJdOkRpc2Nvbm5lY3QoKQogICAgZW5kCiAgICAKICAgIHByb3RlY3Rpb25Db25uZWN0aW9uc1siTG9vcCJdID0gUnVuU2VydmljZS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgaWYgbm90IGdvZE1vZGVFbmFibGVkIHRoZW4gcmV0dXJuIGVuZAogICAgICAgIAogICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXIKICAgICAgICBpZiBub3QgY2hhcmFjdGVyIHRoZW4gcmV0dXJuIGVuZAogICAgICAgIAogICAgICAgIGxvY2FsIGh1bWFub2lkID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpCiAgICAgICAgaWYgbm90IGh1bWFub2lkIHRoZW4gcmV0dXJuIGVuZAogICAgICAgIAogICAgICAgIC0tIENvbnN0YW50bHkgbWFpbnRhaW4gZ29kIG1vZGUgcHJvcGVydGllcwogICAgICAgIGh1bWFub2lkLk1heEhlYWx0aCA9IEdPRF9NT0RFX01BWF9IRUFMVEgKICAgICAgICBodW1hbm9pZC5IZWFsdGggPSBHT0RfTU9ERV9IRUFMVEgKICAgICAgICAKICAgICAgICAtLSBBbnRpLXN0dW4va25vY2tiYWNrCiAgICAgICAgaHVtYW5vaWQuQXV0b1JvdGF0ZSA9IHRydWUKICAgICAgICBodW1hbm9pZC5BdXRvSnVtcEVuYWJsZWQgPSB0cnVlCiAgICAgICAgCiAgICAgICAgLS0gRW5zdXJlIHdlJ3JlIG5vdCBpbiBkZWF0aCBzdGF0ZQogICAgICAgIGlmIGh1bWFub2lkOkdldFN0YXRlKCkgPT0gRW51bS5IdW1hbm9pZFN0YXRlVHlwZS5EZWFkIHRoZW4KICAgICAgICAgICAgaHVtYW5vaWQ6Q2hhbmdlU3RhdGUoRW51bS5IdW1hbm9pZFN0YXRlVHlwZS5SdW5uaW5nKQogICAgICAgIGVuZAogICAgZW5kKQplbmQKCi0tID09PT09PT09PT09PT09PT09PT09IE1BSU4gRU5BQkxFIEZVTkNUSU9OID09PT09PT09PT09PT09PT09PT09CmxvY2FsIGZ1bmN0aW9uIGVuYWJsZUZ1bGxHb2RNb2RlKCkKICAgIGxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXIgb3IgcGxheWVyLkNoYXJhY3RlckFkZGVkOldhaXQoKQogICAgCiAgICAtLSBBcHBseSBzZW11YSBsYXllciBwcm90ZWN0aW9uCiAgICBhcHBseUJhc2ljR29kTW9kZShjaGFyYWN0ZXIpCiAgICBzZXR1cERhbWFnZUludGVyY2VwdGlvbihjaGFyYWN0ZXIpCiAgICBkaXNhYmxlRGVhdGhTdGF0ZXMoY2hhcmFjdGVyKQogICAgYXBwbHlGb3JjZUZpZWxkKGNoYXJhY3RlcikKICAgIHN0YXJ0UHJvdGVjdGlvbkxvb3AoKQogICAgCiAgICAtLSBBdXRvLXJlYXBwbHkga2V0aWthIGthcmFrdGVyIGJlcnViYWgKICAgIGlmIG5vdCBwcm90ZWN0aW9uQ29ubmVjdGlvbnNbIkNoYXJhY3RlckFkZGVkIl0gdGhlbgogICAgICAgIHByb3RlY3Rpb25Db25uZWN0aW9uc1siQ2hhcmFjdGVyQWRkZWQiXSA9IHBsYXllci5DaGFyYWN0ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKG5ld0NoYXIpCiAgICAgICAgICAgIGlmIGdvZE1vZGVFbmFibGVkIHRoZW4KICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjUpCiAgICAgICAgICAgICAgICBlbmFibGVGdWxsR29kTW9kZSgpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQKCi0tID09PT09PT09PT09PT09PT09PT09IERJU0FCTEUgRlVOQ1RJT04gPT09PT09PT09PT09PT09PT09PT0KbG9jYWwgZnVuY3Rpb24gZGlzYWJsZUZ1bGxHb2RNb2RlKCkKICAgIC0tIFB1dHVza2FuIHNlbXVhIGtvbmVrc2kKICAgIGZvciBuYW1lLCBjb25uZWN0aW9uIGluIHBhaXJzKHByb3RlY3Rpb25Db25uZWN0aW9ucykgZG8KICAgICAgICBpZiB0eXBlb2YoY29ubmVjdGlvbikgPT0gIlJCWFNjcmlwdENvbm5lY3Rpb24iIHRoZW4KICAgICAgICAgICAgY29ubmVjdGlvbjpEaXNjb25uZWN0KCkKICAgICAgICBlbmQKICAgIGVuZAogICAgCiAgICBwcm90ZWN0aW9uQ29ubmVjdGlvbnMgPSB7fQogICAgCiAgICAtLSBLZW1iYWxpa2FuIGthcmFrdGVyIGtlIG5vcm1hbAogICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlcgogICAgaWYgY2hhcmFjdGVyIHRoZW4KICAgICAgICBsb2NhbCBodW1hbm9pZCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKQogICAgICAgIGlmIGh1bWFub2lkIHRoZW4KICAgICAgICAgICAgaHVtYW5vaWQuTWF4SGVhbHRoID0gMTAwCiAgICAgICAgICAgIGh1bWFub2lkLkhlYWx0aCA9IDEwMAogICAgICAgICAgICAKICAgICAgICAgICAgLS0gQWt0aWZrYW4ga2VtYmFsaSBzdGF0ZQogICAgICAgICAgICBmb3IgXywgc3RhdGUgaW4gaXBhaXJzKHsKICAgICAgICAgICAgICAgIEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuRGVhZCwKICAgICAgICAgICAgICAgIEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuRmFsbGluZ0Rvd24sCiAgICAgICAgICAgICAgICBFbnVtLkh1bWFub2lkU3RhdGVUeXBlLlJhZ2RvbGwsCiAgICAgICAgICAgICAgICBFbnVtLkh1bWFub2lkU3RhdGVUeXBlLlBoeXNpY3MKICAgICAgICAgICAgfSkgZG8KICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBodW1hbm9pZDpTZXRTdGF0ZUVuYWJsZWQoc3RhdGUsIHRydWUpCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgLS0gSGFwdXMgZm9yY2UgZmllbGQKICAgICAgICAgICAgZm9yIF8sIGNoaWxkIGluIGlwYWlycyhjaGFyYWN0ZXI6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgIGlmIGNoaWxkOklzQSgiRm9yY2VGaWVsZCIpIG9yIGNoaWxkOklzQSgiUGFydGljbGVFbWl0dGVyIikgdGhlbgogICAgICAgICAgICAgICAgICAgIGNoaWxkOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKbG9jYWwgWm9vbVVubG9ja2VkID0gZmFsc2UKbG9jYWwgRGVmYXVsdE1pblpvb20gPSBwbGF5ZXIuQ2FtZXJhTWluWm9vbURpc3RhbmNlCmxvY2FsIERlZmF1bHRNYXhab29tID0gcGxheWVyLkNhbWVyYU1heFpvb21EaXN0YW5jZQoKbG9jYWwgZnVuY3Rpb24gVW5sb2NrWm9vbSgpCiAgICBab29tVW5sb2NrZWQgPSB0cnVlCiAgICBwbGF5ZXIuQ2FtZXJhTWluWm9vbURpc3RhbmNlID0gMC41CiAgICBwbGF5ZXIuQ2FtZXJhTWF4Wm9vbURpc3RhbmNlID0gMTAwMDAwCmVuZAoKbG9jYWwgZnVuY3Rpb24gTG9ja1pvb20oKQogICAgWm9vbVVubG9ja2VkID0gZmFsc2UKICAgIHBsYXllci5DYW1lcmFNaW5ab29tRGlzdGFuY2UgPSBEZWZhdWx0TWluWm9vbQogICAgcGxheWVyLkNhbWVyYU1heFpvb21EaXN0YW5jZSA9IERlZmF1bHRNYXhab29tCmVuZAoKbG9jYWwgaW5zdGFudFByb21wdEVuYWJsZWQgPSBmYWxzZQpsb2NhbCBvcmlnaW5hbEhvbGREdXJhdGlvbnMgPSB7fQpsb2NhbCBwcm9tcHRDb25uZWN0aW9uID0gbmlsCgotLSBGdW5nc2kgdW50dWsgbWVuZ2FrdGlma2FuIEluc3RhbnQgUHJveGltaXR5UHJvbXB0CmxvY2FsIGZ1bmN0aW9uIGVuYWJsZUluc3RhbnRQcm94aW1pdHlQcm9tcHQoKQogICAgLS0gU2ltcGFuIGhvbGQgZHVyYXRpb24gb3JpZ2luYWwgdW50dWsgc2VtdWEgcHJvbXB0CiAgICBvcmlnaW5hbEhvbGREdXJhdGlvbnMgPSB7fQogICAgCiAgICAtLSBUZXJhcGthbiBrZSBzZW11YSBwcm9tcHQgeWFuZyBhZGEKICAgIGZvciBfLCB2IGluIGlwYWlycyhXb3Jrc3BhY2U6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICBpZiB2OklzQSgiUHJveGltaXR5UHJvbXB0IikgdGhlbgogICAgICAgICAgICBvcmlnaW5hbEhvbGREdXJhdGlvbnNbdl0gPSB2LkhvbGREdXJhdGlvbgogICAgICAgICAgICB2LkhvbGREdXJhdGlvbiA9IDAKICAgICAgICBlbmQKICAgIGVuZAogICAgCiAgICAtLSBLb25la3NpIHVudHVrIHByb21wdCB5YW5nIGJhcnUgZGl0YW1iYWhrYW4KICAgIHByb21wdENvbm5lY3Rpb24gPSBXb3Jrc3BhY2UuRGVzY2VuZGFudEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24odikKICAgICAgICBpZiB2OklzQSgiUHJveGltaXR5UHJvbXB0IikgdGhlbgogICAgICAgICAgICBvcmlnaW5hbEhvbGREdXJhdGlvbnNbdl0gPSB2LkhvbGREdXJhdGlvbgogICAgICAgICAgICB2LkhvbGREdXJhdGlvbiA9IDAKICAgICAgICBlbmQKICAgIGVuZCkKZW5kCgotLSBGdW5nc2kgdW50dWsgbWVub25ha3RpZmthbiBJbnN0YW50IFByb3hpbWl0eVByb21wdApsb2NhbCBmdW5jdGlvbiBkaXNhYmxlSW5zdGFudFByb3hpbWl0eVByb21wdCgpCiAgICBpZiBwcm9tcHRDb25uZWN0aW9uIHRoZW4KICAgICAgICBwcm9tcHRDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgIHByb21wdENvbm5lY3Rpb24gPSBuaWwKICAgIGVuZAogICAgCiAgICAtLSBLZW1iYWxpa2FuIGhvbGQgZHVyYXRpb24ga2Ugc2VtdWxhCiAgICBmb3IgcHJvbXB0LCBvcmlnaW5hbER1cmF0aW9uIGluIHBhaXJzKG9yaWdpbmFsSG9sZER1cmF0aW9ucykgZG8KICAgICAgICBpZiBwcm9tcHQgYW5kIHByb21wdC5QYXJlbnQgdGhlbgogICAgICAgICAgICBwcm9tcHQuSG9sZER1cmF0aW9uID0gb3JpZ2luYWxEdXJhdGlvbgogICAgICAgIGVuZAogICAgZW5kCiAgICAKICAgIG9yaWdpbmFsSG9sZER1cmF0aW9ucyA9IHt9CmVuZAoKLS0gbWFnbmV0CmxvY2FsIG1vdXNlID0gcGxheWVyOkdldE1vdXNlKCkKbG9jYWwgbWFnbmV0RW5hYmxlZCA9IGZhbHNlCi0tIERyb3Bkb3duIHVudHVrIGZpbHRlciByYXJpdHkKbG9jYWwgc2VsZWN0ZWRSYXJpdGllcyA9IHsKICAgIENvbW1vbiA9IHRydWUsIFVuY29tbW9uID0gdHJ1ZSwgUmFyZSA9IHRydWUsCiAgICBFcGljID0gdHJ1ZSwgTGVnZW5kID0gdHJ1ZSwgTXl0aGljID0gdHJ1ZSwKICAgIENvc21pYyA9IHRydWUsIFNlY3JldCA9IHRydWUsIENlbGVzdGlhbCA9IHRydWUsIERpdmluZSA9IHRydWUsIEluZmluaXR5ID0gdHJ1ZQp9CmxvY2FsIHJhZGl1cyA9IDMwIC0tIFJhZGl1cyBkYWxhbSBzdHVkCmxvY2FsIGNvbm5lY3Rpb24KbG9jYWwgdmlzdWFsQ2lyY2xlCmxvY2FsIGFjdGl2ZVByb21wdHMgPSB7fQpsb2NhbCByYXJpdHlDb2xvcnMgPSB7CiAgICBDb21tb24gPSBDb2xvcjMuZnJvbVJHQigxODAsIDE4MCwgMTgwKSwKICAgIFVuY29tbW9uID0gQ29sb3IzLmZyb21SR0IoMTAwLCAyMDAsIDEwMCksCiAgICBSYXJlID0gQ29sb3IzLmZyb21SR0IoMTAwLCAxNTAsIDI1NSksCiAgICBFcGljID0gQ29sb3IzLmZyb21SR0IoMTgwLCA4MCwgMjIwKSwKICAgIExlZ2VuZCA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMTgwLCA2MCksCiAgICBNeXRoaWMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDEwMCwgMTAwKSwKICAgIENvc21pYyA9IENvbG9yMy5mcm9tUkdCKDAsIDIwMCwgMjU1KSwKICAgIFNlY3JldCA9IENvbG9yMy5mcm9tUkdCKDI1NSwgNTAsIDE1MCksCiAgICBDZWxlc3RpYWwgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMTAwKQp9CgotLSBGdW5nc2kgdW50dWsgbWVuZGFwYXRrYW4gcmFyaXR5IGRhcmkgbW9kZWwKbG9jYWwgZnVuY3Rpb24gZ2V0TW9kZWxSYXJpdHkobW9kZWwpCiAgICAtLSBDZWsgYmVyZGFzYXJrYW4gZm9sZGVyIHBhcmVudAogICAgbG9jYWwgcGFyZW50ID0gbW9kZWwuUGFyZW50CiAgICB3aGlsZSBwYXJlbnQgZG8KICAgICAgICBmb3IgcmFyaXR5TmFtZSwgXyBpbiBwYWlycyhyYXJpdHlDb2xvcnMpIGRvCiAgICAgICAgICAgIGlmIHBhcmVudC5OYW1lOmxvd2VyKCkgPT0gcmFyaXR5TmFtZTpsb3dlcigpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiByYXJpdHlOYW1lCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIHBhcmVudCA9IHBhcmVudC5QYXJlbnQKICAgIGVuZAogICAgCiAgICAtLSBDZWsgYmVyZGFzYXJrYW4gbmFtYSBtb2RlbAogICAgbG9jYWwgbW9kZWxOYW1lID0gbW9kZWwuTmFtZTpsb3dlcigpCiAgICBmb3IgcmFyaXR5TmFtZSwgXyBpbiBwYWlycyhyYXJpdHlDb2xvcnMpIGRvCiAgICAgICAgaWYgbW9kZWxOYW1lOmZpbmQocmFyaXR5TmFtZTpsb3dlcigpKSB0aGVuCiAgICAgICAgICAgIHJldHVybiByYXJpdHlOYW1lCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgcmV0dXJuICJDb21tb24iIC0tIERlZmF1bHQKZW5kCgotLSBGdW5nc2kgdW50dWsgbWVtYnVhdCB2aXN1YWwgY2lyY2xlCmxvY2FsIGZ1bmN0aW9uIGNyZWF0ZVZpc3VhbENpcmNsZSgpCiAgICBpZiB2aXN1YWxDaXJjbGUgdGhlbgogICAgICAgIHZpc3VhbENpcmNsZTpEZXN0cm95KCkKICAgIGVuZAogICAgCiAgICB2aXN1YWxDaXJjbGUgPSBJbnN0YW5jZS5uZXcoIlBhcnQiKQogICAgdmlzdWFsQ2lyY2xlLk5hbWUgPSAiTWFnbmV0UmFkaXVzVmlzdWFsIgogICAgdmlzdWFsQ2lyY2xlLlNoYXBlID0gRW51bS5QYXJ0VHlwZS5DeWxpbmRlcgogICAgdmlzdWFsQ2lyY2xlLlNpemUgPSBWZWN0b3IzLm5ldygwLjIsIHJhZGl1cyAqIDIsIHJhZGl1cyAqIDIpCiAgICB2aXN1YWxDaXJjbGUuVHJhbnNwYXJlbmN5ID0gMQogICAgdmlzdWFsQ2lyY2xlLkNvbG9yID0gQ29sb3IzLmZyb21SR0IoMCwgMjAwLCAyNTUpCiAgICB2aXN1YWxDaXJjbGUuTWF0ZXJpYWwgPSBFbnVtLk1hdGVyaWFsLk5lb24KICAgIHZpc3VhbENpcmNsZS5DYW5Db2xsaWRlID0gZmFsc2UKICAgIHZpc3VhbENpcmNsZS5BbmNob3JlZCA9IHRydWUKICAgIHZpc3VhbENpcmNsZS5DYXN0U2hhZG93ID0gZmFsc2UKICAgIHZpc3VhbENpcmNsZS5DYW5RdWVyeSA9IGZhbHNlCiAgICAKICAgIGxvY2FsIGhpZ2hsaWdodCA9IEluc3RhbmNlLm5ldygiU2VsZWN0aW9uQm94IikKICAgIGhpZ2hsaWdodC5OYW1lID0gIlJhZGl1c0hpZ2hsaWdodCIKICAgIGhpZ2hsaWdodC5BZG9ybmVlID0gdmlzdWFsQ2lyY2xlCiAgICBoaWdobGlnaHQuQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMTUwLCAyNTUpCiAgICBoaWdobGlnaHQuTGluZVRoaWNrbmVzcyA9IDAuMDUKICAgIGhpZ2hsaWdodC5UcmFuc3BhcmVuY3kgPSAxCiAgICBoaWdobGlnaHQuUGFyZW50ID0gdmlzdWFsQ2lyY2xlCiAgICAKICAgIHJldHVybiB2aXN1YWxDaXJjbGUKZW5kCgotLSBGdW5nc2kgdW50dWsgbWVtYnVhdCBVSSBpbmRpY2F0b3IKbG9jYWwgZnVuY3Rpb24gY3JlYXRlUHJvbXB0VUkocHJvbXB0LCByYXJpdHkpCiAgICBsb2NhbCBjb2xvciA9IHJhcml0eUNvbG9yc1tyYXJpdHldIG9yIHJhcml0eUNvbG9ycy5Db21tb24KICAgIAogICAgLS0gQ3JlYXRlIGJpbGxib2FyZCBVSQogICAgbG9jYWwgYmlsbGJvYXJkID0gSW5zdGFuY2UubmV3KCJCaWxsYm9hcmRHdWkiKQogICAgYmlsbGJvYXJkLk5hbWUgPSAiTWFnbmV0UHJvbXB0VUkiCiAgICBiaWxsYm9hcmQuU2l6ZSA9IFVEaW0yLm5ldyg0LCAwLCA0LCAwKQogICAgYmlsbGJvYXJkLlN0dWRzT2Zmc2V0ID0gVmVjdG9yMy5uZXcoMCwgMywgMCkKICAgIGJpbGxib2FyZC5BbHdheXNPblRvcCA9IHRydWUKICAgIGJpbGxib2FyZC5NYXhEaXN0YW5jZSA9IDEwMAogICAgYmlsbGJvYXJkLkFkb3JuZWUgPSBwcm9tcHQuUGFyZW50CiAgICAKICAgIC0tIEJhY2tncm91bmQgZnJhbWUKICAgIGxvY2FsIGZyYW1lID0gSW5zdGFuY2UubmV3KCJGcmFtZSIpCiAgICBmcmFtZS5TaXplID0gVURpbTIubmV3KDEsIDAsIDEsIDApCiAgICBmcmFtZS5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjAsIDIwLCAyMCkKICAgIGZyYW1lLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLjMKICAgIGZyYW1lLkJvcmRlclNpemVQaXhlbCA9IDAKICAgIGZyYW1lLlBhcmVudCA9IGJpbGxib2FyZAogICAgCiAgICBsb2NhbCBjb3JuZXIgPSBJbnN0YW5jZS5uZXcoIlVJQ29ybmVyIikKICAgIGNvcm5lci5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygwLjIsIDApCiAgICBjb3JuZXIuUGFyZW50ID0gZnJhbWUKICAgIAogICAgLS0gUmFyaXR5IGxhYmVsCiAgICBsb2NhbCByYXJpdHlMYWJlbCA9IEluc3RhbmNlLm5ldygiVGV4dExhYmVsIikKICAgIHJhcml0eUxhYmVsLk5hbWUgPSAiUmFyaXR5TGFiZWwiCiAgICByYXJpdHlMYWJlbC5TaXplID0gVURpbTIubmV3KDAuOSwgMCwgMC40LCAwKQogICAgcmFyaXR5TGFiZWwuUG9zaXRpb24gPSBVRGltMi5uZXcoMC4wNSwgMCwgMC4xLCAwKQogICAgcmFyaXR5TGFiZWwuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgIHJhcml0eUxhYmVsLlRleHQgPSByYXJpdHkKICAgIHJhcml0eUxhYmVsLlRleHRDb2xvcjMgPSBjb2xvcgogICAgcmFyaXR5TGFiZWwuVGV4dFNjYWxlZCA9IHRydWUKICAgIHJhcml0eUxhYmVsLkZvbnQgPSBFbnVtLkZvbnQuR290aGFtQm9sZAogICAgcmFyaXR5TGFiZWwuUGFyZW50ID0gZnJhbWUKICAgIAogICAgLS0gQWN0aW9uIGxhYmVsCiAgICBsb2NhbCBhY3Rpb25MYWJlbCA9IEluc3RhbmNlLm5ldygiVGV4dExhYmVsIikKICAgIGFjdGlvbkxhYmVsLk5hbWUgPSAiQWN0aW9uTGFiZWwiCiAgICBhY3Rpb25MYWJlbC5TaXplID0gVURpbTIubmV3KDAuOSwgMCwgMC40LCAwKQogICAgYWN0aW9uTGFiZWwuUG9zaXRpb24gPSBVRGltMi5uZXcoMC4wNSwgMCwgMC41LCAwKQogICAgYWN0aW9uTGFiZWwuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgIGFjdGlvbkxhYmVsLlRleHQgPSBwcm9tcHQuQWN0aW9uVGV4dCBvciAiVGFrZSIKICAgIGFjdGlvbkxhYmVsLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgYWN0aW9uTGFiZWwuVGV4dFNjYWxlZCA9IHRydWUKICAgIGFjdGlvbkxhYmVsLkZvbnQgPSBFbnVtLkZvbnQuR290aGFtTWVkaXVtCiAgICBhY3Rpb25MYWJlbC5QYXJlbnQgPSBmcmFtZQogICAgCiAgICAtLSBHbG93IGVmZmVjdAogICAgbG9jYWwgZ2xvdyA9IEluc3RhbmNlLm5ldygiRnJhbWUiKQogICAgZ2xvdy5OYW1lID0gIkdsb3ciCiAgICBnbG93LlNpemUgPSBVRGltMi5uZXcoMS4yLCAwLCAxLjIsIDApCiAgICBnbG93LlBvc2l0aW9uID0gVURpbTIubmV3KC0wLjEsIDAsIC0wLjEsIDApCiAgICBnbG93LkJhY2tncm91bmRDb2xvcjMgPSBjb2xvcgogICAgZ2xvdy5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC44CiAgICBnbG93LkJvcmRlclNpemVQaXhlbCA9IDAKICAgIGdsb3cuWkluZGV4ID0gLTEKICAgIGdsb3cuUGFyZW50ID0gZnJhbWUKICAgIAogICAgbG9jYWwgZ2xvd0Nvcm5lciA9IEluc3RhbmNlLm5ldygiVUlDb3JuZXIiKQogICAgZ2xvd0Nvcm5lci5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygwLjMsIDApCiAgICBnbG93Q29ybmVyLlBhcmVudCA9IGdsb3cKICAgIAogICAgYmlsbGJvYXJkLlBhcmVudCA9IHByb21wdC5QYXJlbnQKICAgIAogICAgcmV0dXJuIGJpbGxib2FyZAplbmQKCi0tIEZ1bmdzaSB1bnR1ayBtZW5jYXJpIHByb3hpbWl0eSBwcm9tcHRzIGRhbGFtIHJhZGl1cwpsb2NhbCBmdW5jdGlvbiBmaW5kUHJvbXB0c0luUmFkaXVzKCkKICAgIGxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXIKICAgIGlmIG5vdCBjaGFyYWN0ZXIgdGhlbiByZXR1cm4ge30gZW5kCiAgICAKICAgIGxvY2FsIHJvb3QgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgaWYgbm90IHJvb3QgdGhlbiByZXR1cm4ge30gZW5kCiAgICAKICAgIGxvY2FsIGZvdW5kUHJvbXB0cyA9IHt9CiAgICAKICAgIC0tIENhcmkgZGkgYmVyYmFnYWkgbG9rYXNpIHlhbmcgbXVuZ2tpbgogICAgbG9jYWwgc2VhcmNoTG9jYXRpb25zID0gewogICAgICAgIFdvcmtzcGFjZTpGaW5kRmlyc3RDaGlsZCgiQWN0aXZlQnJhaW5yb3RzIiksCiAgICAgICAgV29ya3NwYWNlOkZpbmRGaXJzdENoaWxkKCJCcmFpbnJvdHMiKSwKICAgICAgICBXb3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQoIkl0ZW1zIiksCiAgICAgICAgV29ya3NwYWNlCiAgICB9CiAgICAKICAgIGZvciBfLCBsb2NhdGlvbiBpbiBpcGFpcnMoc2VhcmNoTG9jYXRpb25zKSBkbwogICAgICAgIGlmIGxvY2F0aW9uIHRoZW4KICAgICAgICAgICAgLS0gQ2FyaSBzZW11YSBtb2RlbCBkZW5nYW4gcHJveGltaXR5IHByb21wdAogICAgICAgICAgICBmb3IgXywgbW9kZWwgaW4gaXBhaXJzKGxvY2F0aW9uOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICBpZiBtb2RlbDpJc0EoIlByb3hpbWl0eVByb21wdCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBwYXJlbnQgPSBtb2RlbC5QYXJlbnQKICAgICAgICAgICAgICAgICAgICBpZiBwYXJlbnQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBkaXN0YW5jZSA9IChwYXJlbnQuUG9zaXRpb24gLSByb290LlBvc2l0aW9uKS5NYWduaXR1ZGUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZGlzdGFuY2UgPD0gcmFkaXVzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHJhcml0eSA9IGdldE1vZGVsUmFyaXR5KHBhcmVudCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChmb3VuZFByb21wdHMsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcm9tcHQgPSBtb2RlbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEaXN0YW5jZSA9IGRpc3RhbmNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJhcml0eSA9IHJhcml0eSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNb2RlbCA9IHBhcmVudAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgLS0gU29ydCBieSByYXJpdHkgcHJpb3JpdHkgKGhpZ2hlciByYXJpdHkgZmlyc3QpCiAgICB0YWJsZS5zb3J0KGZvdW5kUHJvbXB0cywgZnVuY3Rpb24oYSwgYikKICAgICAgICBsb2NhbCByYXJpdHlPcmRlciA9IHsKICAgICAgICAgICAgQ2VsZXN0aWFsID0gOSwgU2VjcmV0ID0gOCwgQ29zbWljID0gNywgCiAgICAgICAgICAgIE15dGhpYyA9IDYsIExlZ2VuZCA9IDUsIEVwaWMgPSA0LCAKICAgICAgICAgICAgUmFyZSA9IDMsIFVuY29tbW9uID0gMiwgQ29tbW9uID0gMQogICAgICAgIH0KICAgICAgICByZXR1cm4gcmFyaXR5T3JkZXJbYS5SYXJpdHldID4gcmFyaXR5T3JkZXJbYi5SYXJpdHldCiAgICBlbmQpCiAgICAKICAgIHJldHVybiBmb3VuZFByb21wdHMKZW5kCgotLSBGdW5nc2kgdW50dWsgdHJpZ2dlciBwcm9tcHQKbG9jYWwgZnVuY3Rpb24gdHJpZ2dlclByb21wdChwcm9tcHQpCiAgICBpZiBwcm9tcHQgYW5kIHByb21wdDpJc0EoIlByb3hpbWl0eVByb21wdCIpIHRoZW4KICAgICAgICAtLSBHdW5ha2FuIGZpcmVoaW50IHVudHVrIHRyaWdnZXIKICAgICAgICBsb2NhbCBzdWNjZXNzLCByZXN1bHQgPSBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIHByb21wdDpJbnB1dEhvbGRCZWdpbigpCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgIHByb21wdDpJbnB1dEhvbGRFbmQoKQogICAgICAgIGVuZCkKICAgICAgICAKICAgICAgICBpZiBub3Qgc3VjY2VzcyB0aGVuCiAgICAgICAgICAgIC0tIEZhbGxiYWNrIG1ldGhvZAogICAgICAgICAgICBwcm9tcHQuTWF4QWN0aXZhdGlvbkRpc3RhbmNlID0gMTAwMAogICAgICAgICAgICBwcm9tcHQuSG9sZER1cmF0aW9uID0gMAogICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICBwcm9tcHQuTWF4QWN0aXZhdGlvbkRpc3RhbmNlID0gcHJvbXB0Lk1heEFjdGl2YXRpb25EaXN0YW5jZQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0gRnVuZ3NpIHV0YW1hIHVudHVrIG1hZ25ldCBwcm94aW1pdHkKbG9jYWwgZnVuY3Rpb24gZW5hYmxlTWFnbmV0UHJveGltaXR5UHJvbXB0KCkKICAgIGlmIGNvbm5lY3Rpb24gdGhlbiByZXR1cm4gZW5kCiAgICAKICAgIC0tIEJ1YXQgdmlzdWFsIGNpcmNsZQogICAgdmlzdWFsQ2lyY2xlID0gY3JlYXRlVmlzdWFsQ2lyY2xlKCkKICAgIAogICAgLS0gU2V0dXAgY29ubmVjdGlvbgogICAgY29ubmVjdGlvbiA9IFJ1blNlcnZpY2UuSGVhcnRiZWF0OkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXIKICAgICAgICBpZiBub3QgY2hhcmFjdGVyIHRoZW4gcmV0dXJuIGVuZAogICAgICAgIAogICAgICAgIGxvY2FsIHJvb3QgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgIGlmIG5vdCByb290IHRoZW4gcmV0dXJuIGVuZAogICAgICAgIAogICAgICAgIC0tIFVwZGF0ZSB2aXN1YWwgY2lyY2xlIHBvc2l0aW9uCiAgICAgICAgdmlzdWFsQ2lyY2xlLkNGcmFtZSA9IENGcmFtZS5uZXcocm9vdC5Qb3NpdGlvbikgKiBDRnJhbWUuQW5nbGVzKDAsIDAsIG1hdGgucmFkKDkwKSkKICAgICAgICAKICAgICAgICAtLSBDYXJpIHByb21wdHMgZGFsYW0gcmFkaXVzCiAgICAgICAgbG9jYWwgcHJvbXB0cyA9IGZpbmRQcm9tcHRzSW5SYWRpdXMoKQogICAgICAgIAogICAgICAgIC0tIEhhcHVzIFVJIHlhbmcgdGlkYWsgYWt0aWYgbGFnaQogICAgICAgIGZvciBwcm9tcHRPYmosIHVpIGluIHBhaXJzKGFjdGl2ZVByb21wdHMpIGRvCiAgICAgICAgICAgIGxvY2FsIHN0aWxsQWN0aXZlID0gZmFsc2UKICAgICAgICAgICAgZm9yIF8sIGZvdW5kUHJvbXB0IGluIGlwYWlycyhwcm9tcHRzKSBkbwogICAgICAgICAgICAgICAgaWYgZm91bmRQcm9tcHQuUHJvbXB0ID09IHByb21wdE9iaiB0aGVuCiAgICAgICAgICAgICAgICAgICAgc3RpbGxBY3RpdmUgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBzdGlsbEFjdGl2ZSB0aGVuCiAgICAgICAgICAgICAgICB1aTpEZXN0cm95KCkKICAgICAgICAgICAgICAgIGFjdGl2ZVByb21wdHNbcHJvbXB0T2JqXSA9IG5pbAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAtLSBUYW1iYWhrYW4gVUkgdW50dWsgcHJvbXB0cyBiYXJ1CiAgICAgICAgZm9yIF8sIHByb21wdERhdGEgaW4gaXBhaXJzKHByb21wdHMpIGRvCiAgICAgICAgICAgIGxvY2FsIHByb21wdCA9IHByb21wdERhdGEuUHJvbXB0CiAgICAgICAgICAgIGlmIG5vdCBhY3RpdmVQcm9tcHRzW3Byb21wdF0gdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgdWkgPSBjcmVhdGVQcm9tcHRVSShwcm9tcHQsIHByb21wdERhdGEuUmFyaXR5KQogICAgICAgICAgICAgICAgYWN0aXZlUHJvbXB0c1twcm9tcHRdID0gdWkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICAtLSBUcmlnZ2VyIG90b21hdGlzIGppa2EgYWRhIHByb21wdAogICAgICAgICAgICBpZiAjcHJvbXB0cyA+IDAgdGhlbgogICAgICAgICAgICAgICAgLS0gVHJpZ2dlciB5YW5nIHBhbGluZyBsYW5na2EvaGlnaCBwcmlvcml0eQogICAgICAgICAgICAgICAgdHJpZ2dlclByb21wdChwcm9tcHRzWzFdLlByb21wdCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCiAgICAKICAgIC0tIFBhcmVudGthbiB2aXN1YWwgY2lyY2xlIGtlIHdvcmtzcGFjZQogICAgdmlzdWFsQ2lyY2xlLlBhcmVudCA9IFdvcmtzcGFjZQogICAgCiAgICBMaWJyYXJ5Ok5vdGlmeSh7CiAgICAgICAgVGl0bGUgPSAiTWFnbmV0IFByb3hpbWl0eVByb21wdCIsCiAgICAgICAgQ29udGVudCA9ICJEaWFrdGlma2FuIC0gQXV0byBjb2xsZWN0IGRhbGFtIHJhZGl1cyAiIC4uIHJhZGl1cyAuLiAiIHN0dWQhIiwKICAgICAgICBEdXJhdGlvbiA9IDMKICAgIH0pCmVuZAoKLS0gRnVuZ3NpIHVudHVrIGRpc2FibGUgbWFnbmV0CmxvY2FsIGZ1bmN0aW9uIGRpc2FibGVNYWduZXRQcm94aW1pdHlQcm9tcHQoKQogICAgaWYgY29ubmVjdGlvbiB0aGVuCiAgICAgICAgY29ubmVjdGlvbjpEaXNjb25uZWN0KCkKICAgICAgICBjb25uZWN0aW9uID0gbmlsCiAgICBlbmQKICAgIAogICAgaWYgdmlzdWFsQ2lyY2xlIHRoZW4KICAgICAgICB2aXN1YWxDaXJjbGU6RGVzdHJveSgpCiAgICAgICAgdmlzdWFsQ2lyY2xlID0gbmlsCiAgICBlbmQKICAgIAogICAgLS0gSGFwdXMgc2VtdWEgVUkKICAgIGZvciBwcm9tcHQsIHVpIGluIHBhaXJzKGFjdGl2ZVByb21wdHMpIGRvCiAgICAgICAgdWk6RGVzdHJveSgpCiAgICBlbmQKICAgIGFjdGl2ZVByb21wdHMgPSB7fQogICAgCiAgICBMaWJyYXJ5Ok5vdGlmeSh7CiAgICAgICAgVGl0bGUgPSAiTWFnbmV0IFByb3hpbWl0eVByb21wdCIsCiAgICAgICAgQ29udGVudCA9ICJEaW5vbmFrdGlma2FuIiwKICAgICAgICBEdXJhdGlvbiA9IDIKICAgIH0pCmVuZAoKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLS0gR09EIE1PREUgV0FMTCAtIE9QVElNSVpFRCBWRVJTSU9OCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgotLSBTdG9yYWdlIHVudHVrIHNlbXVhIHBhcnRzIHlhbmcgZGlidWF0CmxvY2FsIGdvZE1vZGVQYXJ0cyA9IHsKICAgIG5lb25QYXRocyA9IHt9LAogICAgYmFycmllcnMgPSB7fQp9Cgpsb2NhbCBnb2RNb2RlV2FsbEVuYWJsZWQgPSBmYWxzZQoKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLS0gQ09ORklHVVJBVElPTiAobXVkYWggZGl1YmFoKQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpsb2NhbCBHb2RNb2RlQ29uZmlnID0gewogICAgLS0gTmVvbiBQYXRoIFNldHRpbmdzCiAgICBwYXRocyA9IHsKICAgICAgICB7cG9zaXRpb24gPSBWZWN0b3IzLm5ldygyMDAsIC0yLjk3NSwgMTMzKSwgc2l6ZSA9IFZlY3RvcjMubmV3KDYuMDUsIDE0LCAyMDQ3KX0sCiAgICAgICAge3Bvc2l0aW9uID0gVmVjdG9yMy5uZXcoMTkwMCwgLTIuOTc1LCAxMzUpLCBzaXplID0gVmVjdG9yMy5uZXcoNi4wNSwgMTQsIDIwNDcpfSwKICAgICAgICB7cG9zaXRpb24gPSBWZWN0b3IzLm5ldygzMTQxLjksIC0yLjk3NSwgMTM1KSwgc2l6ZSA9IFZlY3RvcjMubmV3KDYuMDUsIDE0LCAyMDQ3KX0KICAgIH0sCiAgICAKICAgIC0tIEJhcnJpZXIgU2V0dGluZ3MKICAgIGJhcnJpZXJzID0gewogICAgICAgIHtwb3NpdGlvbiA9IFZlY3RvcjMubmV3KDExODUuNSwgNDMuNTUsIDEzOCksIHNpemUgPSBWZWN0b3IzLm5ldygyMDQ3LCAxMDAsIDIpfSwKICAgICAgICB7cG9zaXRpb24gPSBWZWN0b3IzLm5ldygxOTAwLCAtMi45NzUsIDEzOCksIHNpemUgPSBWZWN0b3IzLm5ldygyMDQ3LCAxMDAsIDIpfSwKICAgICAgICB7cG9zaXRpb24gPSBWZWN0b3IzLm5ldygzMTQxLjksIC0yLjk3NSwgMTM4KSwgc2l6ZSA9IFZlY3RvcjMubmV3KDIwNDcsIDEwMCwgMil9CiAgICB9LAogICAgCiAgICAtLSBWaXN1YWwgU2V0dGluZ3MKICAgIHBhdGhDb2xvciA9IENvbG9yMy5mcm9tUkdCKDAsIDE3MCwgMjU1KSwgLS0gQmlydQogICAgYmFycmllckNvbG9yID0gQ29sb3IzLmZyb21SR0IoMjU1LCAwLCAwKSwgLS0gTWVyYWgKICAgIHBhdGhUcmFuc3BhcmVuY3kgPSAwLjIsCiAgICBiYXJyaWVyVHJhbnNwYXJlbmN5ID0gMC4zLAogICAgcm90YXRpb24gPSBWZWN0b3IzLm5ldygtOTAsIDkwLCAwKQp9CgotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLSBIRUxQRVI6IENSRUFURSBQQVJUCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmxvY2FsIGZ1bmN0aW9uIGNyZWF0ZUdvZE1vZGVQYXJ0KHBhcnRUeXBlLCBpbmRleCwgY29uZmlnKQogICAgbG9jYWwgcGFydCA9IEluc3RhbmNlLm5ldygiUGFydCIpCiAgICBwYXJ0Lk5hbWUgPSBwYXJ0VHlwZSAuLiBpbmRleAogICAgcGFydC5TaXplID0gY29uZmlnLnNpemUKICAgIHBhcnQuUG9zaXRpb24gPSBjb25maWcucG9zaXRpb24KICAgIHBhcnQuUm90YXRpb24gPSBHb2RNb2RlQ29uZmlnLnJvdGF0aW9uCiAgICBwYXJ0LkFuY2hvcmVkID0gdHJ1ZQogICAgcGFydC5DYW5Db2xsaWRlID0gdHJ1ZQogICAgcGFydC5NYXRlcmlhbCA9IEVudW0uTWF0ZXJpYWwuTmVvbgogICAgCiAgICBpZiBwYXJ0VHlwZTpmaW5kKCJQYXRoIikgdGhlbgogICAgICAgIHBhcnQuQ29sb3IgPSBHb2RNb2RlQ29uZmlnLnBhdGhDb2xvcgogICAgICAgIHBhcnQuVHJhbnNwYXJlbmN5ID0gR29kTW9kZUNvbmZpZy5wYXRoVHJhbnNwYXJlbmN5CiAgICBlbHNlCiAgICAgICAgcGFydC5Db2xvciA9IEdvZE1vZGVDb25maWcuYmFycmllckNvbG9yCiAgICAgICAgcGFydC5UcmFuc3BhcmVuY3kgPSBHb2RNb2RlQ29uZmlnLmJhcnJpZXJUcmFuc3BhcmVuY3kKICAgICAgICBwYXJ0LlJvdGF0aW9uID0gVmVjdG9yMy5uZXcoMCwgMCwgMCkgLS0gQmFycmllcnMgZG9uJ3Qgcm90YXRlCiAgICBlbmQKICAgIAogICAgcGFydC5QYXJlbnQgPSB3b3Jrc3BhY2UKICAgIHJldHVybiBwYXJ0CmVuZAoKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLS0gSEVMUEVSOiBSRU1PVkUgTUFQIFdBTExTCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmxvY2FsIGZ1bmN0aW9uIHJlbW92ZU1hcFdhbGxzKCkKICAgIGxvY2FsIG1hcHNUb0NoZWNrID0geyJEZWZhdWx0TWFwIiwgIlZhbGVudGluZXNNYXAifQogICAgbG9jYWwgcmVtb3ZlZCA9IGZhbHNlCiAgICAKICAgIGZvciBfLCBtYXBOYW1lIGluIGlwYWlycyhtYXBzVG9DaGVjaykgZG8KICAgICAgICBsb2NhbCBtYXAgPSB3b3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQobWFwTmFtZSkKICAgICAgICBpZiBtYXAgdGhlbgogICAgICAgICAgICBsb2NhbCByaWdodFdhbGxzID0gbWFwOkZpbmRGaXJzdENoaWxkKCJSaWdodFdhbGxzIikKICAgICAgICAgICAgaWYgcmlnaHRXYWxscyB0aGVuCiAgICAgICAgICAgICAgICByaWdodFdhbGxzOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgcHJpbnQoIuKchSBSaWdodFdhbGxzIHJlbW92ZWQgZnJvbSIsIG1hcE5hbWUpCiAgICAgICAgICAgICAgICByZW1vdmVkID0gdHJ1ZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgCiAgICBpZiBub3QgcmVtb3ZlZCB0aGVuCiAgICAgICAgd2Fybigi4pqg77iPIE5vIFJpZ2h0V2FsbHMgZm91bmQgaW4gYW55IG1hcCIpCiAgICBlbmQKICAgIAogICAgcmV0dXJuIHJlbW92ZWQKZW5kCgotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLSBFTkFCTEUgR09EIE1PREUgV0FMTAotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpsb2NhbCBmdW5jdGlvbiBlbmFibGVHb2RNb2RlV2FsbCgpCiAgICBpZiBnb2RNb2RlV2FsbEVuYWJsZWQgdGhlbgogICAgICAgIHByaW50KCLimqDvuI8gR29kIE1vZGUgV2FsbCBhbHJlYWR5IGVuYWJsZWQiKQogICAgICAgIHJldHVybiB0cnVlCiAgICBlbmQKICAgIAogICAgcHJpbnQoIvCflIQgRW5hYmxpbmcgR29kIE1vZGUgV2FsbC4uLiIpCiAgICAKICAgIC0tIFN0ZXAgMTogUmVtb3ZlIGV4aXN0aW5nIG1hcCB3YWxscwogICAgcmVtb3ZlTWFwV2FsbHMoKQogICAgCiAgICAtLSBTdGVwIDI6IENyZWF0ZSBOZW9uIFBhdGhzCiAgICBmb3IgaSwgcGF0aENvbmZpZyBpbiBpcGFpcnMoR29kTW9kZUNvbmZpZy5wYXRocykgZG8KICAgICAgICBsb2NhbCBzdWNjZXNzLCBwYXJ0ID0gcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICByZXR1cm4gY3JlYXRlR29kTW9kZVBhcnQoIkdvZE1vZGVQYXRoIiwgaSwgcGF0aENvbmZpZykKICAgICAgICBlbmQpCiAgICAgICAgCiAgICAgICAgaWYgc3VjY2VzcyBhbmQgcGFydCB0aGVuCiAgICAgICAgICAgIHRhYmxlLmluc2VydChnb2RNb2RlUGFydHMubmVvblBhdGhzLCBwYXJ0KQogICAgICAgICAgICBwcmludChzdHJpbmcuZm9ybWF0KCLinIUgTmVvbiBQYXRoICVkIGNyZWF0ZWQgYXQgJXMiLCBpLCB0b3N0cmluZyhwYXRoQ29uZmlnLnBvc2l0aW9uKSkpCiAgICAgICAgZWxzZQogICAgICAgICAgICB3YXJuKHN0cmluZy5mb3JtYXQoIuKdjCBGYWlsZWQgdG8gY3JlYXRlIE5lb24gUGF0aCAlZCIsIGkpKQogICAgICAgIGVuZAogICAgZW5kCiAgICAKICAgIC0tIFN0ZXAgMzogQ3JlYXRlIEJhcnJpZXJzCiAgICBmb3IgaSwgYmFycmllckNvbmZpZyBpbiBpcGFpcnMoR29kTW9kZUNvbmZpZy5iYXJyaWVycykgZG8KICAgICAgICBsb2NhbCBzdWNjZXNzLCBwYXJ0ID0gcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICByZXR1cm4gY3JlYXRlR29kTW9kZVBhcnQoIkdvZE1vZGVCYXJyaWVyIiwgaSwgYmFycmllckNvbmZpZykKICAgICAgICBlbmQpCiAgICAgICAgCiAgICAgICAgaWYgc3VjY2VzcyBhbmQgcGFydCB0aGVuCiAgICAgICAgICAgIHRhYmxlLmluc2VydChnb2RNb2RlUGFydHMuYmFycmllcnMsIHBhcnQpCiAgICAgICAgICAgIHByaW50KHN0cmluZy5mb3JtYXQoIuKchSBCYXJyaWVyICVkIGNyZWF0ZWQgYXQgJXMiLCBpLCB0b3N0cmluZyhiYXJyaWVyQ29uZmlnLnBvc2l0aW9uKSkpCiAgICAgICAgZWxzZQogICAgICAgICAgICB3YXJuKHN0cmluZy5mb3JtYXQoIuKdjCBGYWlsZWQgdG8gY3JlYXRlIEJhcnJpZXIgJWQiLCBpKSkKICAgICAgICBlbmQKICAgIGVuZAogICAgCiAgICBnb2RNb2RlV2FsbEVuYWJsZWQgPSB0cnVlCiAgICBwcmludChzdHJpbmcuZm9ybWF0KCLinIUgR29kIE1vZGUgV2FsbCBlbmFibGVkISBDcmVhdGVkICVkIHBhdGhzIGFuZCAlZCBiYXJyaWVycyIsIAogICAgICAgICNnb2RNb2RlUGFydHMubmVvblBhdGhzLCAjZ29kTW9kZVBhcnRzLmJhcnJpZXJzKSkKICAgIAogICAgcmV0dXJuIHRydWUKZW5kCgotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLSBESVNBQkxFIEdPRCBNT0RFIFdBTEwKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KbG9jYWwgZnVuY3Rpb24gZGlzYWJsZUdvZE1vZGVXYWxsKCkKICAgIGlmIG5vdCBnb2RNb2RlV2FsbEVuYWJsZWQgdGhlbgogICAgICAgIHByaW50KCLimqDvuI8gR29kIE1vZGUgV2FsbCBhbHJlYWR5IGRpc2FibGVkIikKICAgICAgICByZXR1cm4gdHJ1ZQogICAgZW5kCiAgICAKICAgIHByaW50KCLwn5SEIERpc2FibGluZyBHb2QgTW9kZSBXYWxsLi4uIikKICAgIAogICAgbG9jYWwgdG90YWxSZW1vdmVkID0gMAogICAgCiAgICAtLSBSZW1vdmUgYWxsIG5lb24gcGF0aHMKICAgIGZvciBpID0gI2dvZE1vZGVQYXJ0cy5uZW9uUGF0aHMsIDEsIC0xIGRvCiAgICAgICAgbG9jYWwgcGFydCA9IGdvZE1vZGVQYXJ0cy5uZW9uUGF0aHNbaV0KICAgICAgICBpZiBwYXJ0IGFuZCBwYXJ0LlBhcmVudCB0aGVuCiAgICAgICAgICAgIHBhcnQ6RGVzdHJveSgpCiAgICAgICAgICAgIHRvdGFsUmVtb3ZlZCA9IHRvdGFsUmVtb3ZlZCArIDEKICAgICAgICBlbmQKICAgICAgICB0YWJsZS5yZW1vdmUoZ29kTW9kZVBhcnRzLm5lb25QYXRocywgaSkKICAgIGVuZAogICAgCiAgICAtLSBSZW1vdmUgYWxsIGJhcnJpZXJzCiAgICBmb3IgaSA9ICNnb2RNb2RlUGFydHMuYmFycmllcnMsIDEsIC0xIGRvCiAgICAgICAgbG9jYWwgcGFydCA9IGdvZE1vZGVQYXJ0cy5iYXJyaWVyc1tpXQogICAgICAgIGlmIHBhcnQgYW5kIHBhcnQuUGFyZW50IHRoZW4KICAgICAgICAgICAgcGFydDpEZXN0cm95KCkKICAgICAgICAgICAgdG90YWxSZW1vdmVkID0gdG90YWxSZW1vdmVkICsgMQogICAgICAgIGVuZAogICAgICAgIHRhYmxlLnJlbW92ZShnb2RNb2RlUGFydHMuYmFycmllcnMsIGkpCiAgICBlbmQKICAgIAogICAgZ29kTW9kZVdhbGxFbmFibGVkID0gZmFsc2UKICAgIHByaW50KHN0cmluZy5mb3JtYXQoIuKchSBHb2QgTW9kZSBXYWxsIGRpc2FibGVkISBSZW1vdmVkICVkIHBhcnRzIiwgdG90YWxSZW1vdmVkKSkKICAgIAogICAgcmV0dXJuIHRydWUKZW5kCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi0tIEFVVE8gRkFSTSBTVEFURQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpsb2NhbCBhdXRvQnJhaW5yb3RFbmFibGVkID0gZmFsc2UKbG9jYWwgYXV0b0JyYWlucm90VGhyZWFkID0gbmlsCmxvY2FsIHNlbGVjdGVkUmFyaXR5ID0gIlJhcmUiCgotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLSBXQVZFIFNFVFRJTkdTCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmxvY2FsIFdBVkVfREFOR0VSX1JBRElVUyA9IDY1CmxvY2FsIFdBVkVfQ0hFQ0tfSU5URVJWQUwgPSAwLjIgLS0gUmVkdWNlZCBmcmVxdWVuY3kKbG9jYWwgV0FWRV9DQUNIRV9EVVJBVElPTiA9IDEgLS0gQ2FjaGUgd2F2ZSBjaGVjayByZXN1bHRzIGZvciAyIHNlY29uZHMKCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi0tIFBFUkZPUk1BTkNFIENBQ0hFCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmxvY2FsIHdhdmVDYWNoZSA9IHsKICAgIGxhc3RDaGVjayA9IDAsCiAgICBpc0FjdGl2ZSA9IGZhbHNlLAogICAgd2F2ZVBhcnRzID0ge30gLS0gQ2FjaGVkIHdhdmUgcGFydCByZWZlcmVuY2VzCn0KCmxvY2FsIGJyYWlucm90Q2FjaGUgPSB7CiAgICBsYXN0U2NhbiA9IDAsCiAgICBzY2FuSW50ZXJ2YWwgPSAwLjUsIC0tIFJlLXNjYW4gZXZlcnkgMSBzZWNvbmQKICAgIG5lYXJlc3RCcmFpbnJvdCA9IG5pbAp9CgotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLSBGSU5BTCBSRVRVUk4gUE9TSVRJT04KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KbG9jYWwgRklOQUxfUkVUVVJOX0NGUkFNRSA9IENGcmFtZS5uZXcoCiAgICAxMjkuNjM5LCAzLjIzOCwgMTI4Ljk3NSwKICAgIC0xLjAwMCwgMC4wMDAsIDAuMDAxLAogICAgMC4wMDAsIDEuMDAwLCAwLjAwMCwKICAgIC0wLjAwMSwgMC4wMDAsIC0xLjAwMAopCgotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLSBCUkFJTlJPVCBGQVJNIFBPU0lUSU9OUwotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpsb2NhbCBCUkFJTlJPVF9QT1NJVElPTlMgPSB7CiAgICBbMV0gPSBDRnJhbWUubmV3KDEzMi42MzMsIDMuMjg4LCAxMzQuNDM2LCAtMC4wNjUsIC0wLjAwMCwgMC45OTgsIC0wLjAwMCwgMS4wMDAsIDAuMDAwLCAtMC45OTgsIC0wLjAwMCwgLTAuMDY1KSwKICAgIFsyXSA9IENGcmFtZS5uZXcoMjQ3LjAzNCwgMy4yODgsIDEzNi40ODUsIC0xLjAwMCwgMC4wMDAsIC0wLjAwMCwgMC4wMDAsIDEuMDAwLCAtMC4wMDAsIDAuMDAwLCAtMC4wMDAsIC0xLjAwMCksCiAgICBbM10gPSBDRnJhbWUubmV3KDMyOS4xNjgsIDMuMjg4LCAxMzYuNDYxLCAtMS4wMDAsIC0wLjAwMCwgLTAuMDExLCAtMC4wMDAsIDEuMDAwLCAtMC4wMDAsIDAuMDExLCAtMC4wMDAsIC0xLjAwMCksCiAgICBbNF0gPSBDRnJhbWUubmV3KDQ0NC41MDcsIDMuMjg4LCAxMzYuNDg2LCAtMS4wMDAsIDAuMDAwLCAtMC4wMDQsIDAuMDAwLCAxLjAwMCwgLTAuMDAwLCAwLjAwNCwgLTAuMDAwLCAtMS4wMDApLAogICAgWzVdID0gQ0ZyYW1lLm5ldyg2MDguMzU5LCAzLjI4OCwgMTM2LjUxMCwgLTEuMDAwLCAwLjAwMCwgMC4wMDQsIDAuMDAwLCAxLjAwMCwgLTAuMDAwLCAtMC4wMDQsIC0wLjAwMCwgLTEuMDAwKSwKICAgIFs2XSA9IENGcmFtZS5uZXcoODEzLjIzNiwgMy4yODgsIDEzNS45NDUsIC0wLjcyMCwgMC4wMDAsIC0wLjY5NCwgLTAuMDAwLCAxLjAwMCwgMC4wMDAsIDAuNjk0LCAwLjAwMCwgLTAuNzIwKSwKICAgIFs3XSA9IENGcmFtZS5uZXcoMTIwOS42NjMsIDMuMjg4LCAxMzYuNDU2LCAtMC45OTksIDAuMDAwLCAtMC4wNDMsIDAuMDAwLCAxLjAwMCwgMC4wMDAsIDAuMDQzLCAwLjAwMCwgLTAuOTk5KSwKICAgIFs4XSA9IENGcmFtZS5uZXcoMjYzMC4xOTYsIDMuMjg4LCAxMzUuOTE0LCAwLjAwMCwgLTAuMDAwLCAxLjAwMCwgMC4wMDAsIDEuMDAwLCAwLjAwMCwgLTEuMDAwLCAwLjAwMCwgMC4wMDApLAogICAgWzldID0gQ0ZyYW1lLm5ldygyOTgwLjE0NywgMy4yODgsIDEzMy4xNTgsIDAuOTAwLCAtMC4wMDAsIC0wLjQzNywgMC4wMDAsIDEuMDAwLCAwLjAwMCwgMC40MzcsIC0wLjAwMCwgMC45MDApLAogICAgWzEwXSA9IENGcmFtZS5uZXcoMzE2Ni40NjYsIDMuMjg4LCAxMzYuNDkxLCAtMS4wMDAsIC0wLjAwMCwgMC4wMDgsIC0wLjAwMCwgMS4wMDAsIDAuMDAwLCAtMC4wMDgsIDAuMDAwLCAtMS4wMDApLAogICAgWzExXSA9IENGcmFtZS5uZXcoMzc5Ny41MDEsIDMuMjg4LCAxMzUuODY0LCAtMC42NTIsIC0wLjAwMCwgLTAuNzU5LCAtMC4wMDAsIDEuMDAwLCAtMC4wMDAsIDAuNzU5LCAwLjAwMCwgLTAuNjUyKSwKICAgIFsxMl0gPSBDRnJhbWUubmV3KDQxMzkuOTA1LCAzLjI4OCwgMTM2LjM5OSwgLTAuOTk1LCAtMC4wMDAsIC0wLjEwMSwgLTAuMDAwLCAxLjAwMCwgLTAuMDAwLCAwLjEwMSwgLTAuMDAwLCAtMC45OTUpCn0KCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi0tIE9QVElNSVpFRDogQlVJTEQgV0FWRSBQQVJUUyBDQUNIRQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpsb2NhbCBmdW5jdGlvbiByZWJ1aWxkV2F2ZUNhY2hlKCkKICAgIHdhdmVDYWNoZS53YXZlUGFydHMgPSB7fQogICAgCiAgICAtLSBNZXRob2QgMTogRGVmYXVsdE1hcCAobW9zdCByZWxpYWJsZSkKICAgIGxvY2FsIG1hcCA9IFdvcmtzcGFjZTpGaW5kRmlyc3RDaGlsZCgiRGVmYXVsdE1hcF9TaGFyZWRJbnN0YW5jZXMiKQogICAgaWYgbWFwIHRoZW4KICAgICAgICBsb2NhbCBhbGxvd2VkID0gbWFwOkZpbmRGaXJzdENoaWxkKCJBbGxvd2VkU3BhY2VzIikKICAgICAgICBpZiBhbGxvd2VkIHRoZW4KICAgICAgICAgICAgZm9yIF8sIG9iaiBpbiBpcGFpcnMoYWxsb3dlZDpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgaWYgb2JqOklzQSgiQmFzZVBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgbmFtZSA9IG9iai5OYW1lOmxvd2VyKCkKICAgICAgICAgICAgICAgICAgICBpZiBuYW1lOmZpbmQoIndhdmUiKSBvciBuYW1lOmZpbmQoInRzdW5hbWkiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydCh3YXZlQ2FjaGUud2F2ZVBhcnRzLCBvYmopCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgLS0gTWV0aG9kIDI6IFNjYW4gc3BlY2lmaWMgZm9sZGVycyBvbmx5IChub3QgZW50aXJlIFdvcmtzcGFjZSkKICAgIGxvY2FsIHBvdGVudGlhbFdhdmVGb2xkZXJzID0gewogICAgICAgICJXYXZlVmlzdWFscyIsCiAgICAgICAgIlRzdW5hbWlFZmZlY3RzIiwgCiAgICAgICAgIkRpc2FzdGVycyIsCiAgICAgICAgIkhhemFyZHMiCiAgICB9CiAgICAKICAgIGZvciBfLCBmb2xkZXJOYW1lIGluIGlwYWlycyhwb3RlbnRpYWxXYXZlRm9sZGVycykgZG8KICAgICAgICBsb2NhbCBmb2xkZXIgPSBXb3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQoZm9sZGVyTmFtZSkKICAgICAgICBpZiBmb2xkZXIgdGhlbgogICAgICAgICAgICBmb3IgXywgb2JqIGluIGlwYWlycyhmb2xkZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgIGlmIG9iajpJc0EoIkJhc2VQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIG5hbWUgPSBvYmouTmFtZTpsb3dlcigpCiAgICAgICAgICAgICAgICAgICAgaWYgbmFtZTpmaW5kKCJ3YXZlIikgb3IgbmFtZTpmaW5kKCJ0c3VuYW1pIikgb3IgbmFtZTpmaW5kKCJoaXRib3giKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydCh3YXZlQ2FjaGUud2F2ZVBhcnRzLCBvYmopCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgcHJpbnQoIltXQVZFIENBQ0hFXSBCdWlsdCBjYWNoZSB3aXRoIiwgI3dhdmVDYWNoZS53YXZlUGFydHMsICJwb3RlbnRpYWwgd2F2ZSBwYXJ0cyIpCmVuZAoKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLS0gT1BUSU1JWkVEOiBGQVNUIERJU1RBTkNFIENIRUNLIChOTyBFWFBFTlNJVkUgTUFUSCkKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KbG9jYWwgZnVuY3Rpb24gcXVpY2tEaXN0YW5jZUNoZWNrKHBvaW50LCBwYXJ0KQogICAgLS0gUXVpY2sgYm91bmRpbmcgYm94IGNoZWNrIChtdWNoIGZhc3RlciB0aGFuIHByZWNpc2UgZGlzdGFuY2UpCiAgICBsb2NhbCBwYXJ0UG9zID0gcGFydC5Qb3NpdGlvbgogICAgbG9jYWwgaGFsZlNpemUgPSBwYXJ0LlNpemUgKiAwLjUKICAgIAogICAgbG9jYWwgZHggPSBtYXRoLmFicyhwb2ludC5YIC0gcGFydFBvcy5YKSAtIGhhbGZTaXplLlgKICAgIGxvY2FsIGR5ID0gbWF0aC5hYnMocG9pbnQuWSAtIHBhcnRQb3MuWSkgLSBoYWxmU2l6ZS5ZCiAgICBsb2NhbCBkeiA9IG1hdGguYWJzKHBvaW50LlogLSBwYXJ0UG9zLlopIC0gaGFsZlNpemUuWgogICAgCiAgICAtLSBJZiBhbGwgbmVnYXRpdmUsIHBvaW50IGlzIGluc2lkZSBib3gKICAgIGlmIGR4IDw9IDAgYW5kIGR5IDw9IDAgYW5kIGR6IDw9IDAgdGhlbgogICAgICAgIHJldHVybiAwCiAgICBlbmQKICAgIAogICAgLS0gT3RoZXJ3aXNlIGFwcHJveGltYXRlIGRpc3RhbmNlCiAgICBkeCA9IG1hdGgubWF4KGR4LCAwKQogICAgZHkgPSBtYXRoLm1heChkeSwgMCkKICAgIGR6ID0gbWF0aC5tYXgoZHosIDApCiAgICAKICAgIHJldHVybiBtYXRoLnNxcnQoZHgqZHggKyBkeSpkeSArIGR6KmR6KQplbmQKCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi0tIE9QVElNSVpFRDogV0FWRSBERVRFQ1RPUiBXSVRIIENBQ0hJTkcKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KbG9jYWwgZnVuY3Rpb24gaXNXYXZlQWN0aXZlKCkKICAgIGxvY2FsIG5vdyA9IHRpY2soKQogICAgCiAgICAtLSBSZXR1cm4gY2FjaGVkIHJlc3VsdCBpZiBzdGlsbCBmcmVzaAogICAgaWYgbm93IC0gd2F2ZUNhY2hlLmxhc3RDaGVjayA8IFdBVkVfQ0FDSEVfRFVSQVRJT04gdGhlbgogICAgICAgIHJldHVybiB3YXZlQ2FjaGUuaXNBY3RpdmUKICAgIGVuZAogICAgCiAgICBsb2NhbCBjaGFyID0gcGxheWVyLkNoYXJhY3RlcgogICAgaWYgbm90IGNoYXIgdGhlbiAKICAgICAgICB3YXZlQ2FjaGUubGFzdENoZWNrID0gbm93CiAgICAgICAgd2F2ZUNhY2hlLmlzQWN0aXZlID0gZmFsc2UKICAgICAgICByZXR1cm4gZmFsc2UgCiAgICBlbmQKCiAgICBsb2NhbCBocnAgPSBjaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgIGlmIG5vdCBocnAgdGhlbiAKICAgICAgICB3YXZlQ2FjaGUubGFzdENoZWNrID0gbm93CiAgICAgICAgd2F2ZUNhY2hlLmlzQWN0aXZlID0gZmFsc2UKICAgICAgICByZXR1cm4gZmFsc2UgCiAgICBlbmQKCiAgICBsb2NhbCBwbGF5ZXJQb3MgPSBocnAuUG9zaXRpb24KICAgIAogICAgLS0gUmVidWlsZCBjYWNoZSBpZiBlbXB0eSAoZmlyc3QgcnVuIG9yIGFmdGVyIGNsZWFudXApCiAgICBpZiAjd2F2ZUNhY2hlLndhdmVQYXJ0cyA9PSAwIHRoZW4KICAgICAgICByZWJ1aWxkV2F2ZUNhY2hlKCkKICAgIGVuZAogICAgCiAgICAtLSBDaGVjayBPTkxZIGNhY2hlZCB3YXZlIHBhcnRzIChzdXBlciBmYXN0ISkKICAgIGZvciBpID0gI3dhdmVDYWNoZS53YXZlUGFydHMsIDEsIC0xIGRvCiAgICAgICAgbG9jYWwgcGFydCA9IHdhdmVDYWNoZS53YXZlUGFydHNbaV0KICAgICAgICAKICAgICAgICAtLSBSZW1vdmUgaWYgZGVzdHJveWVkCiAgICAgICAgaWYgbm90IHBhcnQuUGFyZW50IHRoZW4KICAgICAgICAgICAgdGFibGUucmVtb3ZlKHdhdmVDYWNoZS53YXZlUGFydHMsIGkpCiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgLS0gU2tpcCBpZiB0cmFuc3BhcmVudCAobm90IGFjdGl2ZSkKICAgICAgICBpZiBwYXJ0LlRyYW5zcGFyZW5jeSA+PSAxIHRoZW4KICAgICAgICAgICAgY29udGludWUKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAtLSBRdWljayBkaXN0YW5jZSBjaGVjawogICAgICAgIGxvY2FsIGRpc3QgPSBxdWlja0Rpc3RhbmNlQ2hlY2socGxheWVyUG9zLCBwYXJ0KQogICAgICAgIGlmIGRpc3QgPD0gV0FWRV9EQU5HRVJfUkFESVVTIHRoZW4KICAgICAgICAgICAgd2F2ZUNhY2hlLmxhc3RDaGVjayA9IG5vdwogICAgICAgICAgICB3YXZlQ2FjaGUuaXNBY3RpdmUgPSB0cnVlCiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgd2F2ZUNhY2hlLmxhc3RDaGVjayA9IG5vdwogICAgd2F2ZUNhY2hlLmlzQWN0aXZlID0gZmFsc2UKICAgIHJldHVybiBmYWxzZQplbmQKCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi0tIE9QVElNSVpFRDogR0VUIE5FQVJFU1QgQlJBSU5ST1QgKFdJVEggVkFMSURBVElPTikKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KbG9jYWwgQnJhaW5yb3RSb290ID0gV29ya3NwYWNlOldhaXRGb3JDaGlsZCgiQWN0aXZlQnJhaW5yb3RzIikKCmxvY2FsIGZ1bmN0aW9uIGdldE5lYXJlc3RCcmFpbnJvdChmb3JjZVJlc2NhbikKICAgIGxvY2FsIG5vdyA9IHRpY2soKQogICAgCiAgICAtLSBTa2lwIGNhY2hlIGlmIGZvcmNlIHJlc2NhbiBPUiBpZiBjYWNoZWQgYnJhaW5yb3QgaXMgaW52YWxpZAogICAgaWYgbm90IGZvcmNlUmVzY2FuIGFuZCBub3cgLSBicmFpbnJvdENhY2hlLmxhc3RTY2FuIDwgYnJhaW5yb3RDYWNoZS5zY2FuSW50ZXJ2YWwgdGhlbgogICAgICAgIGlmIGJyYWlucm90Q2FjaGUubmVhcmVzdEJyYWlucm90IGFuZCBicmFpbnJvdENhY2hlLm5lYXJlc3RCcmFpbnJvdC5QYXJlbnQgdGhlbgogICAgICAgICAgICAtLSBEb3VibGUgY2hlY2s6IGJyYWlucm90IG1hc2loIGFkYSBSb290LW55YT8KICAgICAgICAgICAgbG9jYWwgY2FjaGVkUm9vdCA9IGJyYWlucm90Q2FjaGUubmVhcmVzdEJyYWlucm90OkZpbmRGaXJzdENoaWxkKCJSb290IikKICAgICAgICAgICAgaWYgY2FjaGVkUm9vdCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gYnJhaW5yb3RDYWNoZS5uZWFyZXN0QnJhaW5yb3QKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgLS0gQ2xlYXIgaW52YWxpZCBjYWNoZQogICAgYnJhaW5yb3RDYWNoZS5uZWFyZXN0QnJhaW5yb3QgPSBuaWwKICAgIAogICAgbG9jYWwgZm9sZGVyID0gQnJhaW5yb3RSb290OkZpbmRGaXJzdENoaWxkKHNlbGVjdGVkUmFyaXR5KQogICAgaWYgbm90IGZvbGRlciB0aGVuIAogICAgICAgIHJldHVybiBuaWwgCiAgICBlbmQKCiAgICBsb2NhbCBjaGFyID0gcGxheWVyLkNoYXJhY3RlcgogICAgaWYgbm90IGNoYXIgdGhlbiByZXR1cm4gbmlsIGVuZAoKICAgIGxvY2FsIGhycCA9IGNoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgaWYgbm90IGhycCB0aGVuIHJldHVybiBuaWwgZW5kCgogICAgbG9jYWwgcGxheWVyUG9zID0gaHJwLlBvc2l0aW9uCiAgICBsb2NhbCBuZWFyZXN0ID0gbmlsCiAgICBsb2NhbCBzaG9ydGVzdCA9IG1hdGguaHVnZQoKICAgIGZvciBfLCBtb2RlbCBpbiBpcGFpcnMoZm9sZGVyOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgbW9kZWw6SXNBKCJNb2RlbCIpIHRoZW4KICAgICAgICAgICAgbG9jYWwgcm9vdCA9IG1vZGVsOkZpbmRGaXJzdENoaWxkKCJSb290IikKICAgICAgICAgICAgaWYgcm9vdCBhbmQgcm9vdC5QYXJlbnQgdGhlbiAtLSBWQUxJREFUSU9OOiBSb290IG1hc2loIGFkYQogICAgICAgICAgICAgICAgLS0gRmFzdCBtYWduaXR1ZGUgY2FsY3VsYXRpb24KICAgICAgICAgICAgICAgIGxvY2FsIG9mZnNldCA9IHJvb3QuUG9zaXRpb24gLSBwbGF5ZXJQb3MKICAgICAgICAgICAgICAgIGxvY2FsIGRpc3RTcSA9IG9mZnNldC5YKm9mZnNldC5YICsgb2Zmc2V0Llkqb2Zmc2V0LlkgKyBvZmZzZXQuWipvZmZzZXQuWgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBkaXN0U3EgPCBzaG9ydGVzdCB0aGVuCiAgICAgICAgICAgICAgICAgICAgc2hvcnRlc3QgPSBkaXN0U3EKICAgICAgICAgICAgICAgICAgICBuZWFyZXN0ID0gbW9kZWwKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGJyYWlucm90Q2FjaGUubGFzdFNjYW4gPSBub3cKICAgIGJyYWlucm90Q2FjaGUubmVhcmVzdEJyYWlucm90ID0gbmVhcmVzdAogICAgcmV0dXJuIG5lYXJlc3QKZW5kCgotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLSBDSEVDSyBJRiBIT0xESU5HIEJSQUlOUk9UCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmxvY2FsIGZ1bmN0aW9uIGlzSG9sZGluZ0JyYWlucm90KCkKICAgIGxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXIKICAgIGlmIG5vdCBjaGFyYWN0ZXIgdGhlbiByZXR1cm4gZmFsc2UgZW5kCgogICAgLS0gUXVpY2sgY2hlY2s6IFRvb2wgZXF1aXBwZWQKICAgIGlmIGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIlRvb2wiKSB0aGVuCiAgICAgICAgcmV0dXJuIHRydWUKICAgIGVuZAoKICAgIC0tIENoZWNrIGZvciBNb2RlbC9CYXNlUGFydCAobm9uLWh1bWFub2lkIHBhcnRzKQogICAgZm9yIF8sIG9iaiBpbiBpcGFpcnMoY2hhcmFjdGVyOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgKG9iajpJc0EoIk1vZGVsIikgb3Igb2JqOklzQSgiQmFzZVBhcnQiKSkgYW5kIAogICAgICAgICAgIG9iai5OYW1lIH49ICJIdW1hbm9pZFJvb3RQYXJ0IiBhbmQgCiAgICAgICAgICAgb2JqLk5hbWUgfj0gIkhlYWQiIGFuZAogICAgICAgICAgIG9iai5OYW1lIH49ICJUb3JzbyIgYW5kCiAgICAgICAgICAgb2JqLk5hbWUgfj0gIlVwcGVyVG9yc28iIGFuZAogICAgICAgICAgIG9iai5OYW1lIH49ICJMb3dlclRvcnNvIiB0aGVuCiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICByZXR1cm4gZmFsc2UKZW5kCgotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLSBUQUtFIEJSQUlOUk9UCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmxvY2FsIGZ1bmN0aW9uIHRha2VCcmFpbnJvdChtb2RlbCkKICAgIGlmIG5vdCBtb2RlbCB0aGVuIHJldHVybiBlbmQKICAgIAogICAgbG9jYWwgcm9vdCA9IG1vZGVsOkZpbmRGaXJzdENoaWxkKCJSb290IikKICAgIGlmIG5vdCByb290IHRoZW4gcmV0dXJuIGVuZAoKICAgIGxvY2FsIHByb21wdCA9IHJvb3Q6RmluZEZpcnN0Q2hpbGQoIlRha2VQcm9tcHQiLCB0cnVlKQogICAgaWYgcHJvbXB0IGFuZCBwcm9tcHQ6SXNBKCJQcm94aW1pdHlQcm9tcHQiKSB0aGVuCiAgICAgICAgZmlyZXByb3hpbWl0eXByb21wdChwcm9tcHQpCiAgICBlbmQKZW5kCgotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLSBHRVQgQ1VSUkVOVCBQT1NJVElPTiBJTkRFWAotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpsb2NhbCBmdW5jdGlvbiBnZXRDdXJyZW50UG9zaXRpb25JbmRleCgpCiAgICBsb2NhbCBjaGFyID0gcGxheWVyLkNoYXJhY3RlcgogICAgaWYgbm90IGNoYXIgdGhlbiByZXR1cm4gMSBlbmQKICAgIAogICAgbG9jYWwgaHJwID0gY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICBpZiBub3QgaHJwIHRoZW4gcmV0dXJuIDEgZW5kCiAgICAKICAgIGxvY2FsIHBsYXllclBvcyA9IGhycC5Qb3NpdGlvbgogICAgbG9jYWwgbmVhcmVzdEluZGV4ID0gMQogICAgbG9jYWwgc2hvcnRlc3REaXN0U3EgPSBtYXRoLmh1Z2UKICAgIAogICAgZm9yIGksIHBvcyBpbiBwYWlycyhCUkFJTlJPVF9QT1NJVElPTlMpIGRvCiAgICAgICAgbG9jYWwgb2Zmc2V0ID0gcG9zLlBvc2l0aW9uIC0gcGxheWVyUG9zCiAgICAgICAgbG9jYWwgZGlzdFNxID0gb2Zmc2V0Llgqb2Zmc2V0LlggKyBvZmZzZXQuWSpvZmZzZXQuWSArIG9mZnNldC5aKm9mZnNldC5aCiAgICAgICAgCiAgICAgICAgaWYgZGlzdFNxIDwgc2hvcnRlc3REaXN0U3EgdGhlbgogICAgICAgICAgICBzaG9ydGVzdERpc3RTcSA9IGRpc3RTcQogICAgICAgICAgICBuZWFyZXN0SW5kZXggPSBpCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgcmV0dXJuIG5lYXJlc3RJbmRleAplbmQKCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi0tIEdFVCBORUFSRVNUIEJSQUlOUk9UIFBPU0lUSU9OIElOREVYIFRPIFRBUkdFVAotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpsb2NhbCBmdW5jdGlvbiBnZXROZWFyZXN0QnJhaW5yb3RQb3NpdGlvbkluZGV4KHRhcmdldFBvcykKICAgIGxvY2FsIG5lYXJlc3RJbmRleCA9IDEKICAgIGxvY2FsIHNob3J0ZXN0RGlzdFNxID0gbWF0aC5odWdlCiAgICAKICAgIGZvciBpLCBwb3NpdGlvbiBpbiBwYWlycyhCUkFJTlJPVF9QT1NJVElPTlMpIGRvCiAgICAgICAgbG9jYWwgb2Zmc2V0ID0gdGFyZ2V0UG9zIC0gcG9zaXRpb24uUG9zaXRpb24KICAgICAgICBsb2NhbCBkaXN0U3EgPSBvZmZzZXQuWCpvZmZzZXQuWCArIG9mZnNldC5ZKm9mZnNldC5ZICsgb2Zmc2V0Lloqb2Zmc2V0LloKICAgICAgICAKICAgICAgICBpZiBkaXN0U3EgPCBzaG9ydGVzdERpc3RTcSB0aGVuCiAgICAgICAgICAgIHNob3J0ZXN0RGlzdFNxID0gZGlzdFNxCiAgICAgICAgICAgIG5lYXJlc3RJbmRleCA9IGkKICAgICAgICBlbmQKICAgIGVuZAogICAgCiAgICByZXR1cm4gbmVhcmVzdEluZGV4CmVuZAoKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLS0gRU1FUkdFTkNZIFdBVkUgRVNDQVBFCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmxvY2FsIGZ1bmN0aW9uIGVtZXJnZW5jeVdhdmVFc2NhcGUoKQogICAgbG9jYWwgY2hhciA9IHBsYXllci5DaGFyYWN0ZXIKICAgIGlmIG5vdCBjaGFyIHRoZW4gcmV0dXJuIGZhbHNlIGVuZAogICAgCiAgICBsb2NhbCBocnAgPSBjaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgIGlmIG5vdCBocnAgdGhlbiByZXR1cm4gZmFsc2UgZW5kCiAgICAKICAgIGxvY2FsIG5lYXJlc3RJbmRleCA9IGdldEN1cnJlbnRQb3NpdGlvbkluZGV4KCkKICAgIGxvY2FsIHNhZmVDRnJhbWUgPSBCUkFJTlJPVF9QT1NJVElPTlNbbmVhcmVzdEluZGV4XQogICAgaHJwLkNGcmFtZSA9IHNhZmVDRnJhbWUKICAgIAogICAgLS0gRm9yY2UgY2FjaGUgcmVmcmVzaCBhZnRlciBlc2NhcGUKICAgIHdhdmVDYWNoZS5sYXN0Q2hlY2sgPSAwCiAgICAKICAgIHRhc2sud2FpdCgwLjIpCiAgICByZXR1cm4gdHJ1ZQplbmQKCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi0tIFdBSVQgVU5USUwgV0FWRSBTQUZFCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmxvY2FsIGZ1bmN0aW9uIHdhaXRVbnRpbFdhdmVTYWZlKCkKICAgIHdoaWxlIGF1dG9CcmFpbnJvdEVuYWJsZWQgZG8KICAgICAgICBpZiBub3QgaXNXYXZlQWN0aXZlKCkgdGhlbgogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIGVtZXJnZW5jeVdhdmVFc2NhcGUoKQogICAgICAgIHRhc2sud2FpdChXQVZFX0NIRUNLX0lOVEVSVkFMKQogICAgZW5kCiAgICByZXR1cm4gZmFsc2UKZW5kCgotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLSBPUFRJTUlaRUQ6IFNBRkUgVEVMRVBPUlQgKFJFRFVDRUQgQ0hFQ0tTKQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpsb2NhbCBmdW5jdGlvbiBzYWZlVGVsZXBvcnQodGFyZ2V0Q0ZyYW1lLCBkZXNjcmlwdGlvbiwgY3VzdG9tU3BlZWQpCiAgICAtLSBHZXQgcGxheWVyJ3MgY3VycmVudCBXYWxrU3BlZWQKICAgIGxvY2FsIGNoYXIgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICBpZiBub3QgY2hhciB0aGVuIHJldHVybiBmYWxzZSBlbmQKICAgIAogICAgbG9jYWwgaHJwID0gY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICBpZiBub3QgaHJwIHRoZW4gcmV0dXJuIGZhbHNlIGVuZAogICAgCiAgICBsb2NhbCBodW1hbm9pZCA9IGNoYXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJIdW1hbm9pZCIpCiAgICAKICAgIC0tIENhbGN1bGF0ZSBhZGFwdGl2ZSBzcGVlZAogICAgbG9jYWwgYmFzZVNwZWVkCiAgICBpZiBjdXN0b21TcGVlZCB0aGVuCiAgICAgICAgLS0gVXNlIGN1c3RvbSBzcGVlZCBpZiBwcm92aWRlZAogICAgICAgIGJhc2VTcGVlZCA9IGN1c3RvbVNwZWVkCiAgICBlbHNlaWYgaHVtYW5vaWQgdGhlbgogICAgICAgIC0tIEFkYXB0aXZlOiBtdWx0aXBseSBXYWxrU3BlZWQgYnkgMjUgZm9yIHNtb290aCB0ZWxlcG9ydCBmZWVsCiAgICAgICAgbG9jYWwgd2Fsa1NwZWVkID0gaHVtYW5vaWQuV2Fsa1NwZWVkCiAgICAgICAgYmFzZVNwZWVkID0gd2Fsa1NwZWVkICogMjUKICAgICAgICAKICAgICAgICAtLSBDbGFtcCBiZXR3ZWVuIHJlYXNvbmFibGUgdmFsdWVzCiAgICAgICAgYmFzZVNwZWVkID0gbWF0aC5jbGFtcChiYXNlU3BlZWQsIDIwMCwgODAwKSAtLSBNaW4gMjAwLCBNYXggODAwCiAgICBlbHNlCiAgICAgICAgLS0gRmFsbGJhY2sgaWYgbm8gaHVtYW5vaWQKICAgICAgICBiYXNlU3BlZWQgPSA0MDAKICAgIGVuZAogICAgCiAgICAtLSBTaW5nbGUgcHJlLWNoZWNrCiAgICBpZiBpc1dhdmVBY3RpdmUoKSB0aGVuCiAgICAgICAgaWYgbm90IHdhaXRVbnRpbFdhdmVTYWZlKCkgdGhlbgogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICBlbmQKICAgIGVuZAoKICAgIC0tIEZhc3QgdGVsZXBvcnQgd2l0aCByZWR1Y2VkIGNoZWNrcwogICAgbG9jYWwgY2hlY2tJbnRlcnZhbCA9IDAKICAgIGxvY2FsIGxhc3RQb3MgPSBocnAuUG9zaXRpb24KICAgIGxvY2FsIHN0dWNrQ291bnRlciA9IDAKICAgIAogICAgd2hpbGUgKGhycC5Qb3NpdGlvbiAtIHRhcmdldENGcmFtZS5Qb3NpdGlvbikuTWFnbml0dWRlID4gMiBkbwogICAgICAgIGNoZWNrSW50ZXJ2YWwgPSBjaGVja0ludGVydmFsICsgMQogICAgICAgIAogICAgICAgIC0tIE9ubHkgY2hlY2sgd2F2ZSBldmVyeSAzIGl0ZXJhdGlvbnMgKHJlZHVjZSBsYWcpCiAgICAgICAgaWYgY2hlY2tJbnRlcnZhbCA+PSAzIHRoZW4KICAgICAgICAgICAgaWYgaXNXYXZlQWN0aXZlKCkgdGhlbgogICAgICAgICAgICAgICAgZW1lcmdlbmN5V2F2ZUVzY2FwZSgpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGNoZWNrSW50ZXJ2YWwgPSAwCiAgICAgICAgZW5kCgogICAgICAgIC0tIENhbGN1bGF0ZSBtb3ZlbWVudAogICAgICAgIGxvY2FsIGRpcmVjdGlvbiA9ICh0YXJnZXRDRnJhbWUuUG9zaXRpb24gLSBocnAuUG9zaXRpb24pLlVuaXQKICAgICAgICBsb2NhbCBkaXN0YW5jZSA9ICh0YXJnZXRDRnJhbWUuUG9zaXRpb24gLSBocnAuUG9zaXRpb24pLk1hZ25pdHVkZQogICAgICAgIGxvY2FsIGRlbHRhVGltZSA9IHRhc2sud2FpdCgpCiAgICAgICAgCiAgICAgICAgLS0gTW92ZSB3aXRoIGFkYXB0aXZlIHNwZWVkCiAgICAgICAgaHJwLkNGcmFtZSA9IGhycC5DRnJhbWUgKyBkaXJlY3Rpb24gKiBtYXRoLm1pbihiYXNlU3BlZWQgKiBkZWx0YVRpbWUsIGRpc3RhbmNlKQogICAgICAgIAogICAgICAgIC0tIEFudGktc3R1Y2sgZGV0ZWN0aW9uCiAgICAgICAgaWYgKGhycC5Qb3NpdGlvbiAtIGxhc3RQb3MpLk1hZ25pdHVkZSA8IDAuNSB0aGVuCiAgICAgICAgICAgIHN0dWNrQ291bnRlciA9IHN0dWNrQ291bnRlciArIDEKICAgICAgICAgICAgaWYgc3R1Y2tDb3VudGVyID4gNSB0aGVuCiAgICAgICAgICAgICAgICAtLSBJZiBzdHVjayBmb3IgNSBpdGVyYXRpb25zLCBpbnN0YW50IHRlbGVwb3J0CiAgICAgICAgICAgICAgICBwcmludCgiW1RlbGVwb3J0XSBTdHVjayBkZXRlY3RlZCwgaW5zdGFudCB0ZWxlcG9ydCB0bzoiLCBkZXNjcmlwdGlvbiBvciAidGFyZ2V0IikKICAgICAgICAgICAgICAgIGhycC5DRnJhbWUgPSB0YXJnZXRDRnJhbWUKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGVuZAogICAgICAgIGVsc2UKICAgICAgICAgICAgc3R1Y2tDb3VudGVyID0gMAogICAgICAgIGVuZAogICAgICAgIGxhc3RQb3MgPSBocnAuUG9zaXRpb24KICAgIGVuZAoKICAgIC0tIFNuYXAgdG8gZmluYWwgcG9zaXRpb24KICAgIGhycC5DRnJhbWUgPSB0YXJnZXRDRnJhbWUKICAgIHRhc2sud2FpdCgwLjEpCiAgICAKICAgIHJldHVybiB0cnVlCmVuZAoKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLS0gSU1QUk9WRUQ6IFNFUVVFTlRJQUwgVEVMRVBPUlQgRlJPTSBDVVJSRU5UIFBPU0lUSU9OCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmxvY2FsIGZ1bmN0aW9uIHNlcXVlbnRpYWxUZWxlcG9ydCh0YXJnZXRJbmRleCkKICAgIGxvY2FsIGN1cnJlbnRJbmRleCA9IGdldEN1cnJlbnRQb3NpdGlvbkluZGV4KCkKICAgIAogICAgLS0gSWYgYWxyZWFkeSBhdCB0YXJnZXQsIG5vIG5lZWQgdG8gbW92ZQogICAgaWYgY3VycmVudEluZGV4ID09IHRhcmdldEluZGV4IHRoZW4KICAgICAgICBwcmludCgiW1NlcXVlbnRpYWxdIEFscmVhZHkgYXQgdGFyZ2V0IHBvc2l0aW9uIiwgdGFyZ2V0SW5kZXgpCiAgICAgICAgcmV0dXJuIHRydWUKICAgIGVuZAogICAgCiAgICBwcmludCgiW1NlcXVlbnRpYWxdIE1vdmluZyBmcm9tIHBvc2l0aW9uIiwgY3VycmVudEluZGV4LCAidG8iLCB0YXJnZXRJbmRleCkKICAgIAogICAgLS0gRGV0ZXJtaW5lIGRpcmVjdGlvbiAoZm9yd2FyZCBvciBiYWNrd2FyZCkKICAgIGlmIHRhcmdldEluZGV4ID4gY3VycmVudEluZGV4IHRoZW4KICAgICAgICAtLSBNb3ZpbmcgZm9yd2FyZAogICAgICAgIGZvciBpID0gY3VycmVudEluZGV4ICsgMSwgdGFyZ2V0SW5kZXggZG8KICAgICAgICAgICAgcHJpbnQoIltTZXF1ZW50aWFsXSBUZWxlcG9ydGluZyB0byBwb3NpdGlvbiIsIGkpCiAgICAgICAgICAgIGlmIG5vdCBzYWZlVGVsZXBvcnQoQlJBSU5ST1RfUE9TSVRJT05TW2ldLCAiUG9zaXRpb24gIiAuLiBpKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgLS0gTW92aW5nIGJhY2t3YXJkCiAgICAgICAgZm9yIGkgPSBjdXJyZW50SW5kZXggLSAxLCB0YXJnZXRJbmRleCwgLTEgZG8KICAgICAgICAgICAgcHJpbnQoIltTZXF1ZW50aWFsXSBUZWxlcG9ydGluZyB0byBwb3NpdGlvbiIsIGkpCiAgICAgICAgICAgIGlmIG5vdCBzYWZlVGVsZXBvcnQoQlJBSU5ST1RfUE9TSVRJT05TW2ldLCAiUG9zaXRpb24gIiAuLiBpKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgcHJpbnQoIltTZXF1ZW50aWFsXSBTdWNjZXNzZnVsbHkgcmVhY2hlZCBwb3NpdGlvbiIsIHRhcmdldEluZGV4KQogICAgcmV0dXJuIHRydWUKZW5kCgotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQotLSBJTVBST1ZFRDogVEVMRVBPUlQgVE8gQlJBSU5ST1QgKFdJVEggUFJPUEVSIFNFUVVFTlRJQUwpCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmxvY2FsIGZ1bmN0aW9uIHRlbGVwb3J0VG9CcmFpbnJvdChicmFpbnJvdE1vZGVsKQogICAgaWYgaXNXYXZlQWN0aXZlKCkgdGhlbgogICAgICAgIGlmIG5vdCB3YWl0VW50aWxXYXZlU2FmZSgpIHRoZW4KICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICAtLSBDUklUSUNBTDogVmFsaWRhdGUgYnJhaW5yb3QgQkVGT1JFIHN0YXJ0aW5nIHRlbGVwb3J0CiAgICBpZiBub3QgYnJhaW5yb3RNb2RlbCBvciBub3QgYnJhaW5yb3RNb2RlbC5QYXJlbnQgdGhlbgogICAgICAgIHByaW50KCJbVGVsZXBvcnRdIEJyYWlucm90IGRpc2FwcGVhcmVkIGJlZm9yZSB0ZWxlcG9ydCEiKQogICAgICAgIHJldHVybiBmYWxzZQogICAgZW5kCgogICAgbG9jYWwgcm9vdCA9IGJyYWlucm90TW9kZWw6RmluZEZpcnN0Q2hpbGQoIlJvb3QiKQogICAgaWYgbm90IHJvb3Qgb3Igbm90IHJvb3QuUGFyZW50IHRoZW4KICAgICAgICBwcmludCgiW1RlbGVwb3J0XSBCcmFpbnJvdCBSb290IG1pc3NpbmchIikKICAgICAgICByZXR1cm4gZmFsc2UKICAgIGVuZAogICAgCiAgICBsb2NhbCBjaGFyID0gcGxheWVyLkNoYXJhY3RlcgogICAgaWYgbm90IGNoYXIgdGhlbiByZXR1cm4gZmFsc2UgZW5kCiAgICAKICAgIGxvY2FsIGhycCA9IGNoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgaWYgbm90IGhycCB0aGVuIHJldHVybiBmYWxzZSBlbmQKICAgIAogICAgLS0gU1RFUCAxOiBGaW5kIG5lYXJlc3QgYnJhaW5yb3QgcG9zaXRpb24gdG8gdGhlIHBsYXllcidzIENVUlJFTlQgbG9jYXRpb24KICAgIGxvY2FsIGN1cnJlbnROZWFyZXN0SW5kZXggPSBnZXRDdXJyZW50UG9zaXRpb25JbmRleCgpCiAgICBwcmludCgiW1RlbGVwb3J0XSBDdXJyZW50IG5lYXJlc3QgcG9zaXRpb24gdG8gcGxheWVyOiIsIGN1cnJlbnROZWFyZXN0SW5kZXgpCiAgICAKICAgIC0tIFNURVAgMjogRmluZCBuZWFyZXN0IGJyYWlucm90IHBvc2l0aW9uIHRvIHRoZSBUQVJHRVQgYnJhaW5yb3QKICAgIGxvY2FsIHRhcmdldE5lYXJlc3RJbmRleCA9IGdldE5lYXJlc3RCcmFpbnJvdFBvc2l0aW9uSW5kZXgocm9vdC5Qb3NpdGlvbikKICAgIHByaW50KCJbVGVsZXBvcnRdIFRhcmdldCBicmFpbnJvdCBpcyBuZWFyZXN0IHRvIHBvc2l0aW9uOiIsIHRhcmdldE5lYXJlc3RJbmRleCkKICAgIAogICAgLS0gU1RFUCAzOiBJZiB0aGV5J3JlIHRoZSBzYW1lLCB3ZSdyZSBhbHJlYWR5IGluIHRoZSByaWdodCBhcmVhCiAgICBpZiBjdXJyZW50TmVhcmVzdEluZGV4ID09IHRhcmdldE5lYXJlc3RJbmRleCB0aGVuCiAgICAgICAgcHJpbnQoIltUZWxlcG9ydF0gQWxyZWFkeSBpbiBjb3JyZWN0IHpvbmUgZm9yIHRoaXMgYnJhaW5yb3QiKQogICAgZWxzZQogICAgICAgIC0tIFNURVAgNDogVGVsZXBvcnQgc2VxdWVudGlhbGx5IGZyb20gY3VycmVudCBwb3NpdGlvbiB0byB0YXJnZXQgcG9zaXRpb24KICAgICAgICBwcmludCgiW1RlbGVwb3J0XSBOZWVkIHRvIG1vdmUgZnJvbSB6b25lIiwgY3VycmVudE5lYXJlc3RJbmRleCwgInRvIHpvbmUiLCB0YXJnZXROZWFyZXN0SW5kZXgpCiAgICAgICAgCiAgICAgICAgaWYgbm90IHNlcXVlbnRpYWxUZWxlcG9ydCh0YXJnZXROZWFyZXN0SW5kZXgpIHRoZW4KICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgLS0gUkUtVkFMSURBVEU6IEJyYWlucm90IG1hc2loIGFkYSBzZXRlbGFoIHNlcXVlbnRpYWwgdGVsZXBvcnQ/CiAgICBpZiBub3QgYnJhaW5yb3RNb2RlbC5QYXJlbnQgb3Igbm90IHJvb3QuUGFyZW50IHRoZW4KICAgICAgICBwcmludCgiW1RlbGVwb3J0XSBCcmFpbnJvdCBkaXNhcHBlYXJlZCBkdXJpbmcgc2VxdWVudGlhbCB0ZWxlcG9ydCEiKQogICAgICAgIHJldHVybiBmYWxzZQogICAgZW5kCiAgICAKICAgIHRhc2sud2FpdCgwLjEpCiAgICAKICAgIC0tIFNURVAgNTogRmluYWwgYXBwcm9hY2ggdG8gYnJhaW5yb3QgKHNtYXJ0IG9mZnNldCkKICAgIGxvY2FsIGN1cnJlbnRQb3MgPSBocnAuUG9zaXRpb24KICAgIGxvY2FsIGRpcmVjdGlvblRvUGxheWVyID0gKGN1cnJlbnRQb3MgLSByb290LlBvc2l0aW9uKS5Vbml0CiAgICBsb2NhbCBvZmZzZXRQb3NpdGlvbiA9IHJvb3QuUG9zaXRpb24gKyAoZGlyZWN0aW9uVG9QbGF5ZXIgKiAzKSAtLSAzIHN0dWRzIGluIGZyb250CiAgICAKICAgIC0tIEZhY2UgdGhlIGJyYWlucm90CiAgICBsb2NhbCBicmFpbnJvdENGcmFtZSA9IENGcmFtZS5uZXcob2Zmc2V0UG9zaXRpb24sIHJvb3QuUG9zaXRpb24pCiAgICAKICAgIC0tIEZJTkFMIFZBTElEQVRJT04gYmVmb3JlIHRlbGVwb3J0CiAgICBpZiBub3QgYnJhaW5yb3RNb2RlbC5QYXJlbnQgb3Igbm90IHJvb3QuUGFyZW50IHRoZW4KICAgICAgICBwcmludCgiW1RlbGVwb3J0XSBCcmFpbnJvdCBkaXNhcHBlYXJlZCBiZWZvcmUgZmluYWwgdGVsZXBvcnQhIikKICAgICAgICByZXR1cm4gZmFsc2UKICAgIGVuZAogICAgCiAgICBpZiBub3Qgc2FmZVRlbGVwb3J0KGJyYWlucm90Q0ZyYW1lLCAiQnJhaW5yb3QgKEZpbmFsKSIsIDQwMCkgdGhlbgogICAgICAgIHJldHVybiBmYWxzZQogICAgZW5kCiAgICAKICAgIHJldHVybiB0cnVlCmVuZAoKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLS0gVEVMRVBPUlQgQkFDSyBUTyBIT01FIChTRVFVRU5USUFMKQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpsb2NhbCBmdW5jdGlvbiB0ZWxlcG9ydEJhY2tUb0hvbWUoKQogICAgaWYgbm90IGlzSG9sZGluZ0JyYWlucm90KCkgdGhlbgogICAgICAgIHJldHVybiBmYWxzZQogICAgZW5kCiAgICAKICAgIHByaW50KCJbUmV0dXJuXSBUZWxlcG9ydGluZyBiYWNrIHRvIGhvbWUuLi4iKQogICAgCiAgICAtLSBTZXF1ZW50aWFsIHRlbGVwb3J0IHRvIHBvc2l0aW9uIDEgZmlyc3QKICAgIGlmIG5vdCBzZXF1ZW50aWFsVGVsZXBvcnQoMSkgdGhlbgogICAgICAgIHJldHVybiBmYWxzZQogICAgZW5kCiAgICAKICAgIHRhc2sud2FpdCgwLjEpCiAgICAKICAgIC0tIFRoZW4gZmluYWwgdGVsZXBvcnQgdG8gZXhhY3QgaG9tZSBwb3NpdGlvbgogICAgaWYgbm90IHNhZmVUZWxlcG9ydChGSU5BTF9SRVRVUk5fQ0ZSQU1FLCAiSG9tZSIpIHRoZW4KICAgICAgICByZXR1cm4gZmFsc2UKICAgIGVuZAogICAgCiAgICByZXR1cm4gdHJ1ZQplbmQKCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi0tIFJFU1BBV04gSEFORExFUgotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpsb2NhbCBmdW5jdGlvbiBzZXR1cFJlc3Bhd25IYW5kbGVyKCkKICAgIHBsYXllci5DaGFyYWN0ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGNoYXIpCiAgICAgICAgaWYgYXV0b0JyYWlucm90RW5hYmxlZCB0aGVuCiAgICAgICAgICAgIC0tIENsZWFyIGNhY2hlcyBvbiByZXNwYXduCiAgICAgICAgICAgIHdhdmVDYWNoZS53YXZlUGFydHMgPSB7fQogICAgICAgICAgICB3YXZlQ2FjaGUubGFzdENoZWNrID0gMAogICAgICAgICAgICBicmFpbnJvdENhY2hlLmxhc3RTY2FuID0gMAogICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgaHJwID0gY2hhcjpXYWl0Rm9yQ2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiLCA1KQogICAgICAgICAgICBpZiBocnAgdGhlbgogICAgICAgICAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgICAgICAgICBocnAuQ0ZyYW1lID0gQlJBSU5ST1RfUE9TSVRJT05TWzFdCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4zKQogICAgICAgICAgICAgICAgaHJwLkNGcmFtZSA9IEZJTkFMX1JFVFVSTl9DRlJBTUUKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZAoKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLS0gTUFJTiBGQVJNIExPT1AKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KbG9jYWwgZnVuY3Rpb24gcnVuQnJhaW5yb3RGYXJtKCkKICAgIHByaW50KCJbQXV0byBGYXJtXSBTdGFydGVkIChPcHRpbWl6ZWQgd2l0aCBTZXF1ZW50aWFsIFRlbGVwb3J0KSIpCiAgICAKICAgIHNldHVwUmVzcGF3bkhhbmRsZXIoKQogICAgCiAgICAtLSBCdWlsZCBpbml0aWFsIHdhdmUgY2FjaGUKICAgIHJlYnVpbGRXYXZlQ2FjaGUoKQogICAgCiAgICAtLSBJbml0IHlvdXIgZnVuY3Rpb25zIGlmIHRoZXkgZXhpc3QKICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICByZW1vdmVWSVBNb2RlbHMoKQogICAgICAgIFdhbGxEZWxldGUoKQogICAgICAgIHJlbW92ZU1hcFdhbGxzKCkKICAgICAgICBlbmFibGVHb2RNb2RlV2FsbCgpCiAgICAgICAgZW5hYmxlSW5zdGFudFByb3hpbWl0eVByb21wdCgpCiAgICAgICAgZW5hYmxlTWFnbmV0UHJveGltaXR5UHJvbXB0KCkKICAgIGVuZCkKCiAgICB3aGlsZSBhdXRvQnJhaW5yb3RFbmFibGVkIGRvCiAgICAgICAgaWYgbm90IHdhaXRVbnRpbFdhdmVTYWZlKCkgdGhlbiBicmVhayBlbmQKCiAgICAgICAgbG9jYWwgYnJhaW5yb3QgPSBnZXROZWFyZXN0QnJhaW5yb3QoKQogICAgICAgIGlmIG5vdCBicmFpbnJvdCB0aGVuCiAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgICAgICBjb250aW51ZQogICAgICAgIGVuZAoKICAgICAgICBpZiBub3QgdGVsZXBvcnRUb0JyYWlucm90KGJyYWlucm90KSB0aGVuCiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgLS0gVGFrZSBicmFpbnJvdAogICAgICAgIGxvY2FsIGF0dGVtcHRDb3VudCA9IDAKICAgICAgICB3aGlsZSBub3QgaXNIb2xkaW5nQnJhaW5yb3QoKSBhbmQgYXR0ZW1wdENvdW50IDwgOCBkbwogICAgICAgICAgICBpZiBpc1dhdmVBY3RpdmUoKSB0aGVuCiAgICAgICAgICAgICAgICBlbWVyZ2VuY3lXYXZlRXNjYXBlKCkKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgdGFrZUJyYWlucm90KGJyYWlucm90KQogICAgICAgICAgICBhdHRlbXB0Q291bnQgPSBhdHRlbXB0Q291bnQgKyAxCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjcpCiAgICAgICAgZW5kCgogICAgICAgIGlmIG5vdCBpc0hvbGRpbmdCcmFpbnJvdCgpIHRoZW4KICAgICAgICAgICAgY29udGludWUKICAgICAgICBlbmQKCiAgICAgICAgaWYgbm90IHRlbGVwb3J0QmFja1RvSG9tZSgpIHRoZW4KICAgICAgICAgICAgdGFzay53YWl0KDAuNSkKICAgICAgICAgICAgY29udGludWUKICAgICAgICBlbmQKCiAgICAgICAgdGFzay53YWl0KDAuMykKICAgIGVuZAoKICAgIHByaW50KCJbQXV0byBGYXJtXSBTdG9wcGVkIikKICAgIAogICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgIGRpc2FibGVJbnN0YW50UHJveGltaXR5UHJvbXB0KCkKICAgICAgICBkaXNhYmxlTWFnbmV0UHJveGltaXR5UHJvbXB0KCkKICAgIGVuZCkKICAgIAogICAgYXV0b0JyYWlucm90VGhyZWFkID0gbmlsCmVuZAoKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLS0gUFVCTElDIEFQSQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpsb2NhbCBCcmFpbnJvdEZhcm0gPSB7CiAgICB0b2dnbGUgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICBpZiBzdGF0ZSB+PSBuaWwgdGhlbgogICAgICAgICAgICBhdXRvQnJhaW5yb3RFbmFibGVkID0gc3RhdGUKICAgICAgICBlbHNlCiAgICAgICAgICAgIGF1dG9CcmFpbnJvdEVuYWJsZWQgPSBub3QgYXV0b0JyYWlucm90RW5hYmxlZAogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIGlmIGF1dG9CcmFpbnJvdEVuYWJsZWQgdGhlbgogICAgICAgICAgICBpZiBhdXRvQnJhaW5yb3RUaHJlYWQgdGhlbgogICAgICAgICAgICAgICAgdGFzay5jYW5jZWwoYXV0b0JyYWlucm90VGhyZWFkKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgYXV0b0JyYWlucm90VGhyZWFkID0gdGFzay5zcGF3bihydW5CcmFpbnJvdEZhcm0pCiAgICAgICAgZW5kCiAgICAgICAgcmV0dXJuIGF1dG9CcmFpbnJvdEVuYWJsZWQKICAgIGVuZCwKICAgIAogICAgc2V0UmFyaXR5ID0gZnVuY3Rpb24ocmFyaXR5KQogICAgICAgIHNlbGVjdGVkUmFyaXR5ID0gcmFyaXR5CiAgICAgICAgYnJhaW5yb3RDYWNoZS5sYXN0U2NhbiA9IDAgLS0gRm9yY2UgcmVzY2FuCiAgICAgICAgcmV0dXJuIHRydWUKICAgIGVuZCwKICAgIAogICAgZ2V0UmFyaXR5ID0gZnVuY3Rpb24oKQogICAgICAgIHJldHVybiBzZWxlY3RlZFJhcml0eQogICAgZW5kLAogICAgCiAgICBpc0FjdGl2ZSA9IGZ1bmN0aW9uKCkKICAgICAgICByZXR1cm4gYXV0b0JyYWlucm90RW5hYmxlZAogICAgZW5kLAogICAgCiAgICByZWJ1aWxkV2F2ZUNhY2hlID0gcmVidWlsZFdhdmVDYWNoZSAtLSBNYW51YWwgY2FjaGUgcmVidWlsZCBpZiBuZWVkZWQKfQotLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci0tIENPTkZJRwotLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CmxvY2FsIGlzQ29uc29sZUNvbGxlY3RpbmcgPSBmYWxzZQpsb2NhbCBjb25zb2xlQ29sbGVjdGlvblJhbmdlID0gNjUKbG9jYWwgY29uc29sZUNvbGxlY3RDb29sZG93biA9IDAuMwpsb2NhbCBjb25zb2xlVGVsZXBvcnRIZWlnaHQgPSAzCmxvY2FsIGNvbnNvbGVTZWFyY2hEZXB0aCA9IDUwMCAtLSBCYXRhc2FuIHBlbmNhcmlhbgoKLS09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQotLSBTVEFURQotLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CmxvY2FsIGF2YWlsYWJsZUNvbnNvbGVzID0ge30KbG9jYWwgcHJvY2Vzc2VkQ29uc29sZXMgPSB7fQpsb2NhbCBjb25zb2xlQ29vbGRvd25UcmFja2VyID0ge30KCmxvY2FsIGNvbnNvbGVDb2xsZWN0aW9uVGFzawpsb2NhbCBjb25zb2xlVXBkYXRlTGluawpsb2NhbCB2aXN1YWxSYW5nZUluZGljYXRvcgoKbG9jYWwgbGFzdENvbnNvbGVDb2xsZWN0VGltZSA9IDAKbG9jYWwgbGFzdENvbnNvbGVTY2FuVGltZSA9IDAKbG9jYWwgQ09OU09MRV9TQ0FOX0lOVEVSVkFMID0gNQpsb2NhbCBDT05TT0xFX1JFRlJFU0hfSU5URVJWQUwgPSAxCgotLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci0tIFVUSUxJVFkgRlVOQ1RJT05TCi0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KbG9jYWwgZnVuY3Rpb24gZ2V0VGFibGVMZW5ndGgodGJsKQogICAgbG9jYWwgY291bnQgPSAwCiAgICBmb3IgXyBpbiBwYWlycyh0YmwpIGRvIGNvdW50ICs9IDEgZW5kCiAgICByZXR1cm4gY291bnQKZW5kCgpsb2NhbCBmdW5jdGlvbiBnZXRQbGF5ZXJSb290UGFydCgpCiAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICBpZiBub3QgY2hhcmFjdGVyIHRoZW4gcmV0dXJuIG5pbCBlbmQKICAgIGxvY2FsIGh1bWFub2lkUm9vdFBhcnQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBvciBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlRvcnNvIikKICAgIHJldHVybiBodW1hbm9pZFJvb3RQYXJ0CmVuZAoKbG9jYWwgZnVuY3Rpb24gZ2V0UGxheWVySHVtYW5vaWQoKQogICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlcgogICAgaWYgbm90IGNoYXJhY3RlciB0aGVuIHJldHVybiBuaWwgZW5kCiAgICByZXR1cm4gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpCmVuZAoKLS09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQotLSBWSVNVQUwgUkFOR0UgSU5ESUNBVE9SIChTQUZFICYgSU1QUk9WRUQpCi0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KbG9jYWwgZnVuY3Rpb24gcmVtb3ZlVmlzdWFsSW5kaWNhdG9yKCkKICAgIGlmIGNvbnNvbGVVcGRhdGVMaW5rIHRoZW4KICAgICAgICBjb25zb2xlVXBkYXRlTGluazpEaXNjb25uZWN0KCkKICAgICAgICBjb25zb2xlVXBkYXRlTGluayA9IG5pbAogICAgZW5kCgogICAgaWYgdmlzdWFsUmFuZ2VJbmRpY2F0b3IgdGhlbgogICAgICAgIGxvY2FsIGluZGljYXRvclBhcnRzID0gdmlzdWFsUmFuZ2VJbmRpY2F0b3I6R2V0Q2hpbGRyZW4oKQogICAgICAgIGZvciBfLCBwYXJ0IGluIGlwYWlycyhpbmRpY2F0b3JQYXJ0cykgZG8KICAgICAgICAgICAgbG9jYWwgZmFkZVR3ZWVuID0gVHdlZW5TZXJ2aWNlOkNyZWF0ZSgKICAgICAgICAgICAgICAgIHBhcnQsCiAgICAgICAgICAgICAgICBUd2VlbkluZm8ubmV3KDAuMyksCiAgICAgICAgICAgICAgICB7IFRyYW5zcGFyZW5jeSA9IDEgfQogICAgICAgICAgICApCiAgICAgICAgICAgIGZhZGVUd2VlbjpQbGF5KCkKICAgICAgICAgICAgZmFkZVR3ZWVuLkNvbXBsZXRlZDpPbmNlKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHBhcnQ6RGVzdHJveSgpCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKICAgICAgICB2aXN1YWxSYW5nZUluZGljYXRvcjpEZXN0cm95KCkKICAgICAgICB2aXN1YWxSYW5nZUluZGljYXRvciA9IG5pbAogICAgZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gY3JlYXRlVmlzdWFsUmFuZ2VJbmRpY2F0b3IoKQogICAgcmVtb3ZlVmlzdWFsSW5kaWNhdG9yKCkKCiAgICBsb2NhbCByb290UGFydCA9IGdldFBsYXllclJvb3RQYXJ0KCkKICAgIGlmIG5vdCByb290UGFydCB0aGVuIHJldHVybiBlbmQKCiAgICAtLSBDcmVhdGUgY29udGFpbmVyIG1vZGVsCiAgICBsb2NhbCBpbmRpY2F0b3JNb2RlbCA9IEluc3RhbmNlLm5ldygiTW9kZWwiKQogICAgaW5kaWNhdG9yTW9kZWwuTmFtZSA9ICJDb25zb2xlQ29sbGVjdFJhbmdlSW5kaWNhdG9yIgogICAgaW5kaWNhdG9yTW9kZWwuUGFyZW50ID0gV29ya3NwYWNlCiAgICAKICAgIHZpc3VhbFJhbmdlSW5kaWNhdG9yID0gaW5kaWNhdG9yTW9kZWwKCiAgICAtLSBNYWluIGluZGljYXRvciBwYXJ0CiAgICBsb2NhbCBpbmRpY2F0b3JQYXJ0ID0gSW5zdGFuY2UubmV3KCJQYXJ0IikKICAgIGluZGljYXRvclBhcnQuTmFtZSA9ICJDb25zb2xlQ29sbGVjdFJhbmdlIgogICAgaW5kaWNhdG9yUGFydC5BbmNob3JlZCA9IHRydWUKICAgIGluZGljYXRvclBhcnQuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICBpbmRpY2F0b3JQYXJ0LkNhblF1ZXJ5ID0gZmFsc2UKICAgIGluZGljYXRvclBhcnQuQ2FuVG91Y2ggPSBmYWxzZQogICAgaW5kaWNhdG9yUGFydC5NYXRlcmlhbCA9IEVudW0uTWF0ZXJpYWwuTmVvbgogICAgaW5kaWNhdG9yUGFydC5Db2xvciA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMTAwLCAwKSAtLSBPcmFuZ2UgZm9yIGNvbnNvbGUKICAgIGluZGljYXRvclBhcnQuVHJhbnNwYXJlbmN5ID0gMC42CiAgICBpbmRpY2F0b3JQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyhjb25zb2xlQ29sbGVjdGlvblJhbmdlICogMiwgMC4xLCBjb25zb2xlQ29sbGVjdGlvblJhbmdlICogMikKICAgIGluZGljYXRvclBhcnQuUGFyZW50ID0gaW5kaWNhdG9yTW9kZWwKCiAgICAtLSBPdXRsaW5lIGZvciBiZXR0ZXIgdmlzaWJpbGl0eQogICAgbG9jYWwgb3V0bGluZVBhcnQgPSBpbmRpY2F0b3JQYXJ0OkNsb25lKCkKICAgIG91dGxpbmVQYXJ0Lk5hbWUgPSAiQ29uc29sZUNvbGxlY3RSYW5nZV9PdXRsaW5lIgogICAgb3V0bGluZVBhcnQuQ29sb3IgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDIwMCwgMCkgLS0gWWVsbG93IG91dGxpbmUKICAgIG91dGxpbmVQYXJ0LlRyYW5zcGFyZW5jeSA9IDAuNAogICAgb3V0bGluZVBhcnQuU2l6ZSA9IG91dGxpbmVQYXJ0LlNpemUgKyBWZWN0b3IzLm5ldygwLjI1LCAwLCAwLjI1KQogICAgb3V0bGluZVBhcnQuUGFyZW50ID0gaW5kaWNhdG9yTW9kZWwKCiAgICAtLSBBZGQgY3lsaW5kZXIgbWVzaCBmb3IgYmV0dGVyIGFwcGVhcmFuY2UKICAgIGxvY2FsIGN5bGluZGVyTWVzaCA9IEluc3RhbmNlLm5ldygiQ3lsaW5kZXJNZXNoIikKICAgIGN5bGluZGVyTWVzaC5TY2FsZSA9IFZlY3RvcjMubmV3KDEsIDAuMDYsIDEpCiAgICBjeWxpbmRlck1lc2guUGFyZW50ID0gaW5kaWNhdG9yUGFydAoKICAgIC0tIFVwZGF0ZSBwb3NpdGlvbiB3aXRoIHBsYXllcgogICAgY29uc29sZVVwZGF0ZUxpbmsgPSBSdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgbG9jYWwgY3VycmVudFJvb3QgPSBnZXRQbGF5ZXJSb290UGFydCgpCiAgICAgICAgaWYgbm90IGN1cnJlbnRSb290IG9yIG5vdCB2aXN1YWxSYW5nZUluZGljYXRvciBvciBub3QgdmlzdWFsUmFuZ2VJbmRpY2F0b3IuUGFyZW50IHRoZW4gCiAgICAgICAgICAgIHJlbW92ZVZpc3VhbEluZGljYXRvcigpCiAgICAgICAgICAgIHJldHVybiAKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBsb2NhbCBwYXJ0cyA9IHZpc3VhbFJhbmdlSW5kaWNhdG9yOkdldENoaWxkcmVuKCkKICAgICAgICBmb3IgXywgcGFydCBpbiBpcGFpcnMocGFydHMpIGRvCiAgICAgICAgICAgIGlmIHBhcnQ6SXNBKCJCYXNlUGFydCIpIHRoZW4KICAgICAgICAgICAgICAgIHBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyhjdXJyZW50Um9vdC5Qb3NpdGlvbiAtIFZlY3RvcjMubmV3KDAsIDMsIDApKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kCgotLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci0tIENPTlNPTEUgREVURUNUSU9OICYgQ0FDSElORyAoSU1QUk9WRUQpCi0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KbG9jYWwgZnVuY3Rpb24gc2NhbkZvckNvbnNvbGVzKCkKICAgIGF2YWlsYWJsZUNvbnNvbGVzID0ge30KICAgIAogICAgLS0gQ2xlYW51cCBvbGQgcHJvY2Vzc2VkIGNvbnNvbGVzIChvbGRlciB0aGFuIDUgbWludXRlcykKICAgIGxvY2FsIGN1cnJlbnRUaW1lID0gdGljaygpCiAgICBmb3IgY29uc29sZUlkLCB0aW1lU3RhbXAgaW4gcGFpcnMocHJvY2Vzc2VkQ29uc29sZXMpIGRvCiAgICAgICAgaWYgY3VycmVudFRpbWUgLSB0aW1lU3RhbXAgPiAzMDAgdGhlbiAtLSA1IG1pbnV0ZXMKICAgICAgICAgICAgcHJvY2Vzc2VkQ29uc29sZXNbY29uc29sZUlkXSA9IG5pbAogICAgICAgIGVuZAogICAgZW5kCiAgICAKICAgIC0tIFNlYXJjaCBpbiBrbm93biBjb25zb2xlIGZvbGRlcnMKICAgIGxvY2FsIGNvbnNvbGVGb2xkZXJOYW1lcyA9IHsKICAgICAgICAiQXJjYWRlRXZlbnRDb25zb2xlcyIsCiAgICAgICAgIkNvbnNvbGVzIiwKICAgICAgICAiQXJjYWRlQ29uc29sZXMiLCAKICAgICAgICAiR2FtZUNvbnNvbGVzIiwKICAgICAgICAiRXZlbnRDb25zb2xlcyIKICAgIH0KICAgIAogICAgZm9yIF8sIGZvbGRlck5hbWUgaW4gaXBhaXJzKGNvbnNvbGVGb2xkZXJOYW1lcykgZG8KICAgICAgICBsb2NhbCB0YXJnZXRGb2xkZXIgPSBXb3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQoZm9sZGVyTmFtZSkKICAgICAgICBpZiB0YXJnZXRGb2xkZXIgdGhlbgogICAgICAgICAgICBmb3IgXywgbW9kZWwgaW4gaXBhaXJzKHRhcmdldEZvbGRlcjpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgaWYgbW9kZWw6SXNBKCJNb2RlbCIpIGFuZCAjYXZhaWxhYmxlQ29uc29sZXMgPCBjb25zb2xlU2VhcmNoRGVwdGggdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIG1haW5QYXJ0ID0gbW9kZWw6RmluZEZpcnN0Q2hpbGRXaGljaElzQSgiQmFzZVBhcnQiKQogICAgICAgICAgICAgICAgICAgIGlmIG1haW5QYXJ0IGFuZCBtYWluUGFydDpGaW5kRmlyc3RDaGlsZFdoaWNoSXNBKCJUb3VjaFRyYW5zbWl0dGVyIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBjb25zb2xlSWQgPSBtb2RlbDpHZXRBdHRyaWJ1dGUoIkNvbnNvbGVJRCIpIG9yIG1vZGVsLk5hbWUgLi4gIl8iIC4uIG1vZGVsOkdldERlYnVnSWQoKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgcHJvY2Vzc2VkQ29uc29sZXNbY29uc29sZUlkXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoYXZhaWxhYmxlQ29uc29sZXMsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNb2RlbE9iamVjdCA9IG1vZGVsLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRvdWNoUGFydCA9IG1haW5QYXJ0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbnNvbGVJZGVudGlmaWVyID0gY29uc29sZUlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gbWFpblBhcnQuUG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTGFzdENoZWNrZWQgPSBjdXJyZW50VGltZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgLS0gQWx0ZXJuYXRpdmUgc2VhcmNoIGluIGVudGlyZSB3b3Jrc3BhY2UgKHdpdGggbGltaXQpCiAgICBpZiBnZXRUYWJsZUxlbmd0aChhdmFpbGFibGVDb25zb2xlcykgPT0gMCB0aGVuCiAgICAgICAgbG9jYWwgc2VhcmNoQ291bnQgPSAwCiAgICAgICAgZm9yIF8sIGl0ZW0gaW4gaXBhaXJzKFdvcmtzcGFjZTpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICBpZiBzZWFyY2hDb3VudCA+PSBjb25zb2xlU2VhcmNoRGVwdGggdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGl0ZW06SXNBKCJCYXNlUGFydCIpIGFuZCBpdGVtOkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIlRvdWNoVHJhbnNtaXR0ZXIiKSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBpdGVtTmFtZSA9IGl0ZW0uTmFtZTpsb3dlcigpCiAgICAgICAgICAgICAgICBpZiBpdGVtTmFtZTpmaW5kKCJjb25zb2xlIikgb3IgaXRlbU5hbWU6ZmluZCgiYXJjYWRlIikgb3IgaXRlbU5hbWU6ZmluZCgiZ2FtZSIpIG9yIGl0ZW1OYW1lOmZpbmQoIm1hY2hpbmUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcGFyZW50TW9kZWwgPSBpdGVtOkZpbmRGaXJzdEFuY2VzdG9yV2hpY2hJc0EoIk1vZGVsIikKICAgICAgICAgICAgICAgICAgICBpZiBwYXJlbnRNb2RlbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGNvbnNvbGVJZCA9IHBhcmVudE1vZGVsOkdldEF0dHJpYnV0ZSgiQ29uc29sZUlEIikgb3IgcGFyZW50TW9kZWwuTmFtZSAuLiAiXyIgLi4gcGFyZW50TW9kZWw6R2V0RGVidWdJZCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBwcm9jZXNzZWRDb25zb2xlc1tjb25zb2xlSWRdIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChhdmFpbGFibGVDb25zb2xlcywgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1vZGVsT2JqZWN0ID0gcGFyZW50TW9kZWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVG91Y2hQYXJ0ID0gaXRlbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb25zb2xlSWRlbnRpZmllciA9IGNvbnNvbGVJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGl0ZW0uUG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTGFzdENoZWNrZWQgPSBjdXJyZW50VGltZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaENvdW50ICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgbGFzdENvbnNvbGVTY2FuVGltZSA9IHRpY2soKQogICAgcHJpbnQoc3RyaW5nLmZvcm1hdCgiW0NvbnNvbGVDb2xsZWN0XSBGb3VuZCAlZCBjb25zb2xlcyB8IFRvdGFsIHByb2Nlc3NlZDogJWQiLCAKICAgICAgICBnZXRUYWJsZUxlbmd0aChhdmFpbGFibGVDb25zb2xlcyksIGdldFRhYmxlTGVuZ3RoKHByb2Nlc3NlZENvbnNvbGVzKSkpCmVuZAoKLS09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQotLSBDT05TT0xFIENPTExFQ1RJT04gTUVUSE9EIChTVEFCTEUgJiBPUFRJTUlaRUQpCi0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KbG9jYWwgZnVuY3Rpb24gYXR0ZW1wdENvbnNvbGVDb2xsZWN0aW9uKGNvbnNvbGVEYXRhKQogICAgaWYgbm90IGNvbnNvbGVEYXRhIG9yIG5vdCBjb25zb2xlRGF0YS5Nb2RlbE9iamVjdCBvciBub3QgY29uc29sZURhdGEuTW9kZWxPYmplY3QuUGFyZW50IHRoZW4gCiAgICAgICAgcmV0dXJuIGZhbHNlIAogICAgZW5kCiAgICAKICAgIC0tIENoZWNrIGNvb2xkb3duIGZvciB0aGlzIHNwZWNpZmljIGNvbnNvbGUKICAgIGlmIGNvbnNvbGVDb29sZG93blRyYWNrZXJbY29uc29sZURhdGEuQ29uc29sZUlkZW50aWZpZXJdIGFuZCAKICAgICAgIHRpY2soKSAtIGNvbnNvbGVDb29sZG93blRyYWNrZXJbY29uc29sZURhdGEuQ29uc29sZUlkZW50aWZpZXJdIDwgMS41IHRoZW4KICAgICAgICByZXR1cm4gZmFsc2UKICAgIGVuZAoKICAgIGxvY2FsIHBsYXllclJvb3QgPSBnZXRQbGF5ZXJSb290UGFydCgpCiAgICBsb2NhbCBwbGF5ZXJIdW1hbm9pZCA9IGdldFBsYXllckh1bWFub2lkKCkKICAgIAogICAgaWYgbm90IHBsYXllclJvb3Qgb3Igbm90IHBsYXllckh1bWFub2lkIHRoZW4gCiAgICAgICAgcmV0dXJuIGZhbHNlIAogICAgZW5kCiAgICAKICAgIC0tIFNhZmV0eSBjaGVjawogICAgaWYgcGxheWVySHVtYW5vaWQuSGVhbHRoIDw9IDAgb3IgcGxheWVySHVtYW5vaWQ6R2V0U3RhdGUoKSA9PSBFbnVtLkh1bWFub2lkU3RhdGVUeXBlLkRlYWQgdGhlbgogICAgICAgIHJldHVybiBmYWxzZQogICAgZW5kCiAgICAKICAgIGNvbnNvbGVDb29sZG93blRyYWNrZXJbY29uc29sZURhdGEuQ29uc29sZUlkZW50aWZpZXJdID0gdGljaygpCgogICAgLS0g8J+UpSBTVEFCTEUgQ09MTEVDVElPTiBNRVRIT0Q6IFRFTEVQT1JUICYgVE9VQ0ggKFdJVEggU0FGRVRZKQogICAgbG9jYWwgb3JpZ2luYWxQb3NpdGlvbiA9IHBsYXllclJvb3QuQ0ZyYW1lCiAgICBsb2NhbCBvcmlnaW5hbEh1bWFub2lkU3RhdGUgPSBwbGF5ZXJIdW1hbm9pZDpHZXRTdGF0ZSgpCiAgICAKICAgIC0tIFRlbXBvcmFyaWx5IGRpc2FibGUgaHVtYW5vaWQgc3RhdGVzIGZvciBzbW9vdGggdGVsZXBvcnQKICAgIHBsYXllckh1bWFub2lkOkNoYW5nZVN0YXRlKEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuUGh5c2ljcykKICAgIAogICAgLS0gQ2FsY3VsYXRlIHNhZmUgdGVsZXBvcnQgcG9zaXRpb24KICAgIGxvY2FsIHRhcmdldFBvc2l0aW9uID0gY29uc29sZURhdGEuVG91Y2hQYXJ0LkNGcmFtZSArIFZlY3RvcjMubmV3KDAsIGNvbnNvbGVUZWxlcG9ydEhlaWdodCwgMCkKICAgIAogICAgLS0gVGVsZXBvcnQgdG8gY29uc29sZSB3aXRoIHZhbGlkYXRpb24KICAgIGxvY2FsIHN1Y2Nlc3MgPSBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgcGxheWVyUm9vdC5DRnJhbWUgPSB0YXJnZXRQb3NpdGlvbgogICAgZW5kKQogICAgCiAgICBpZiBub3Qgc3VjY2VzcyB0aGVuCiAgICAgICAgcGxheWVyUm9vdC5DRnJhbWUgPSBvcmlnaW5hbFBvc2l0aW9uCiAgICAgICAgcGxheWVySHVtYW5vaWQ6Q2hhbmdlU3RhdGUob3JpZ2luYWxIdW1hbm9pZFN0YXRlKQogICAgICAgIHJldHVybiBmYWxzZQogICAgZW5kCiAgICAKICAgIHRhc2sud2FpdCgwLjA1KQogICAgCiAgICAtLSBFeGVjdXRlIHRvdWNoIGludGVyYWN0aW9uCiAgICBsb2NhbCB0b3VjaFN1Y2Nlc3MgPSBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QocGxheWVyUm9vdCwgY29uc29sZURhdGEuVG91Y2hQYXJ0LCAwKQogICAgICAgIHRhc2sud2FpdCgwLjAzKQogICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHBsYXllclJvb3QsIGNvbnNvbGVEYXRhLlRvdWNoUGFydCwgMSkKICAgIGVuZCkKICAgIAogICAgLS0gUmV0dXJuIHRvIG9yaWdpbmFsIHBvc2l0aW9uCiAgICB0YXNrLndhaXQoMC4wMikKICAgIAogICAgbG9jYWwgcmV0dXJuU3VjY2VzcyA9IHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICBwbGF5ZXJSb290LkNGcmFtZSA9IG9yaWdpbmFsUG9zaXRpb24KICAgIGVuZCkKICAgIAogICAgLS0gUmVzdG9yZSBodW1hbm9pZCBzdGF0ZQogICAgcGxheWVySHVtYW5vaWQ6Q2hhbmdlU3RhdGUob3JpZ2luYWxIdW1hbm9pZFN0YXRlKQogICAgCiAgICBpZiB0b3VjaFN1Y2Nlc3MgYW5kIHJldHVyblN1Y2Nlc3MgdGhlbgogICAgICAgIHByb2Nlc3NlZENvbnNvbGVzW2NvbnNvbGVEYXRhLkNvbnNvbGVJZGVudGlmaWVyXSA9IHRpY2soKQogICAgICAgIHJldHVybiB0cnVlCiAgICBlbmQKICAgIAogICAgcmV0dXJuIGZhbHNlCmVuZAoKLS09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQotLSBNQUlOIENPTExFQ1RJT04gTE9PUCAoT1BUSU1JWkVEKQotLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CmxvY2FsIGZ1bmN0aW9uIGluaXRpYXRlQ29uc29sZUNvbGxlY3Rpb24oKQogICAgaWYgY29uc29sZUNvbGxlY3Rpb25UYXNrIHRoZW4gcmV0dXJuIGVuZAogICAgaXNDb25zb2xlQ29sbGVjdGluZyA9IHRydWUKCiAgICBjcmVhdGVWaXN1YWxSYW5nZUluZGljYXRvcigpCiAgICBzY2FuRm9yQ29uc29sZXMoKQoKICAgIGNvbnNvbGVDb2xsZWN0aW9uVGFzayA9IHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGlzQ29uc29sZUNvbGxlY3RpbmcgZG8KICAgICAgICAgICAgbG9jYWwgcGxheWVyUm9vdCA9IGdldFBsYXllclJvb3RQYXJ0KCkKICAgICAgICAgICAgbG9jYWwgcGxheWVySHVtYW5vaWQgPSBnZXRQbGF5ZXJIdW1hbm9pZCgpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBwbGF5ZXJSb290IGFuZCBwbGF5ZXJIdW1hbm9pZCBhbmQgcGxheWVySHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXJQb3NpdGlvbiA9IHBsYXllclJvb3QuUG9zaXRpb24KCiAgICAgICAgICAgICAgICAtLSBSZWZyZXNoIGNvbnNvbGUgY2FjaGUgcGVyaW9kaWNhbGx5CiAgICAgICAgICAgICAgICBpZiB0aWNrKCkgLSBsYXN0Q29uc29sZVNjYW5UaW1lID4gQ09OU09MRV9SRUZSRVNIX0lOVEVSVkFMIHRoZW4KICAgICAgICAgICAgICAgICAgICBzY2FuRm9yQ29uc29sZXMoKQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgLS0gUHJvY2VzcyBhdmFpbGFibGUgY29uc29sZXMgaW4gcmV2ZXJzZSBvcmRlcgogICAgICAgICAgICAgICAgZm9yIGkgPSAjYXZhaWxhYmxlQ29uc29sZXMsIDEsIC0xIGRvCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgY3VycmVudENvbnNvbGUgPSBhdmFpbGFibGVDb25zb2xlc1tpXQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC0tIFZhbGlkYXRlIGNvbnNvbGUgc3RpbGwgZXhpc3RzIGFuZCBpcyBub3QgdG9vIG9sZAogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBjdXJyZW50Q29uc29sZS5Nb2RlbE9iamVjdCBvciBub3QgY3VycmVudENvbnNvbGUuTW9kZWxPYmplY3QuUGFyZW50IG9yCiAgICAgICAgICAgICAgICAgICAgICAgdGljaygpIC0gY3VycmVudENvbnNvbGUuTGFzdENoZWNrZWQgPiAzMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLnJlbW92ZShhdmFpbGFibGVDb25zb2xlcywgaSkKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIC0tIFVwZGF0ZSBwb3NpdGlvbiBhbmQgdGltZXN0YW1wCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRDb25zb2xlLlBvc2l0aW9uID0gY3VycmVudENvbnNvbGUuVG91Y2hQYXJ0LlBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRDb25zb2xlLkxhc3RDaGVja2VkID0gdGljaygpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAtLSBDaGVjayBpZiBpbiByYW5nZQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBkaXN0YW5jZSA9IChjdXJyZW50Q29uc29sZS5Qb3NpdGlvbiAtIHBsYXllclBvc2l0aW9uKS5NYWduaXR1ZGUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZGlzdGFuY2UgPD0gY29uc29sZUNvbGxlY3Rpb25SYW5nZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLSBDaGVjayBnbG9iYWwgY29vbGRvd24KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRpY2soKSAtIGxhc3RDb25zb2xlQ29sbGVjdFRpbWUgPj0gY29uc29sZUNvbGxlY3RDb29sZG93biB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYXR0ZW1wdENvbnNvbGVDb2xsZWN0aW9uKGN1cnJlbnRDb25zb2xlKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RDb25zb2xlQ29sbGVjdFRpbWUgPSB0aWNrKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGUucmVtb3ZlKGF2YWlsYWJsZUNvbnNvbGVzLCBpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCgiW0NvbnNvbGVDb2xsZWN0XSBTdWNjZXNzZnVsbHkgY29sbGVjdGVkIGNvbnNvbGUiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0gTWFyayBmb3IgcmV0cnkgbGF0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudENvbnNvbGUuTGFzdENoZWNrZWQgPSB0aWNrKCkgLSAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgLS0gUGxheWVyIHZhbGlkYXRpb24gZmFpbGVkLCBwYXVzZSBicmllZmx5CiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMSkKICAgICAgICAgICAgICAgIGlmIG5vdCBwbGF5ZXIuQ2hhcmFjdGVyIHRoZW4KICAgICAgICAgICAgICAgICAgICBwcmludCgiW0NvbnNvbGVDb2xsZWN0XSBXYWl0aW5nIGZvciBjaGFyYWN0ZXIuLi4iKQogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgyKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgdGFzay53YWl0KDAuMDgpCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgY29uc29sZUNvbGxlY3Rpb25UYXNrID0gbmlsCiAgICAgICAgcHJpbnQoIltDb25zb2xlQ29sbGVjdF0gQ29sbGVjdGlvbiBsb29wIHN0b3BwZWQiKQogICAgZW5kKQplbmQKCmxvY2FsIGZ1bmN0aW9uIHRlcm1pbmF0ZUNvbnNvbGVDb2xsZWN0aW9uKCkKICAgIGlzQ29uc29sZUNvbGxlY3RpbmcgPSBmYWxzZQogICAgaWYgY29uc29sZUNvbGxlY3Rpb25UYXNrIHRoZW4KICAgICAgICB0YXNrLmNhbmNlbChjb25zb2xlQ29sbGVjdGlvblRhc2spCiAgICAgICAgY29uc29sZUNvbGxlY3Rpb25UYXNrID0gbmlsCiAgICBlbmQKICAgIHJlbW92ZVZpc3VhbEluZGljYXRvcigpCmVuZAoKLS09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQotLSBBUEkgKFNBTUUgRlVOQ1RJT04gTkFNRVMpCi0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KbG9jYWwgQ29uc29sZUNvbGxlY3RvckFQSSA9IHt9CgpmdW5jdGlvbiBDb25zb2xlQ29sbGVjdG9yQVBJLkFjdGl2YXRlKHJhbmdlKQogICAgaWYgcmFuZ2UgdGhlbiAKICAgICAgICBjb25zb2xlQ29sbGVjdGlvblJhbmdlID0gbWF0aC5jbGFtcChyYW5nZSwgMjAsIDE1MCkgLS0gSW5jcmVhc2VkIG1heCByYW5nZQogICAgZW5kCiAgICAKICAgIGlmIGlzQ29uc29sZUNvbGxlY3RpbmcgdGhlbiAKICAgICAgICBwcmludCgiW0NvbnNvbGVDb2xsZWN0XSBBbHJlYWR5IGFjdGl2ZSIpCiAgICAgICAgcmV0dXJuIAogICAgZW5kCiAgICAKICAgIC0tIFZhbGlkYXRlIHBsYXllcgogICAgaWYgbm90IHBsYXllci5DaGFyYWN0ZXIgdGhlbgogICAgICAgIHdhcm4oIltDb25zb2xlQ29sbGVjdF0gTm8gY2hhcmFjdGVyIGZvdW5kLCB3aWxsIGFjdGl2YXRlIHdoZW4gY2hhcmFjdGVyIGxvYWRzIikKICAgICAgICAtLSBXaWxsIGF1dG8tYWN0aXZhdGUgd2hlbiBjaGFyYWN0ZXIgbG9hZHMKICAgIGVuZAogICAgCiAgICBpbml0aWF0ZUNvbnNvbGVDb2xsZWN0aW9uKCkKICAgIHByaW50KCJbQ29uc29sZUNvbGxlY3RdIENvbnNvbGUgY29sbGVjdGlvbiBhY3RpdmF0ZWQiKQplbmQKCmZ1bmN0aW9uIENvbnNvbGVDb2xsZWN0b3JBUEkuRGVhY3RpdmF0ZSgpCiAgICBpZiBub3QgaXNDb25zb2xlQ29sbGVjdGluZyB0aGVuIHJldHVybiBlbmQKICAgIHRlcm1pbmF0ZUNvbnNvbGVDb2xsZWN0aW9uKCkKICAgIHByaW50KCJbQ29uc29sZUNvbGxlY3RdIENvbnNvbGUgY29sbGVjdGlvbiBkZWFjdGl2YXRlZCIpCmVuZAoKZnVuY3Rpb24gQ29uc29sZUNvbGxlY3RvckFQSS5Ub2dnbGVBY3RpdmF0aW9uKCkKICAgIGlmIGlzQ29uc29sZUNvbGxlY3RpbmcgdGhlbgogICAgICAgIENvbnNvbGVDb2xsZWN0b3JBUEkuRGVhY3RpdmF0ZSgpCiAgICBlbHNlCiAgICAgICAgQ29uc29sZUNvbGxlY3RvckFQSS5BY3RpdmF0ZSgpCiAgICBlbmQKZW5kCgpmdW5jdGlvbiBDb25zb2xlQ29sbGVjdG9yQVBJLkFkanVzdFJhbmdlKG5ld1JhbmdlKQogICAgY29uc29sZUNvbGxlY3Rpb25SYW5nZSA9IG1hdGguY2xhbXAobmV3UmFuZ2UsIDIwLCAxNTApIC0tIEluY3JlYXNlZCBtYXggcmFuZ2UKICAgIAogICAgaWYgdmlzdWFsUmFuZ2VJbmRpY2F0b3IgdGhlbgogICAgICAgIGxvY2FsIHBhcnRzID0gdmlzdWFsUmFuZ2VJbmRpY2F0b3I6R2V0Q2hpbGRyZW4oKQogICAgICAgIGZvciBfLCBwYXJ0IGluIGlwYWlycyhwYXJ0cykgZG8KICAgICAgICAgICAgaWYgcGFydDpJc0EoIkJhc2VQYXJ0IikgYW5kIHBhcnQuTmFtZSA9PSAiQ29uc29sZUNvbGxlY3RSYW5nZSIgdGhlbgogICAgICAgICAgICAgICAgcGFydC5TaXplID0gVmVjdG9yMy5uZXcoY29uc29sZUNvbGxlY3Rpb25SYW5nZSAqIDIsIDAuMSwgY29uc29sZUNvbGxlY3Rpb25SYW5nZSAqIDIpCiAgICAgICAgICAgIGVsc2VpZiBwYXJ0OklzQSgiQmFzZVBhcnQiKSBhbmQgcGFydC5OYW1lID09ICJDb25zb2xlQ29sbGVjdFJhbmdlX091dGxpbmUiIHRoZW4KICAgICAgICAgICAgICAgIHBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KGNvbnNvbGVDb2xsZWN0aW9uUmFuZ2UgKiAyICsgMC4yNSwgMC4xLCBjb25zb2xlQ29sbGVjdGlvblJhbmdlICogMiArIDAuMjUpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICAKICAgIHByaW50KHN0cmluZy5mb3JtYXQoIltDb25zb2xlQ29sbGVjdF0gUmFuZ2Ugc2V0IHRvICVkIiwgY29uc29sZUNvbGxlY3Rpb25SYW5nZSkpCmVuZAoKZnVuY3Rpb24gQ29uc29sZUNvbGxlY3RvckFQSS5SZWZyZXNoQ29uc29sZXMoKQogICAgc2NhbkZvckNvbnNvbGVzKCkKICAgIHByaW50KCJbQ29uc29sZUNvbGxlY3RdIENvbnNvbGUgY2FjaGUgcmVmcmVzaGVkIikKZW5kCgpmdW5jdGlvbiBDb25zb2xlQ29sbGVjdG9yQVBJLkdldFN0YXR1cygpCiAgICByZXR1cm4gewogICAgICAgIEFjdGl2ZSA9IGlzQ29uc29sZUNvbGxlY3RpbmcsCiAgICAgICAgUmFuZ2UgPSBjb25zb2xlQ29sbGVjdGlvblJhbmdlLAogICAgICAgIEZvdW5kQ29uc29sZXMgPSBnZXRUYWJsZUxlbmd0aChhdmFpbGFibGVDb25zb2xlcyksCiAgICAgICAgQ29sbGVjdGVkQ291bnQgPSBnZXRUYWJsZUxlbmd0aChwcm9jZXNzZWRDb25zb2xlcyksCiAgICAgICAgQ29vbGRvd24gPSBjb25zb2xlQ29sbGVjdENvb2xkb3duCiAgICB9CmVuZAoKZnVuY3Rpb24gQ29uc29sZUNvbGxlY3RvckFQSS5TZXRDb29sZG93bihjb29sZG93bikKICAgIGNvbnNvbGVDb2xsZWN0Q29vbGRvd24gPSBtYXRoLm1heCgwLjEsIGNvb2xkb3duKQogICAgcHJpbnQoc3RyaW5nLmZvcm1hdCgiW0NvbnNvbGVDb2xsZWN0XSBDb29sZG93biBzZXQgdG8gJS4yZiBzZWNvbmRzIiwgY29uc29sZUNvbGxlY3RDb29sZG93bikpCmVuZAoKZnVuY3Rpb24gQ29uc29sZUNvbGxlY3RvckFQSS5DbGVhckNhY2hlKCkKICAgIHByb2Nlc3NlZENvbnNvbGVzID0ge30KICAgIGNvbnNvbGVDb29sZG93blRyYWNrZXIgPSB7fQogICAgcHJpbnQoIltDb25zb2xlQ29sbGVjdF0gQ2FjaGUgY2xlYXJlZCIpCmVuZAoKLS09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQotLSBBVVRPLVJFQ09OTkVDVCBPTiBDSEFSQUNURVIgQ0hBTkdFIChJTVBST1ZFRCkKLS09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpsb2NhbCBjaGFyYWN0ZXJDb25uZWN0aW9uCmNoYXJhY3RlckNvbm5lY3Rpb24gPSBwbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihjaGFyYWN0ZXIpCiAgICB0YXNrLndhaXQoMSkKICAgIGlmIGlzQ29uc29sZUNvbGxlY3RpbmcgdGhlbgogICAgICAgIHByaW50KCJbQ29uc29sZUNvbGxlY3RdIENoYXJhY3RlciBsb2FkZWQsIHJlc3VtaW5nIGNvbGxlY3Rpb24uLi4iKQogICAgICAgIHRhc2sud2FpdCgwLjUpCiAgICAgICAgLS0gUmVzdGFydCBjb2xsZWN0aW9uCiAgICAgICAgdGVybWluYXRlQ29uc29sZUNvbGxlY3Rpb24oKQogICAgICAgIHRhc2sud2FpdCgwLjIpCiAgICAgICAgaW5pdGlhdGVDb25zb2xlQ29sbGVjdGlvbigpCiAgICBlbmQKZW5kKQoKbG9jYWwgY2hhcmFjdGVyUmVtb3ZpbmdDb25uZWN0aW9uCmNoYXJhY3RlclJlbW92aW5nQ29ubmVjdGlvbiA9IHBsYXllci5DaGFyYWN0ZXJSZW1vdmluZzpDb25uZWN0KGZ1bmN0aW9uKCkKICAgIGlmIGlzQ29uc29sZUNvbGxlY3RpbmcgdGhlbgogICAgICAgIHByaW50KCJbQ29uc29sZUNvbGxlY3RdIENoYXJhY3RlciByZW1vdmVkLCBwYXVzaW5nIGNvbGxlY3Rpb24uLi4iKQogICAgICAgIC0tIEp1c3QgcGF1c2UsIGRvbid0IGRlYWN0aXZhdGUgY29tcGxldGVseQogICAgZW5kCmVuZCkKCi0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLS0gUEVSSU9ESUMgQ09OU09MRSBTQ0FOTklORyAoV0lUSCBFUlJPUiBIQU5ETElORykKLS09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRydWUgZG8KICAgICAgICB0YXNrLndhaXQoQ09OU09MRV9TQ0FOX0lOVEVSVkFMKQogICAgICAgIGlmIGlzQ29uc29sZUNvbGxlY3RpbmcgdGhlbgogICAgICAgICAgICBsb2NhbCBzdWNjZXNzLCBlcnIgPSBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBzY2FuRm9yQ29uc29sZXMoKQogICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGlmIG5vdCBzdWNjZXNzIHRoZW4KICAgICAgICAgICAgICAgIHdhcm4oIltDb25zb2xlQ29sbGVjdF0gRXJyb3IgZHVyaW5nIHNjYW5uaW5nOiAiIC4uIHRvc3RyaW5nKGVycikpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCi0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLS0gQVVUTy1DTEVBTlVQIE9OIEVYSVQKLS09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpnYW1lOkdldFNlcnZpY2UoIlVzZXJJbnB1dFNlcnZpY2UiKS5XaW5kb3dGb2N1c2VkOkNvbm5lY3QoZnVuY3Rpb24oZm9jdXNlZCkKICAgIGlmIG5vdCBmb2N1c2VkIGFuZCBpc0NvbnNvbGVDb2xsZWN0aW5nIHRoZW4KICAgICAgICBwcmludCgiW0NvbnNvbGVDb2xsZWN0XSBXaW5kb3cgdW5mb2N1c2VkLCBwYXVzaW5nLi4uIikKICAgIGVuZAplbmQpCgotLSBDbGVhbnVwIG9uIHNjcmlwdCB0ZXJtaW5hdGlvbgp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgIGdhbWU6R2V0U2VydmljZSgiVXNlcklucHV0U2VydmljZSIpLldpbmRvd0ZvY3VzUmVsZWFzZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgdGVybWluYXRlQ29uc29sZUNvbGxlY3Rpb24oKQogICAgZW5kKQplbmQpCgotLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci0tIENPTkZJRwotLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CmxvY2FsIGlzVmFsZW50aW5lQ2FuZHlDb2xsZWN0aW5nID0gZmFsc2UKbG9jYWwgdmFsZW50aW5lQ2FuZHlDb2xsZWN0aW9uUmFuZ2UgPSA2NQpsb2NhbCB2YWxlbnRpbmVDYW5keUNvbGxlY3RDb29sZG93biA9IDAuMwpsb2NhbCB2YWxlbnRpbmVDYW5keVRlbGVwb3J0SGVpZ2h0ID0gMwpsb2NhbCB2YWxlbnRpbmVDYW5keVNlYXJjaERlcHRoID0gNTAwCgotLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci0tIFNUQVRFCi0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KbG9jYWwgdmFsZW50aW5lQ2FuZHlBdmFpbGFibGVQYXJ0cyA9IHt9IC0tIEdhYnVuZ2FuIFZhbGVudGluZSArIENhbmR5CmxvY2FsIHZhbGVudGluZUNhbmR5UHJvY2Vzc2VkUGFydHMgPSB7fQpsb2NhbCB2YWxlbnRpbmVDYW5keUNvb2xkb3duVHJhY2tlciA9IHt9Cgpsb2NhbCB2YWxlbnRpbmVDYW5keUNvbGxlY3Rpb25UYXNrCmxvY2FsIHZhbGVudGluZUNhbmR5VXBkYXRlTGluawpsb2NhbCB2YWxlbnRpbmVDYW5keVZpc3VhbFJhbmdlSW5kaWNhdG9yCgpsb2NhbCB2YWxlbnRpbmVDYW5keUxhc3RDb2xsZWN0VGltZSA9IDAKbG9jYWwgdmFsZW50aW5lQ2FuZHlMYXN0U2NhblRpbWUgPSAwCmxvY2FsIFZBTEVOVElORV9DQU5EWV9TQ0FOX0lOVEVSVkFMID0gNQpsb2NhbCBWQUxFTlRJTkVfQ0FORFlfUkVGUkVTSF9JTlRFUlZBTCA9IDEKCi0tIFN0YXRzIHRyYWNraW5nCmxvY2FsIHZhbGVudGluZUNhbmR5Q29sbGVjdGVkU3RhdHMgPSB7CiAgICBWYWxlbnRpbmUgPSAwLAogICAgQ2FuZHkgPSAwLAogICAgVG90YWwgPSAwCn0KCi0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLS0gVVRJTElUWSBGVU5DVElPTlMKLS09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpsb2NhbCBmdW5jdGlvbiBnZXRUYWJsZUxlbmd0aCh0YmwpCiAgICBsb2NhbCBjb3VudCA9IDAKICAgIGZvciBfIGluIHBhaXJzKHRibCkgZG8gY291bnQgPSBjb3VudCArIDEgZW5kCiAgICByZXR1cm4gY291bnQKZW5kCgpsb2NhbCBmdW5jdGlvbiBnZXRQbGF5ZXJSb290UGFydCgpCiAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICBpZiBub3QgY2hhcmFjdGVyIHRoZW4gcmV0dXJuIG5pbCBlbmQKICAgIHJldHVybiBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSBvciBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlRvcnNvIikKZW5kCgpsb2NhbCBmdW5jdGlvbiBnZXRQbGF5ZXJIdW1hbm9pZCgpCiAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICBpZiBub3QgY2hhcmFjdGVyIHRoZW4gcmV0dXJuIG5pbCBlbmQKICAgIHJldHVybiBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikKZW5kCgotLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci0tIFZJU1VBTCBSQU5HRSBJTkRJQ0FUT1IgKERVQUwgQ09MT1IpCi0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KbG9jYWwgZnVuY3Rpb24gcmVtb3ZlVmFsZW50aW5lQ2FuZHlWaXN1YWxJbmRpY2F0b3IoKQogICAgaWYgdmFsZW50aW5lQ2FuZHlVcGRhdGVMaW5rIHRoZW4KICAgICAgICB2YWxlbnRpbmVDYW5keVVwZGF0ZUxpbms6RGlzY29ubmVjdCgpCiAgICAgICAgdmFsZW50aW5lQ2FuZHlVcGRhdGVMaW5rID0gbmlsCiAgICBlbmQKCiAgICBpZiB2YWxlbnRpbmVDYW5keVZpc3VhbFJhbmdlSW5kaWNhdG9yIGFuZCB2YWxlbnRpbmVDYW5keVZpc3VhbFJhbmdlSW5kaWNhdG9yLlBhcmVudCB0aGVuCiAgICAgICAgdmFsZW50aW5lQ2FuZHlWaXN1YWxSYW5nZUluZGljYXRvcjpEZXN0cm95KCkKICAgICAgICB2YWxlbnRpbmVDYW5keVZpc3VhbFJhbmdlSW5kaWNhdG9yID0gbmlsCiAgICBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBjcmVhdGVWYWxlbnRpbmVDYW5keVZpc3VhbFJhbmdlSW5kaWNhdG9yKCkKICAgIC0tIFJlbW92ZSBleGlzdGluZyBpbmRpY2F0b3IgZmlyc3QKICAgIHJlbW92ZVZhbGVudGluZUNhbmR5VmlzdWFsSW5kaWNhdG9yKCkKCiAgICBsb2NhbCByb290UGFydCA9IGdldFBsYXllclJvb3RQYXJ0KCkKICAgIGlmIG5vdCByb290UGFydCB0aGVuIAogICAgICAgIC0tIFJldHJ5IGFmdGVyIGEgc2hvcnQgZGVsYXkgaWYgcm9vdCBwYXJ0IG5vdCBmb3VuZAogICAgICAgIHRhc2sud2FpdCgwLjUpCiAgICAgICAgcm9vdFBhcnQgPSBnZXRQbGF5ZXJSb290UGFydCgpCiAgICAgICAgaWYgbm90IHJvb3RQYXJ0IHRoZW4gcmV0dXJuIGVuZAogICAgZW5kCgogICAgLS0gQ3JlYXRlIGNvbnRhaW5lciBtb2RlbAogICAgbG9jYWwgaW5kaWNhdG9yTW9kZWwgPSBJbnN0YW5jZS5uZXcoIk1vZGVsIikKICAgIGluZGljYXRvck1vZGVsLk5hbWUgPSAiVmFsZW50aW5lQ2FuZHlSYW5nZUluZGljYXRvciIKICAgIGluZGljYXRvck1vZGVsLlBhcmVudCA9IHdvcmtzcGFjZQogICAgCiAgICB2YWxlbnRpbmVDYW5keVZpc3VhbFJhbmdlSW5kaWNhdG9yID0gaW5kaWNhdG9yTW9kZWwKCiAgICAtLSBNYWluIGluZGljYXRvciAoVmFsZW50aW5lIFBpbmspCiAgICBsb2NhbCB2YWxlbnRpbmVSaW5nID0gSW5zdGFuY2UubmV3KCJQYXJ0IikKICAgIHZhbGVudGluZVJpbmcuTmFtZSA9ICJWYWxlbnRpbmVSYW5nZSIKICAgIHZhbGVudGluZVJpbmcuQW5jaG9yZWQgPSB0cnVlCiAgICB2YWxlbnRpbmVSaW5nLkNhbkNvbGxpZGUgPSBmYWxzZQogICAgdmFsZW50aW5lUmluZy5DYW5RdWVyeSA9IGZhbHNlCiAgICB2YWxlbnRpbmVSaW5nLkNhblRvdWNoID0gZmFsc2UKICAgIHZhbGVudGluZVJpbmcuTWF0ZXJpYWwgPSBFbnVtLk1hdGVyaWFsLk5lb24KICAgIHZhbGVudGluZVJpbmcuQ29sb3IgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDEwNSwgMTgwKSAtLSBIb3QgcGluawogICAgdmFsZW50aW5lUmluZy5UcmFuc3BhcmVuY3kgPSAwLjUKICAgIHZhbGVudGluZVJpbmcuU2l6ZSA9IFZlY3RvcjMubmV3KHZhbGVudGluZUNhbmR5Q29sbGVjdGlvblJhbmdlICogMiwgMC4xLCB2YWxlbnRpbmVDYW5keUNvbGxlY3Rpb25SYW5nZSAqIDIpCiAgICB2YWxlbnRpbmVSaW5nLlBhcmVudCA9IGluZGljYXRvck1vZGVsCiAgICAKICAgIGxvY2FsIGN5bGluZGVyTWVzaDEgPSBJbnN0YW5jZS5uZXcoIkN5bGluZGVyTWVzaCIpCiAgICBjeWxpbmRlck1lc2gxLlNjYWxlID0gVmVjdG9yMy5uZXcoMSwgMC4wNiwgMSkKICAgIGN5bGluZGVyTWVzaDEuUGFyZW50ID0gdmFsZW50aW5lUmluZwoKICAgIC0tIFNlY29uZCByaW5nIChDYW5keSBZZWxsb3cvT3JhbmdlKQogICAgbG9jYWwgY2FuZHlSaW5nID0gSW5zdGFuY2UubmV3KCJQYXJ0IikKICAgIGNhbmR5UmluZy5OYW1lID0gIkNhbmR5UmFuZ2UiCiAgICBjYW5keVJpbmcuQW5jaG9yZWQgPSB0cnVlCiAgICBjYW5keVJpbmcuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICBjYW5keVJpbmcuQ2FuUXVlcnkgPSBmYWxzZQogICAgY2FuZHlSaW5nLkNhblRvdWNoID0gZmFsc2UKICAgIGNhbmR5UmluZy5NYXRlcmlhbCA9IEVudW0uTWF0ZXJpYWwuTmVvbgogICAgY2FuZHlSaW5nLkNvbG9yID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyMDAsIDApIC0tIEdvbGQvWWVsbG93CiAgICBjYW5keVJpbmcuVHJhbnNwYXJlbmN5ID0gMC41CiAgICBjYW5keVJpbmcuU2l6ZSA9IFZlY3RvcjMubmV3KHZhbGVudGluZUNhbmR5Q29sbGVjdGlvblJhbmdlICogMiArIDAuNSwgMC4xNSwgdmFsZW50aW5lQ2FuZHlDb2xsZWN0aW9uUmFuZ2UgKiAyICsgMC41KQogICAgY2FuZHlSaW5nLlBhcmVudCA9IGluZGljYXRvck1vZGVsCiAgICAKICAgIGxvY2FsIGN5bGluZGVyTWVzaDIgPSBJbnN0YW5jZS5uZXcoIkN5bGluZGVyTWVzaCIpCiAgICBjeWxpbmRlck1lc2gyLlNjYWxlID0gVmVjdG9yMy5uZXcoMSwgMC4wOCwgMSkKICAgIGN5bGluZGVyTWVzaDIuUGFyZW50ID0gY2FuZHlSaW5nCgogICAgLS0gUG9zaXRpb24gaW5pdGlhbGx5CiAgICBsb2NhbCBjdXJyZW50Um9vdCA9IGdldFBsYXllclJvb3RQYXJ0KCkKICAgIGlmIGN1cnJlbnRSb290IHRoZW4KICAgICAgICBsb2NhbCBwYXJ0cyA9IGluZGljYXRvck1vZGVsOkdldENoaWxkcmVuKCkKICAgICAgICBmb3IgXywgcGFydCBpbiBpcGFpcnMocGFydHMpIGRvCiAgICAgICAgICAgIGlmIHBhcnQ6SXNBKCJCYXNlUGFydCIpIHRoZW4KICAgICAgICAgICAgICAgIHBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyhjdXJyZW50Um9vdC5Qb3NpdGlvbiAtIFZlY3RvcjMubmV3KDAsIDMsIDApKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAoKICAgIC0tIFVwZGF0ZSBwb3NpdGlvbiB3aXRoIHBsYXllcgogICAgdmFsZW50aW5lQ2FuZHlVcGRhdGVMaW5rID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikuUmVuZGVyU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBjdXJyZW50Um9vdCA9IGdldFBsYXllclJvb3RQYXJ0KCkKICAgICAgICBpZiBub3QgY3VycmVudFJvb3Qgb3Igbm90IHZhbGVudGluZUNhbmR5VmlzdWFsUmFuZ2VJbmRpY2F0b3Igb3Igbm90IHZhbGVudGluZUNhbmR5VmlzdWFsUmFuZ2VJbmRpY2F0b3IuUGFyZW50IHRoZW4gCiAgICAgICAgICAgIHJlbW92ZVZhbGVudGluZUNhbmR5VmlzdWFsSW5kaWNhdG9yKCkKICAgICAgICAgICAgcmV0dXJuIAogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIGxvY2FsIHBhcnRzID0gdmFsZW50aW5lQ2FuZHlWaXN1YWxSYW5nZUluZGljYXRvcjpHZXRDaGlsZHJlbigpCiAgICAgICAgZm9yIF8sIHBhcnQgaW4gaXBhaXJzKHBhcnRzKSBkbwogICAgICAgICAgICBpZiBwYXJ0OklzQSgiQmFzZVBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICBwYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoY3VycmVudFJvb3QuUG9zaXRpb24gLSBWZWN0b3IzLm5ldygwLCAzLCAwKSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCiAgICAKICAgIHByaW50KCJbVmFsZW50aW5lQ2FuZHlDb2xsZWN0XSBWaXN1YWwgcmFuZ2UgaW5kaWNhdG9yIGNyZWF0ZWQiKQplbmQKCi0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLS0gRFVBTCBQQVJUIERFVEVDVElPTiAoVmFsZW50aW5lICsgQ2FuZHkpCi0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KbG9jYWwgZnVuY3Rpb24gc2NhbkZvclZhbGVudGluZUNhbmR5UGFydHMoKQogICAgdmFsZW50aW5lQ2FuZHlBdmFpbGFibGVQYXJ0cyA9IHt9CiAgICBsb2NhbCBjdXJyZW50VGltZSA9IHRpY2soKQogICAgCiAgICAtLSBDbGVhbnVwIG9sZCBwcm9jZXNzZWQgcGFydHMKICAgIGZvciBwYXJ0SWQsIGRhdGEgaW4gcGFpcnModmFsZW50aW5lQ2FuZHlQcm9jZXNzZWRQYXJ0cykgZG8KICAgICAgICBpZiBjdXJyZW50VGltZSAtIGRhdGEudGltZSA+IDMwMCB0aGVuIC0tIDUgbWVuaXQKICAgICAgICAgICAgdmFsZW50aW5lQ2FuZHlQcm9jZXNzZWRQYXJ0c1twYXJ0SWRdID0gbmlsCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgLS0gRk9MREVSIDE6IFZhbGVudGluZXNDb2luUGFydHMKICAgIGxvY2FsIHZhbGVudGluZUZvbGRlciA9IHdvcmtzcGFjZTpGaW5kRmlyc3RDaGlsZCgiVmFsZW50aW5lc0NvaW5QYXJ0cyIpCiAgICBpZiB2YWxlbnRpbmVGb2xkZXIgdGhlbgogICAgICAgIGZvciBfLCBpdGVtIGluIGlwYWlycyh2YWxlbnRpbmVGb2xkZXI6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgaWYgI3ZhbGVudGluZUNhbmR5QXZhaWxhYmxlUGFydHMgPj0gdmFsZW50aW5lQ2FuZHlTZWFyY2hEZXB0aCB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgdG91Y2hQYXJ0ID0gbmlsCiAgICAgICAgICAgIGxvY2FsIG1vZGVsT2JqZWN0ID0gbmlsCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBpdGVtOklzQSgiTW9kZWwiKSB0aGVuCiAgICAgICAgICAgICAgICBtb2RlbE9iamVjdCA9IGl0ZW0KICAgICAgICAgICAgICAgIHRvdWNoUGFydCA9IGl0ZW06RmluZEZpcnN0Q2hpbGRXaGljaElzQSgiQmFzZVBhcnQiKQogICAgICAgICAgICBlbHNlaWYgaXRlbTpJc0EoIkJhc2VQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgdG91Y2hQYXJ0ID0gaXRlbQogICAgICAgICAgICAgICAgbW9kZWxPYmplY3QgPSBpdGVtCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgaWYgdG91Y2hQYXJ0IGFuZCB0b3VjaFBhcnQ6RmluZEZpcnN0Q2hpbGRXaGljaElzQSgiVG91Y2hUcmFuc21pdHRlciIpIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIHBhcnRJZCA9ICJWQUxfIiAuLiAobW9kZWxPYmplY3Q6R2V0QXR0cmlidXRlKCJDb2luSUQiKSBvciBtb2RlbE9iamVjdC5OYW1lIC4uICJfIiAuLiBtb2RlbE9iamVjdDpHZXREZWJ1Z0lkKCkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCB2YWxlbnRpbmVDYW5keVByb2Nlc3NlZFBhcnRzW3BhcnRJZF0gdGhlbgogICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydCh2YWxlbnRpbmVDYW5keUF2YWlsYWJsZVBhcnRzLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIE1vZGVsT2JqZWN0ID0gbW9kZWxPYmplY3QsCiAgICAgICAgICAgICAgICAgICAgICAgIFRvdWNoUGFydCA9IHRvdWNoUGFydCwKICAgICAgICAgICAgICAgICAgICAgICAgUGFydElkZW50aWZpZXIgPSBwYXJ0SWQsCiAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gdG91Y2hQYXJ0LlBvc2l0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICBMYXN0Q2hlY2tlZCA9IGN1cnJlbnRUaW1lLAogICAgICAgICAgICAgICAgICAgICAgICBQYXJ0TmFtZSA9IG1vZGVsT2JqZWN0Lk5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIFR5cGUgPSAiVmFsZW50aW5lIiwKICAgICAgICAgICAgICAgICAgICAgICAgQ29sb3IgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDEwNSwgMTgwKQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgLS0gRk9MREVSIDI6IENhbmR5RXZlbnRQYXJ0cwogICAgbG9jYWwgY2FuZHlGb2xkZXIgPSB3b3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQoIkNhbmR5RXZlbnRQYXJ0cyIpCiAgICBpZiBjYW5keUZvbGRlciB0aGVuCiAgICAgICAgZm9yIF8sIGl0ZW0gaW4gaXBhaXJzKGNhbmR5Rm9sZGVyOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgIGlmICN2YWxlbnRpbmVDYW5keUF2YWlsYWJsZVBhcnRzID49IHZhbGVudGluZUNhbmR5U2VhcmNoRGVwdGggdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIHRvdWNoUGFydCA9IG5pbAogICAgICAgICAgICBsb2NhbCBtb2RlbE9iamVjdCA9IG5pbAogICAgICAgICAgICAKICAgICAgICAgICAgaWYgaXRlbTpJc0EoIk1vZGVsIikgdGhlbgogICAgICAgICAgICAgICAgbW9kZWxPYmplY3QgPSBpdGVtCiAgICAgICAgICAgICAgICB0b3VjaFBhcnQgPSBpdGVtOkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIkJhc2VQYXJ0IikKICAgICAgICAgICAgZWxzZWlmIGl0ZW06SXNBKCJCYXNlUGFydCIpIHRoZW4KICAgICAgICAgICAgICAgIHRvdWNoUGFydCA9IGl0ZW0KICAgICAgICAgICAgICAgIG1vZGVsT2JqZWN0ID0gaXRlbQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHRvdWNoUGFydCBhbmQgdG91Y2hQYXJ0OkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIlRvdWNoVHJhbnNtaXR0ZXIiKSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBwYXJ0SWQgPSAiQ0FORFlfIiAuLiAobW9kZWxPYmplY3Q6R2V0QXR0cmlidXRlKCJDYW5keUlEIikgb3IgbW9kZWxPYmplY3QuTmFtZSAuLiAiXyIgLi4gbW9kZWxPYmplY3Q6R2V0RGVidWdJZCgpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3QgdmFsZW50aW5lQ2FuZHlQcm9jZXNzZWRQYXJ0c1twYXJ0SWRdIHRoZW4KICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQodmFsZW50aW5lQ2FuZHlBdmFpbGFibGVQYXJ0cywgewogICAgICAgICAgICAgICAgICAgICAgICBNb2RlbE9iamVjdCA9IG1vZGVsT2JqZWN0LAogICAgICAgICAgICAgICAgICAgICAgICBUb3VjaFBhcnQgPSB0b3VjaFBhcnQsCiAgICAgICAgICAgICAgICAgICAgICAgIFBhcnRJZGVudGlmaWVyID0gcGFydElkLAogICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IHRvdWNoUGFydC5Qb3NpdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgTGFzdENoZWNrZWQgPSBjdXJyZW50VGltZSwKICAgICAgICAgICAgICAgICAgICAgICAgUGFydE5hbWUgPSBtb2RlbE9iamVjdC5OYW1lLAogICAgICAgICAgICAgICAgICAgICAgICBUeXBlID0gIkNhbmR5IiwKICAgICAgICAgICAgICAgICAgICAgICAgQ29sb3IgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDIwMCwgMCkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICAKICAgIC0tIEZhbGxiYWNrOiBTZWFyY2ggd29ya3NwYWNlIGZvciBhbnkgcmVtYWluaW5nIHBhcnRzCiAgICBpZiBnZXRUYWJsZUxlbmd0aCh2YWxlbnRpbmVDYW5keUF2YWlsYWJsZVBhcnRzKSA8IDEwIHRoZW4KICAgICAgICBsb2NhbCBzZWFyY2hDb3VudCA9IDAKICAgICAgICBmb3IgXywgaXRlbSBpbiBpcGFpcnMod29ya3NwYWNlOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgIGlmIHNlYXJjaENvdW50ID49IDEwMCB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgaWYgaXRlbTpJc0EoIkJhc2VQYXJ0IikgYW5kIGl0ZW06RmluZEZpcnN0Q2hpbGRXaGljaElzQSgiVG91Y2hUcmFuc21pdHRlciIpIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGl0ZW1OYW1lID0gaXRlbS5OYW1lOmxvd2VyKCkKICAgICAgICAgICAgICAgIGxvY2FsIHBhcmVudE1vZGVsID0gaXRlbTpGaW5kRmlyc3RBbmNlc3RvcldoaWNoSXNBKCJNb2RlbCIpIG9yIGl0ZW0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgcGFydFR5cGUgPSBuaWwKICAgICAgICAgICAgICAgIGxvY2FsIHBhcnRJZCA9IG5pbAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBpdGVtTmFtZTpmaW5kKCJ2YWxlbnRpbmUiKSBvciBpdGVtTmFtZTpmaW5kKCJsb3ZlIikgb3IgaXRlbU5hbWU6ZmluZCgiaGVhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcGFydFR5cGUgPSAiVmFsZW50aW5lIgogICAgICAgICAgICAgICAgICAgIHBhcnRJZCA9ICJWQUxfRkFMTEJBQ0tfIiAuLiBwYXJlbnRNb2RlbC5OYW1lIC4uICJfIiAuLiBwYXJlbnRNb2RlbDpHZXREZWJ1Z0lkKCkKICAgICAgICAgICAgICAgIGVsc2VpZiBpdGVtTmFtZTpmaW5kKCJjYW5keSIpIG9yIGl0ZW1OYW1lOmZpbmQoInN3ZWV0Iikgb3IgaXRlbU5hbWU6ZmluZCgic3VnYXIiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcGFydFR5cGUgPSAiQ2FuZHkiCiAgICAgICAgICAgICAgICAgICAgcGFydElkID0gIkNBTkRZX0ZBTExCQUNLXyIgLi4gcGFyZW50TW9kZWwuTmFtZSAuLiAiXyIgLi4gcGFyZW50TW9kZWw6R2V0RGVidWdJZCgpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgcGFydFR5cGUgYW5kIG5vdCB2YWxlbnRpbmVDYW5keVByb2Nlc3NlZFBhcnRzW3BhcnRJZF0gdGhlbgogICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydCh2YWxlbnRpbmVDYW5keUF2YWlsYWJsZVBhcnRzLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIE1vZGVsT2JqZWN0ID0gcGFyZW50TW9kZWwsCiAgICAgICAgICAgICAgICAgICAgICAgIFRvdWNoUGFydCA9IGl0ZW0sCiAgICAgICAgICAgICAgICAgICAgICAgIFBhcnRJZGVudGlmaWVyID0gcGFydElkLAogICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IGl0ZW0uUG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgIExhc3RDaGVja2VkID0gY3VycmVudFRpbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIFBhcnROYW1lID0gcGFyZW50TW9kZWwuTmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgVHlwZSA9IHBhcnRUeXBlLAogICAgICAgICAgICAgICAgICAgICAgICBDb2xvciA9IHBhcnRUeXBlID09ICJWYWxlbnRpbmUiIGFuZCBDb2xvcjMuZnJvbVJHQigyNTUsIDEwNSwgMTgwKSBvciBDb2xvcjMuZnJvbVJHQigyNTUsIDIwMCwgMCkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIHNlYXJjaENvdW50ID0gc2VhcmNoQ291bnQgKyAxCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgdmFsZW50aW5lQ2FuZHlMYXN0U2NhblRpbWUgPSB0aWNrKCkKICAgIAogICAgLS0gVXBkYXRlIHN0YXRzCiAgICBsb2NhbCB2YWxDb3VudCA9IDAKICAgIGxvY2FsIGNhbmR5Q291bnQgPSAwCiAgICBmb3IgXywgcGFydCBpbiBpcGFpcnModmFsZW50aW5lQ2FuZHlBdmFpbGFibGVQYXJ0cykgZG8KICAgICAgICBpZiBwYXJ0LlR5cGUgPT0gIlZhbGVudGluZSIgdGhlbgogICAgICAgICAgICB2YWxDb3VudCA9IHZhbENvdW50ICsgMQogICAgICAgIGVsc2UKICAgICAgICAgICAgY2FuZHlDb3VudCA9IGNhbmR5Q291bnQgKyAxCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgcHJpbnQoc3RyaW5nLmZvcm1hdCgiW1ZhbGVudGluZUNhbmR5Q29sbGVjdF0gRm91bmQ6ICVkIFZhbGVudGluZSB8ICVkIENhbmR5IHwgVG90YWw6ICVkIHwgQ29sbGVjdGVkOiAlZCIsIAogICAgICAgIHZhbENvdW50LCBjYW5keUNvdW50LCAjdmFsZW50aW5lQ2FuZHlBdmFpbGFibGVQYXJ0cywgdmFsZW50aW5lQ2FuZHlDb2xsZWN0ZWRTdGF0cy5Ub3RhbCkpCmVuZAoKLS09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQotLSBDT0xMRUNUSU9OIE1FVEhPRAotLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CmxvY2FsIGZ1bmN0aW9uIGF0dGVtcHRWYWxlbnRpbmVDYW5keUNvbGxlY3Rpb24ocGFydERhdGEpCiAgICBpZiBub3QgcGFydERhdGEgb3Igbm90IHBhcnREYXRhLk1vZGVsT2JqZWN0IG9yIG5vdCBwYXJ0RGF0YS5Nb2RlbE9iamVjdC5QYXJlbnQgdGhlbiAKICAgICAgICByZXR1cm4gZmFsc2UgCiAgICBlbmQKICAgIAogICAgLS0gQ2hlY2sgY29vbGRvd24KICAgIGlmIHZhbGVudGluZUNhbmR5Q29vbGRvd25UcmFja2VyW3BhcnREYXRhLlBhcnRJZGVudGlmaWVyXSBhbmQgCiAgICAgICB0aWNrKCkgLSB2YWxlbnRpbmVDYW5keUNvb2xkb3duVHJhY2tlcltwYXJ0RGF0YS5QYXJ0SWRlbnRpZmllcl0gPCAxLjUgdGhlbgogICAgICAgIHJldHVybiBmYWxzZQogICAgZW5kCgogICAgbG9jYWwgcGxheWVyUm9vdCA9IGdldFBsYXllclJvb3RQYXJ0KCkKICAgIGxvY2FsIHBsYXllckh1bWFub2lkID0gZ2V0UGxheWVySHVtYW5vaWQoKQogICAgCiAgICBpZiBub3QgcGxheWVyUm9vdCBvciBub3QgcGxheWVySHVtYW5vaWQgb3IgcGxheWVySHVtYW5vaWQuSGVhbHRoIDw9IDAgdGhlbiAKICAgICAgICByZXR1cm4gZmFsc2UgCiAgICBlbmQKICAgIAogICAgdmFsZW50aW5lQ2FuZHlDb29sZG93blRyYWNrZXJbcGFydERhdGEuUGFydElkZW50aWZpZXJdID0gdGljaygpCgogICAgLS0gVGVsZXBvcnQgJiBUb3VjaCBtZXRob2QKICAgIGxvY2FsIG9yaWdpbmFsUG9zaXRpb24gPSBwbGF5ZXJSb290LkNGcmFtZQogICAgbG9jYWwgb3JpZ2luYWxIdW1hbm9pZFN0YXRlID0gcGxheWVySHVtYW5vaWQ6R2V0U3RhdGUoKQogICAgCiAgICBwbGF5ZXJIdW1hbm9pZDpDaGFuZ2VTdGF0ZShFbnVtLkh1bWFub2lkU3RhdGVUeXBlLlBoeXNpY3MpCiAgICAKICAgIGxvY2FsIHRhcmdldFBvc2l0aW9uID0gcGFydERhdGEuVG91Y2hQYXJ0LkNGcmFtZSArIFZlY3RvcjMubmV3KDAsIHZhbGVudGluZUNhbmR5VGVsZXBvcnRIZWlnaHQsIDApCiAgICAKICAgIGxvY2FsIHN1Y2Nlc3MgPSBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgcGxheWVyUm9vdC5DRnJhbWUgPSB0YXJnZXRQb3NpdGlvbgogICAgZW5kKQogICAgCiAgICBpZiBub3Qgc3VjY2VzcyB0aGVuCiAgICAgICAgcGxheWVyUm9vdC5DRnJhbWUgPSBvcmlnaW5hbFBvc2l0aW9uCiAgICAgICAgcGxheWVySHVtYW5vaWQ6Q2hhbmdlU3RhdGUob3JpZ2luYWxIdW1hbm9pZFN0YXRlKQogICAgICAgIHJldHVybiBmYWxzZQogICAgZW5kCiAgICAKICAgIHRhc2sud2FpdCgwLjA1KQogICAgCiAgICBsb2NhbCB0b3VjaFN1Y2Nlc3MgPSBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QocGxheWVyUm9vdCwgcGFydERhdGEuVG91Y2hQYXJ0LCAwKQogICAgICAgIHRhc2sud2FpdCgwLjAzKQogICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHBsYXllclJvb3QsIHBhcnREYXRhLlRvdWNoUGFydCwgMSkKICAgIGVuZCkKICAgIAogICAgdGFzay53YWl0KDAuMDIpCiAgICAKICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICBwbGF5ZXJSb290LkNGcmFtZSA9IG9yaWdpbmFsUG9zaXRpb24KICAgIGVuZCkKICAgIAogICAgcGxheWVySHVtYW5vaWQ6Q2hhbmdlU3RhdGUob3JpZ2luYWxIdW1hbm9pZFN0YXRlKQogICAgCiAgICBpZiB0b3VjaFN1Y2Nlc3MgdGhlbgogICAgICAgIC0tIFVwZGF0ZSBzdGF0cwogICAgICAgIHZhbGVudGluZUNhbmR5Q29sbGVjdGVkU3RhdHNbcGFydERhdGEuVHlwZV0gPSAodmFsZW50aW5lQ2FuZHlDb2xsZWN0ZWRTdGF0c1twYXJ0RGF0YS5UeXBlXSBvciAwKSArIDEKICAgICAgICB2YWxlbnRpbmVDYW5keUNvbGxlY3RlZFN0YXRzLlRvdGFsID0gdmFsZW50aW5lQ2FuZHlDb2xsZWN0ZWRTdGF0cy5Ub3RhbCArIDEKICAgICAgICAKICAgICAgICB2YWxlbnRpbmVDYW5keVByb2Nlc3NlZFBhcnRzW3BhcnREYXRhLlBhcnRJZGVudGlmaWVyXSA9IHsKICAgICAgICAgICAgdGltZSA9IHRpY2soKSwKICAgICAgICAgICAgdHlwZSA9IHBhcnREYXRhLlR5cGUKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcHJpbnQoc3RyaW5nLmZvcm1hdCgiW1ZhbGVudGluZUNhbmR5Q29sbGVjdF0gQ29sbGVjdGVkICVzOiAlcyAoVG90YWw6ICVzKSIsCiAgICAgICAgICAgIHBhcnREYXRhLlR5cGUsIHBhcnREYXRhLlBhcnROYW1lLCB2YWxlbnRpbmVDYW5keUNvbGxlY3RlZFN0YXRzLlRvdGFsKSkKICAgICAgICByZXR1cm4gdHJ1ZQogICAgZW5kCiAgICAKICAgIHJldHVybiBmYWxzZQplbmQKCi0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLS0gTUFJTiBDT0xMRUNUSU9OIExPT1AKLS09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpsb2NhbCBmdW5jdGlvbiBpbml0aWF0ZVZhbGVudGluZUNhbmR5Q29sbGVjdGlvbigpCiAgICBpZiB2YWxlbnRpbmVDYW5keUNvbGxlY3Rpb25UYXNrIHRoZW4gcmV0dXJuIGVuZAogICAgaXNWYWxlbnRpbmVDYW5keUNvbGxlY3RpbmcgPSB0cnVlCgogICAgLS0gU21hbGwgZGVsYXkgdG8gZW5zdXJlIGNoYXJhY3RlciBleGlzdHMKICAgIHRhc2sud2FpdCgwLjUpCiAgICBjcmVhdGVWYWxlbnRpbmVDYW5keVZpc3VhbFJhbmdlSW5kaWNhdG9yKCkKICAgIHNjYW5Gb3JWYWxlbnRpbmVDYW5keVBhcnRzKCkKCiAgICB2YWxlbnRpbmVDYW5keUNvbGxlY3Rpb25UYXNrID0gdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgaXNWYWxlbnRpbmVDYW5keUNvbGxlY3RpbmcgZG8KICAgICAgICAgICAgbG9jYWwgcGxheWVyUm9vdCA9IGdldFBsYXllclJvb3RQYXJ0KCkKICAgICAgICAgICAgbG9jYWwgcGxheWVySHVtYW5vaWQgPSBnZXRQbGF5ZXJIdW1hbm9pZCgpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBwbGF5ZXJSb290IGFuZCBwbGF5ZXJIdW1hbm9pZCBhbmQgcGxheWVySHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBwbGF5ZXJQb3NpdGlvbiA9IHBsYXllclJvb3QuUG9zaXRpb24KCiAgICAgICAgICAgICAgICBpZiB0aWNrKCkgLSB2YWxlbnRpbmVDYW5keUxhc3RTY2FuVGltZSA+IFZBTEVOVElORV9DQU5EWV9SRUZSRVNIX0lOVEVSVkFMIHRoZW4KICAgICAgICAgICAgICAgICAgICBzY2FuRm9yVmFsZW50aW5lQ2FuZHlQYXJ0cygpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBmb3IgaSA9ICN2YWxlbnRpbmVDYW5keUF2YWlsYWJsZVBhcnRzLCAxLCAtMSBkbwogICAgICAgICAgICAgICAgICAgIGxvY2FsIGN1cnJlbnRQYXJ0ID0gdmFsZW50aW5lQ2FuZHlBdmFpbGFibGVQYXJ0c1tpXQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBjdXJyZW50UGFydC5Nb2RlbE9iamVjdCBvciBub3QgY3VycmVudFBhcnQuTW9kZWxPYmplY3QuUGFyZW50IG9yCiAgICAgICAgICAgICAgICAgICAgICAgdGljaygpIC0gY3VycmVudFBhcnQuTGFzdENoZWNrZWQgPiAzMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLnJlbW92ZSh2YWxlbnRpbmVDYW5keUF2YWlsYWJsZVBhcnRzLCBpKQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFBhcnQuUG9zaXRpb24gPSBjdXJyZW50UGFydC5Ub3VjaFBhcnQuUG9zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFBhcnQuTGFzdENoZWNrZWQgPSB0aWNrKCkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGRpc3RhbmNlID0gKGN1cnJlbnRQYXJ0LlBvc2l0aW9uIC0gcGxheWVyUG9zaXRpb24pLk1hZ25pdHVkZQogICAgICAgICAgICAgICAgICAgICAgICBpZiBkaXN0YW5jZSA8PSB2YWxlbnRpbmVDYW5keUNvbGxlY3Rpb25SYW5nZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0aWNrKCkgLSB2YWxlbnRpbmVDYW5keUxhc3RDb2xsZWN0VGltZSA+PSB2YWxlbnRpbmVDYW5keUNvbGxlY3RDb29sZG93biB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYXR0ZW1wdFZhbGVudGluZUNhbmR5Q29sbGVjdGlvbihjdXJyZW50UGFydCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxlbnRpbmVDYW5keUxhc3RDb2xsZWN0VGltZSA9IHRpY2soKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5yZW1vdmUodmFsZW50aW5lQ2FuZHlBdmFpbGFibGVQYXJ0cywgaSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQYXJ0Lkxhc3RDaGVja2VkID0gdGljaygpIC0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjA4KQogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIHZhbGVudGluZUNhbmR5Q29sbGVjdGlvblRhc2sgPSBuaWwKICAgICAgICBwcmludCgiW1ZhbGVudGluZUNhbmR5Q29sbGVjdF0gQ29sbGVjdGlvbiBsb29wIHN0b3BwZWQiKQogICAgZW5kKQplbmQKCmxvY2FsIGZ1bmN0aW9uIHRlcm1pbmF0ZVZhbGVudGluZUNhbmR5Q29sbGVjdGlvbigpCiAgICBpc1ZhbGVudGluZUNhbmR5Q29sbGVjdGluZyA9IGZhbHNlCiAgICBpZiB2YWxlbnRpbmVDYW5keUNvbGxlY3Rpb25UYXNrIHRoZW4KICAgICAgICB0YXNrLmNhbmNlbCh2YWxlbnRpbmVDYW5keUNvbGxlY3Rpb25UYXNrKQogICAgICAgIHZhbGVudGluZUNhbmR5Q29sbGVjdGlvblRhc2sgPSBuaWwKICAgIGVuZAogICAgcmVtb3ZlVmFsZW50aW5lQ2FuZHlWaXN1YWxJbmRpY2F0b3IoKQplbmQKCi0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLS0gQVBJCi0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KbG9jYWwgVmFsZW50aW5lQ2FuZHlDb2xsZWN0b3JBUEkgPSB7fQoKZnVuY3Rpb24gVmFsZW50aW5lQ2FuZHlDb2xsZWN0b3JBUEkuQWN0aXZhdGUocmFuZ2UpCiAgICBpZiByYW5nZSB0aGVuIHZhbGVudGluZUNhbmR5Q29sbGVjdGlvblJhbmdlID0gbWF0aC5jbGFtcChyYW5nZSwgMjAsIDE1MCkgZW5kCiAgICBpZiBpc1ZhbGVudGluZUNhbmR5Q29sbGVjdGluZyB0aGVuIHJldHVybiBlbmQKICAgIGluaXRpYXRlVmFsZW50aW5lQ2FuZHlDb2xsZWN0aW9uKCkKICAgIHByaW50KCJbVmFsZW50aW5lQ2FuZHlDb2xsZWN0XSBBY3RpdmF0ZWQgLSBDb2xsZWN0aW5nIFZhbGVudGluZSAmIENhbmR5IikKZW5kCgpmdW5jdGlvbiBWYWxlbnRpbmVDYW5keUNvbGxlY3RvckFQSS5EZWFjdGl2YXRlKCkKICAgIGlmIG5vdCBpc1ZhbGVudGluZUNhbmR5Q29sbGVjdGluZyB0aGVuIHJldHVybiBlbmQKICAgIHRlcm1pbmF0ZVZhbGVudGluZUNhbmR5Q29sbGVjdGlvbigpCiAgICBwcmludCgiW1ZhbGVudGluZUNhbmR5Q29sbGVjdF0gRGVhY3RpdmF0ZWQiKQplbmQKCmZ1bmN0aW9uIFZhbGVudGluZUNhbmR5Q29sbGVjdG9yQVBJLlRvZ2dsZUFjdGl2YXRpb24oKQogICAgaWYgaXNWYWxlbnRpbmVDYW5keUNvbGxlY3RpbmcgdGhlbgogICAgICAgIFZhbGVudGluZUNhbmR5Q29sbGVjdG9yQVBJLkRlYWN0aXZhdGUoKQogICAgZWxzZQogICAgICAgIFZhbGVudGluZUNhbmR5Q29sbGVjdG9yQVBJLkFjdGl2YXRlKCkKICAgIGVuZAplbmQKCmZ1bmN0aW9uIFZhbGVudGluZUNhbmR5Q29sbGVjdG9yQVBJLkFkanVzdFJhbmdlKG5ld1JhbmdlKQogICAgdmFsZW50aW5lQ2FuZHlDb2xsZWN0aW9uUmFuZ2UgPSBtYXRoLmNsYW1wKG5ld1JhbmdlLCAyMCwgMTUwKQogICAgCiAgICBpZiB2YWxlbnRpbmVDYW5keVZpc3VhbFJhbmdlSW5kaWNhdG9yIHRoZW4KICAgICAgICBsb2NhbCBwYXJ0cyA9IHZhbGVudGluZUNhbmR5VmlzdWFsUmFuZ2VJbmRpY2F0b3I6R2V0Q2hpbGRyZW4oKQogICAgICAgIGZvciBfLCBwYXJ0IGluIGlwYWlycyhwYXJ0cykgZG8KICAgICAgICAgICAgaWYgcGFydDpJc0EoIkJhc2VQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgaWYgcGFydC5OYW1lID09ICJWYWxlbnRpbmVSYW5nZSIgdGhlbgogICAgICAgICAgICAgICAgICAgIHBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KHZhbGVudGluZUNhbmR5Q29sbGVjdGlvblJhbmdlICogMiwgMC4xLCB2YWxlbnRpbmVDYW5keUNvbGxlY3Rpb25SYW5nZSAqIDIpCiAgICAgICAgICAgICAgICBlbHNlaWYgcGFydC5OYW1lID09ICJDYW5keVJhbmdlIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgcGFydC5TaXplID0gVmVjdG9yMy5uZXcodmFsZW50aW5lQ2FuZHlDb2xsZWN0aW9uUmFuZ2UgKiAyICsgMC41LCAwLjE1LCB2YWxlbnRpbmVDYW5keUNvbGxlY3Rpb25SYW5nZSAqIDIgKyAwLjUpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgcHJpbnQoc3RyaW5nLmZvcm1hdCgiW1ZhbGVudGluZUNhbmR5Q29sbGVjdF0gUmFuZ2Ugc2V0IHRvICVkIiwgdmFsZW50aW5lQ2FuZHlDb2xsZWN0aW9uUmFuZ2UpKQplbmQKCmZ1bmN0aW9uIFZhbGVudGluZUNhbmR5Q29sbGVjdG9yQVBJLlJlZnJlc2hQYXJ0cygpCiAgICBzY2FuRm9yVmFsZW50aW5lQ2FuZHlQYXJ0cygpCiAgICBwcmludCgiW1ZhbGVudGluZUNhbmR5Q29sbGVjdF0gQ2FjaGUgcmVmcmVzaGVkIikKZW5kCgpmdW5jdGlvbiBWYWxlbnRpbmVDYW5keUNvbGxlY3RvckFQSS5HZXRTdGF0dXMoKQogICAgbG9jYWwgdmFsZW50aW5lRm91bmQgPSAwCiAgICBsb2NhbCBjYW5keUZvdW5kID0gMAogICAgCiAgICBmb3IgXywgcGFydCBpbiBpcGFpcnModmFsZW50aW5lQ2FuZHlBdmFpbGFibGVQYXJ0cykgZG8KICAgICAgICBpZiBwYXJ0LlR5cGUgPT0gIlZhbGVudGluZSIgdGhlbgogICAgICAgICAgICB2YWxlbnRpbmVGb3VuZCA9IHZhbGVudGluZUZvdW5kICsgMQogICAgICAgIGVsc2UKICAgICAgICAgICAgY2FuZHlGb3VuZCA9IGNhbmR5Rm91bmQgKyAxCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgcmV0dXJuIHsKICAgICAgICBBY3RpdmUgPSBpc1ZhbGVudGluZUNhbmR5Q29sbGVjdGluZywKICAgICAgICBSYW5nZSA9IHZhbGVudGluZUNhbmR5Q29sbGVjdGlvblJhbmdlLAogICAgICAgIFZhbGVudGluZUZvdW5kID0gdmFsZW50aW5lRm91bmQsCiAgICAgICAgQ2FuZHlGb3VuZCA9IGNhbmR5Rm91bmQsCiAgICAgICAgVG90YWxGb3VuZCA9ICN2YWxlbnRpbmVDYW5keUF2YWlsYWJsZVBhcnRzLAogICAgICAgIFZhbGVudGluZUNvbGxlY3RlZCA9IHZhbGVudGluZUNhbmR5Q29sbGVjdGVkU3RhdHMuVmFsZW50aW5lIG9yIDAsCiAgICAgICAgQ2FuZHlDb2xsZWN0ZWQgPSB2YWxlbnRpbmVDYW5keUNvbGxlY3RlZFN0YXRzLkNhbmR5IG9yIDAsCiAgICAgICAgVG90YWxDb2xsZWN0ZWQgPSB2YWxlbnRpbmVDYW5keUNvbGxlY3RlZFN0YXRzLlRvdGFsLAogICAgICAgIENvb2xkb3duID0gdmFsZW50aW5lQ2FuZHlDb2xsZWN0Q29vbGRvd24KICAgIH0KZW5kCgpmdW5jdGlvbiBWYWxlbnRpbmVDYW5keUNvbGxlY3RvckFQSS5TZXRDb29sZG93bihjb29sZG93bikKICAgIHZhbGVudGluZUNhbmR5Q29sbGVjdENvb2xkb3duID0gbWF0aC5tYXgoMC4xLCBjb29sZG93bikKICAgIHByaW50KHN0cmluZy5mb3JtYXQoIltWYWxlbnRpbmVDYW5keUNvbGxlY3RdIENvb2xkb3duIHNldCB0byAlLjJmIHNlY29uZHMiLCB2YWxlbnRpbmVDYW5keUNvbGxlY3RDb29sZG93bikpCmVuZAoKZnVuY3Rpb24gVmFsZW50aW5lQ2FuZHlDb2xsZWN0b3JBUEkuQ2xlYXJDYWNoZSgpCiAgICB2YWxlbnRpbmVDYW5keVByb2Nlc3NlZFBhcnRzID0ge30KICAgIHZhbGVudGluZUNhbmR5Q29vbGRvd25UcmFja2VyID0ge30KICAgIHZhbGVudGluZUNhbmR5Q29sbGVjdGVkU3RhdHMgPSB7VmFsZW50aW5lID0gMCwgQ2FuZHkgPSAwLCBUb3RhbCA9IDB9CiAgICBwcmludCgiW1ZhbGVudGluZUNhbmR5Q29sbGVjdF0gQ2FjaGUgY2xlYXJlZCIpCmVuZAoKZnVuY3Rpb24gVmFsZW50aW5lQ2FuZHlDb2xsZWN0b3JBUEkuUmVzZXRTdGF0cygpCiAgICB2YWxlbnRpbmVDYW5keUNvbGxlY3RlZFN0YXRzID0ge1ZhbGVudGluZSA9IDAsIENhbmR5ID0gMCwgVG90YWwgPSAwfQogICAgcHJpbnQoIltWYWxlbnRpbmVDYW5keUNvbGxlY3RdIFN0YXRzIHJlc2V0IikKZW5kCgotLT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci0tIEFVVE8tUkVDT05ORUNUCi0tPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KcGxheWVyLkNoYXJhY3RlckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgdGFzay53YWl0KDEpCiAgICBpZiBpc1ZhbGVudGluZUNhbmR5Q29sbGVjdGluZyB0aGVuCiAgICAgICAgdGVybWluYXRlVmFsZW50aW5lQ2FuZHlDb2xsZWN0aW9uKCkKICAgICAgICB0YXNrLndhaXQoMC4yKQogICAgICAgIGluaXRpYXRlVmFsZW50aW5lQ2FuZHlDb2xsZWN0aW9uKCkKICAgIGVuZAplbmQpCgotLSBQZXJpb2RpYyBzY2FubmluZwp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRydWUgZG8KICAgICAgICB0YXNrLndhaXQoVkFMRU5USU5FX0NBTkRZX1NDQU5fSU5URVJWQUwpCiAgICAgICAgaWYgaXNWYWxlbnRpbmVDYW5keUNvbGxlY3RpbmcgdGhlbgogICAgICAgICAgICBwY2FsbChzY2FuRm9yVmFsZW50aW5lQ2FuZHlQYXJ0cykKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpsb2NhbCBhbnRpUmFnZG9sbEVuYWJsZWQgPSBmYWxzZQpsb2NhbCBhbnRpQ29ubmVjdGlvbgpsb2NhbCBhbnRpU3RhdGVDb25uZWN0aW9uCmxvY2FsIGN1cnJlbnRDaGFyID0gbmlsCgpsb2NhbCBmdW5jdGlvbiBlbmFibGVBbnRpUmFnZG9sbChjaGFyYWN0ZXIpCiAgICBpZiBub3QgY2hhcmFjdGVyIHRoZW4gcmV0dXJuIGVuZAogICAgCiAgICBjdXJyZW50Q2hhciA9IGNoYXJhY3RlcgogICAgbG9jYWwgaHVtYW5vaWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJIdW1hbm9pZCIpCiAgICBpZiBub3QgaHVtYW5vaWQgdGhlbiByZXR1cm4gZW5kCiAgICAKICAgIC0tIEJlcnNpaGthbiBrb25la3NpIGxhbWEKICAgIGlmIGFudGlTdGF0ZUNvbm5lY3Rpb24gdGhlbgogICAgICAgIGFudGlTdGF0ZUNvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgYW50aVN0YXRlQ29ubmVjdGlvbiA9IG5pbAogICAgZW5kCiAgICBpZiBhbnRpQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgYW50aUNvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgYW50aUNvbm5lY3Rpb24gPSBuaWwKICAgIGVuZAogICAgCiAgICBwcmludCgiW0FOVEkgUkFHRE9MTF0gRU5BQkxFRCIpCgogICAgLS0gRm9yY2Ugc3RhdGUgbm9ybWFsCiAgICBodW1hbm9pZC5QbGF0Zm9ybVN0YW5kID0gZmFsc2UKICAgIGh1bWFub2lkLkF1dG9Sb3RhdGUgPSB0cnVlCiAgICBodW1hbm9pZDpDaGFuZ2VTdGF0ZShFbnVtLkh1bWFub2lkU3RhdGVUeXBlLkdldHRpbmdVcCkKCiAgICAtLSAx77iP4oOjIEJsb2sgUGh5c2ljcyBTdGF0ZQogICAgYW50aVN0YXRlQ29ubmVjdGlvbiA9IGh1bWFub2lkLlN0YXRlQ2hhbmdlZDpDb25uZWN0KGZ1bmN0aW9uKG9sZCwgbmV3KQogICAgICAgIGlmIG5vdCBhbnRpUmFnZG9sbEVuYWJsZWQgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgaWYgbm90IGh1bWFub2lkIG9yIG5vdCBodW1hbm9pZC5QYXJlbnQgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgCiAgICAgICAgaWYgbmV3ID09IEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuUGh5c2ljcyAKICAgICAgICBvciBuZXcgPT0gRW51bS5IdW1hbm9pZFN0YXRlVHlwZS5SYWdkb2xsCiAgICAgICAgb3IgbmV3ID09IEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuRmFsbGluZ0Rvd24gdGhlbgogICAgICAgICAgICAKICAgICAgICAgICAgaHVtYW5vaWQuUGxhdGZvcm1TdGFuZCA9IGZhbHNlCiAgICAgICAgICAgIGh1bWFub2lkLkF1dG9Sb3RhdGUgPSB0cnVlCiAgICAgICAgICAgIGh1bWFub2lkOkNoYW5nZVN0YXRlKEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuR2V0dGluZ1VwKQogICAgICAgIGVuZAogICAgZW5kKQoKICAgIC0tIDLvuI/ig6MgRm9yY2UgbG9vcCBjaGVjawogICAgYW50aUNvbm5lY3Rpb24gPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgaWYgbm90IGFudGlSYWdkb2xsRW5hYmxlZCB0aGVuIHJldHVybiBlbmQKICAgICAgICBpZiBub3QgaHVtYW5vaWQgb3Igbm90IGh1bWFub2lkLlBhcmVudCB0aGVuIHJldHVybiBlbmQKICAgICAgICAKICAgICAgICBpZiBodW1hbm9pZC5QbGF0Zm9ybVN0YW5kIHRoZW4KICAgICAgICAgICAgaHVtYW5vaWQuUGxhdGZvcm1TdGFuZCA9IGZhbHNlCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgaWYgaHVtYW5vaWQ6R2V0U3RhdGUoKSA9PSBFbnVtLkh1bWFub2lkU3RhdGVUeXBlLlBoeXNpY3MgdGhlbgogICAgICAgICAgICBodW1hbm9pZDpDaGFuZ2VTdGF0ZShFbnVtLkh1bWFub2lkU3RhdGVUeXBlLkdldHRpbmdVcCkKICAgICAgICBlbmQKICAgIGVuZCkKCiAgICAtLSAz77iP4oOjIFJlLWVuYWJsZSBzZW11YSBNb3RvcjZEIGthbGF1IGFkYSB5YW5nIGRpbWF0aWthbgogICAgZm9yIF8sIHYgaW4gcGFpcnMoY2hhcmFjdGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgaWYgdjpJc0EoIk1vdG9yNkQiKSB0aGVuCiAgICAgICAgICAgIHYuRW5hYmxlZCA9IHRydWUKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIGRpc2FibGVBbnRpUmFnZG9sbCgpCiAgICBwcmludCgiW0FOVEkgUkFHRE9MTF0gRElTQUJMRUQiKQoKICAgIGlmIGFudGlDb25uZWN0aW9uIHRoZW4KICAgICAgICBhbnRpQ29ubmVjdGlvbjpEaXNjb25uZWN0KCkKICAgICAgICBhbnRpQ29ubmVjdGlvbiA9IG5pbAogICAgZW5kCgogICAgaWYgYW50aVN0YXRlQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgYW50aVN0YXRlQ29ubmVjdGlvbjpEaXNjb25uZWN0KCkKICAgICAgICBhbnRpU3RhdGVDb25uZWN0aW9uID0gbmlsCiAgICBlbmQKICAgIAogICAgY3VycmVudENoYXIgPSBuaWwKZW5kCgppZiBwbGF5ZXIgdGhlbgogICAgLS0gTW9uaXRvciBrYXJha3RlciBiYXJ1IHNhYXQgcmVzcGF3bgogICAgcGxheWVyLkNoYXJhY3RlckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24obmV3Q2hhcikKICAgICAgICBwcmludCgiW0FOVEkgUkFHRE9MTF0gUmVzcGF3biBkZXRlY3RlZCEiKQogICAgICAgIGlmIGFudGlSYWdkb2xsRW5hYmxlZCB0aGVuCiAgICAgICAgICAgIC0tIEthc2loIHNlZGlraXQgZGVsYXkgYmlhciBrYXJha3RlciBmdWxseSBsb2FkZWQKICAgICAgICAgICAgdGFzay53YWl0KDAuNSkKICAgICAgICAgICAgZW5hYmxlQW50aVJhZ2RvbGwobmV3Q2hhcikKICAgICAgICBlbmQKICAgIGVuZCkKICAgIAogICAgLS0gTW9uaXRvciBrYWxhdSBrYXJha3RlciBpbGFuZyAobWF0aSkKICAgIHBsYXllci5DaGFyYWN0ZXJSZW1vdmluZzpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICBwcmludCgiW0FOVEkgUkFHRE9MTF0gQ2hhcmFjdGVyIHJlbW92ZWQsIHdhaXRpbmcgZm9yIHJlc3Bhd24uLi4iKQogICAgICAgIGRpc2FibGVBbnRpUmFnZG9sbCgpCiAgICBlbmQpCmVuZAotLSA9PT09PT09PT09PT09PT09PT09PT09PT0gQ1JFQVRFIFRBQlMgPT09PT09PT09PT09PT09PT09PT09PT09CmxvY2FsIEluZm9UYWIgPSBXaW5kb3c6QWRkVGFiKHsKICAgIFRpdGxlID0gIkluZm8iLAogICAgSWNvbiA9ICJyYnhhc3NldGlkOi8vMTA3MjM0MTU5MDMiCn0pCgpsb2NhbCBNYWluTWVudSA9IFdpbmRvdzpBZGRUYWIoewogICAgVGl0bGUgPSAiTWFpbiBNZW51IiwKICAgIEljb24gPSAicmJ4YXNzZXRpZDovLzEwNzA5NzYxODg5Igp9KQoKbG9jYWwgSGVscGVyVGFicyA9IFdpbmRvdzpBZGRUYWIoewogICAgVGl0bGUgPSAiSGVscGVyIE1lbnUiLAogICAgSWNvbiA9ICJyYnhhc3NldGlkOi8vMTA3MDk4MTg2MjYiCn0pCgotLSA9PT09PT09PT09PT09PT09PT09PT09PT0gQ1JFQVRFIFNFQ1RJT04gPT09PT09PT09PT09PT09PT09PT09PT09CkluZm9UYWI6QWRkRGlzY29yZCgiRGlzY29yZFdpdGhNZW1iZXJzIiwgewogICAgVGl0bGUgPSAiQ3lydXMgSHViIHwgT2ZmaWNpYWwiLAogICAgRGVzY3JpcHRpb24gPSAiSm9pbiA0MDArIG1lbWJlcnMhIiwKICAgIEljb24gPSAicmJ4YXNzZXRpZDovLzcyNTU4MjM3MDk1MDAxIiwgIC0tIEJpc2EgZ2FudGkgaWNvbgogICAgCiAgICAtLSBUYW1waWxrYW4gbWVtYmVyIGNvdW50CiAgICBWaWV3TWVtYmVyID0gdHJ1ZSwKICAgIE1lbWJlcnMgPSA0MDIsICAgICAgICAtLSBUb3RhbCBtZW1iZXJzCiAgICBPbmxpbmVNZW1iZXJzID0gMTIwLCAgICAtLSBPbmxpbmUgbm93CiAgICAKICAgIEJ1dHRvbkpvaW4gPSB0cnVlLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgc2V0Y2xpcGJvYXJkKCJodHRwczovL2Rpc2NvcmQuZ2cvZDNOU3pjcFJaNSIpCiAgICAgICAgTGlicmFyeTpOb3RpZnkoewogICAgICAgICAgICBUaXRsZSA9ICLinIUgU3VjY2VzcyIsCiAgICAgICAgICAgIENvbnRlbnQgPSAiRGlzY29yZCBsaW5rIGNvcGllZCEiLAogICAgICAgICAgICBEdXJhdGlvbiA9IDMKICAgICAgICB9KQogICAgZW5kCn0pCgotLSBEZXZlbG9wZXIgYnV0dG9ucwpJbmZvVGFiOkFkZEJ1dHRvbih7CiAgICBUaXRsZSA9ICJZb3VUdWJlOiBAQ3lydXNPZmZjIiwKICAgIERlc2NyaXB0aW9uID0gIlN1YnNjcmliZSBmb3IgbW9yZSBzY3JpcHRzISIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCB5b3V0dWJlTGluayA9ICJodHRwczovL3lvdXR1YmUuY29tL0BjeXJ1c29mZmM/c2k9WHctanMxOFo1ZjI3YnJraiIKICAgICAgICBpZiBzZXRjbGlwYm9hcmQgdGhlbgogICAgICAgICAgICBzZXRjbGlwYm9hcmQoeW91dHViZUxpbmspCiAgICAgICAgICAgIExpYnJhcnk6Tm90aWZ5KHsKICAgICAgICAgICAgICAgIFRpdGxlID0gIlN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgQ29udGVudCA9ICJZb3VUdWJlIGxpbmsgY29waWVkISIsCiAgICAgICAgICAgICAgICBEdXJhdGlvbiA9IDMKICAgICAgICAgICAgfSkKICAgICAgICBlbmQKICAgIGVuZAp9KQoKSW5mb1RhYjpBZGRCdXR0b24oewogICAgVGl0bGUgPSAiV2hhdHNBcHAgR3JvdXAiLAogICAgRGVzY3JpcHRpb24gPSAiSm9pbiBvdXIgV2hhdHNBcHAgZ3JvdXAiLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgbG9jYWwgd2hhdHNhcHBMaW5rID0gImh0dHBzOi8vY2hhdC53aGF0c2FwcC5jb20vRjkzMFE5UUExRW1DMFJwVGhvUVU1MiIKICAgICAgICBpZiBzZXRjbGlwYm9hcmQgdGhlbgogICAgICAgICAgICBzZXRjbGlwYm9hcmQod2hhdHNhcHBMaW5rKQogICAgICAgICAgICBMaWJyYXJ5Ok5vdGlmeSh7CiAgICAgICAgICAgICAgICBUaXRsZSA9ICJTdWNjZXNzIiwKICAgICAgICAgICAgICAgIENvbnRlbnQgPSAiV2hhdHNBcHAgbGluayBjb3BpZWQhIiwKICAgICAgICAgICAgICAgIER1cmF0aW9uID0gMwogICAgICAgICAgICB9KQogICAgICAgIGVuZAogICAgZW5kCn0pCgpJbmZvVGFiOkFkZFBhcmFncmFwaCh7CiAgICBUaXRsZSA9ICJVcGRhdGUgSW5mbyIsCiAgICBSaWNoVGV4dCA9IHRydWUsCiAgICBDb250ZW50ID0gdGFibGUuY29uY2F0KHsKICAgICAgICAnPGZvbnQgY29sb3I9InJnYigxMjAsMjU1LDEyMCkiPisgQmV0YSBGYXJtIEJyYWlucm90PC9mb250PicsCiAgICAgICAgJzxmb250IGNvbG9yPSJyZ2IoMTIwLDI1NSwxMjApIj4rIEdvZG1vZGUgVmlwIFdhbGw8L2ZvbnQ+JywKICAgICAgICAnPGZvbnQgY29sb3I9InJnYigxMjAsMTgwLDI1NSkiPi8gVHAgVmlwPC9mb250PicsCiAgICB9LCAiXG4iKQp9KQoKLS0gPT09PT09PT09PT09PT09PT09PT09PT09IE1BSU4gTUVOVSBTRUNUSU9OUyA9PT09PT09PT09PT09PT09PT09PT09PT0KbG9jYWwgRmFybVNlY3Rpb24gPSBNYWluTWVudTpBZGRTZWN0aW9uKCJBdXRvIEZhcm0gQnJhaW5yb3QiKQpsb2NhbCBIZWxwZXJTZWN0aW9uID0gSGVscGVyVGFiczpBZGRTZWN0aW9uKCJIZWxwZXIiKQpsb2NhbCBFdmVudFNlY3Rpb24gPSBIZWxwZXJUYWJzOkFkZFNlY3Rpb24oIkV2ZW50IikKCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi0tIFVJIENPTlRST0xTIChhc3N1bXNpIG1lbmdndW5ha2FuIEZsdWVudC9SYXlmaWVsZCkKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLS0gRFJPUERPV046IFBpbGloIFJhcml0eQpGYXJtU2VjdGlvbjpBZGREcm9wZG93bigiQnJhaW5yb3RSYXJpdHkiLCB7CiAgICBUaXRsZSA9ICJCcmFpbnJvdCBSYXJpdHkiLAogICAgRGVzY3JpcHRpb24gPSAiU2VsZWN0IGJyYWlucm90IHJhcml0eSIsCiAgICBWYWx1ZXMgPSB7CiAgICAgICAgIkNvbW1vbiIsIlVuY29tbW9uIiwiUmFyZSIsIkVwaWMiLCJMZWdlbmRhcnkiLAogICAgICAgICJNeXRoaWNhbCIsIkNvc21pYyIsIlNlY3JldCIsIkNlbGVzdGlhbCIsIkRpdmluZSIsIkluZmluaXR5IgogICAgfSwKICAgIERlZmF1bHQgPSBzZWxlY3RlZFJhcml0eSwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24odikKICAgICAgICBzZWxlY3RlZFJhcml0eSA9IHYKICAgICAgICBwcmludCgiW0NvbmZpZ10gUmFyaXR5IHNldCB0bzoiLCB2KQogICAgZW5kCn0pCgotLSBUT0dHTEU6IEF1dG8gRmFybSBCcmFpbnJvdApGYXJtU2VjdGlvbjpBZGRUb2dnbGUoIkF1dG9GYXJtQnJhaW5yb3QiLCB7CiAgICBUaXRsZSA9ICJBdXRvIEZhcm0gQnJhaW5yb3QiLAogICAgRGVzY3JpcHRpb24gPSAiQXV0byBUUCwgY29sbGVjdCBicmFpbnJvdCIsCiAgICBEZWZhdWx0ID0gYXV0b0JyYWlucm90RW5hYmxlZCwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgYXV0b0JyYWlucm90RW5hYmxlZCA9IHN0YXRlCiAgICAgICAgaWYgc3RhdGUgdGhlbgogICAgICAgICAgICBpZiBhdXRvQnJhaW5yb3RUaHJlYWQgdGhlbiAKICAgICAgICAgICAgICAgIHByaW50KCJbRmFybV0gQWxyZWFkeSBydW5uaW5nISIpCiAgICAgICAgICAgICAgICByZXR1cm4gCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBwcmludCgiW0Zhcm1dIFN0YXJ0aW5nIGF1dG8gYnJhaW5yb3QgZmFybSB3aXRoIHJhcml0eToiLCBzZWxlY3RlZFJhcml0eSkKICAgICAgICAgICAgYXV0b0JyYWlucm90VGhyZWFkID0gdGFzay5zcGF3bihydW5CcmFpbnJvdEZhcm0pCiAgICAgICAgZWxzZQogICAgICAgICAgICBwcmludCgiW0Zhcm1dIFN0b3BwaW5nIGF1dG8gYnJhaW5yb3QgZmFybS4uLiIpCiAgICAgICAgICAgIGF1dG9CcmFpbnJvdEVuYWJsZWQgPSBmYWxzZQogICAgICAgIGVuZAogICAgZW5kCn0pCgpNYWluTWVudTpBZGRCdXR0b24oewogICAgVGl0bGUgPSAiR29kIE1vZGUgUGVyZmVjdCAxMDAlIiwKICAgIERlc2NyaXB0aW9uID0gIkNsaWNrIE9uIFdoZW4gV2F2ZSBJcyBOZWFyISEiLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgbG9jYWwgc2NyaXB0VXJsID0gImh0dHBzOi8vcGFzdGViaW4uY29tL3Jhdy9rYmhZUTdVVSIKICAgICAgICAKICAgICAgICAtLSBNZW5nYW1iaWwgc2NyaXB0IGRhcmkgVVJMCiAgICAgICAgbG9jYWwgc3VjY2VzcywgcmVzcG9uc2UgPSBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgIHJldHVybiBnYW1lOkh0dHBHZXQoc2NyaXB0VXJsKQogICAgICAgIGVuZCkKICAgICAgICAKICAgICAgICBpZiBzdWNjZXNzIGFuZCByZXNwb25zZSB0aGVuCiAgICAgICAgICAgIC0tIE1lbmphbGFua2FuIGxvYWRzdHJpbmcgZGFyaSByZXNwb25zZQogICAgICAgICAgICBsb2NhbCBsb2FkU3VjY2VzcywgbG9hZFJlc3VsdCA9IHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGxvY2FsIGZ1bmMgPSBsb2Fkc3RyaW5nKHJlc3BvbnNlKQogICAgICAgICAgICAgICAgaWYgZnVuYyB0aGVuCiAgICAgICAgICAgICAgICAgICAgZnVuYygpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgZXJyb3IoIkZhaWxlZCB0byBsb2FkIHNjcmlwdCBmcm9tIFVSTCIpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbG9hZFN1Y2Nlc3MgdGhlbgogICAgICAgICAgICAgICAgTGlicmFyeTpOb3RpZnkoewogICAgICAgICAgICAgICAgICAgIFRpdGxlID0gIlN1Y2Nlc3MiLAogICAgICAgICAgICAgICAgICAgIENvbnRlbnQgPSAiU2NyaXB0IGxvYWRlZCBzdWNjZXNzZnVsbHkhIiwKICAgICAgICAgICAgICAgICAgICBEdXJhdGlvbiA9IDMKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIExpYnJhcnk6Tm90aWZ5KHsKICAgICAgICAgICAgICAgICAgICBUaXRsZSA9ICJFcnJvciIsCiAgICAgICAgICAgICAgICAgICAgQ29udGVudCA9ICJGYWlsZWQgdG8gbG9hZCBzY3JpcHQ6ICIgLi4gdG9zdHJpbmcobG9hZFJlc3VsdCksCiAgICAgICAgICAgICAgICAgICAgRHVyYXRpb24gPSA1CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlCiAgICAgICAgICAgIExpYnJhcnk6Tm90aWZ5KHsKICAgICAgICAgICAgICAgIFRpdGxlID0gIkVycm9yIiwKICAgICAgICAgICAgICAgIENvbnRlbnQgPSAiRmFpbGVkIHRvIGZldGNoIHNjcmlwdCBmcm9tIFVSTCIsCiAgICAgICAgICAgICAgICBEdXJhdGlvbiA9IDUKICAgICAgICAgICAgfSkKICAgICAgICBlbmQKICAgIGVuZAp9KQpNYWluTWVudTpBZGRCdXR0b24oewogICAgVGl0bGUgPSAiUmVtb3ZlIFZpcCBXYWxsIiwKICAgIERlc2NyaXB0aW9uID0gIkNsaWNrIEZvciBEZWxldGUgV2FsbCBWaXAiLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpCiAgICAgICAgcmVtb3ZlVklQTW9kZWxzKCkgLS0gVEFOUEEgVmFsdWUKICAgIGVuZAp9KQoKLS0gVG9nZ2xlCk1haW5NZW51OkFkZFRvZ2dsZSgiR29kTW9kZVdhbGwiLCB7CiAgICBUaXRsZSA9ICJHb2QgTW9kZSBXYWxsIiwKICAgIERlc2NyaXB0aW9uID0gIlJlbW92ZSB3YWxscyBhbmQgY3JlYXRlIG5lb24gcGF0aCB3aXRoIGJhcnJpZXIiLAogICAgRGVmYXVsdCA9IGZhbHNlLAogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkKICAgICAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgICAgIGVuYWJsZUdvZE1vZGVXYWxsKCkKICAgICAgICBlbHNlCiAgICAgICAgICAgIGRpc2FibGVHb2RNb2RlV2FsbCgpCiAgICAgICAgZW5kCiAgICBlbmQKfSkKCi0tIFRPR0dMRSBMVSAoR0FLIEJFUlVCQUggU0FNQSBTRUtBTEkpCkhlbHBlclNlY3Rpb246QWRkVG9nZ2xlKCJBbnRpUmFnZG9sbCIsIHsKICAgIFRpdGxlID0gIkFudGkgUmFnZG9sbCIsCiAgICBEZXNjcmlwdGlvbiA9ICJQcmV2ZW50cyBhbGwgcmFnZG9sbCBlZmZlY3RzIiwKICAgIERlZmF1bHQgPSBmYWxzZSwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgYW50aVJhZ2RvbGxFbmFibGVkID0gVmFsdWUKICAgICAgICAKICAgICAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgICAgIGlmIHBsYXllci5DaGFyYWN0ZXIgdGhlbgogICAgICAgICAgICAgICAgZW5hYmxlQW50aVJhZ2RvbGwocGxheWVyLkNoYXJhY3RlcikKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZQogICAgICAgICAgICBkaXNhYmxlQW50aVJhZ2RvbGwoKQogICAgICAgIGVuZAogICAgZW5kCn0pCgotLSBUYW1iYWhrYW4gdG9nZ2xlIGRpIHNlY3Rpb24gSGVscGVyCkhlbHBlclNlY3Rpb246QWRkVG9nZ2xlKCJJbnN0YW50UHJveGltaXR5UHJvbXB0IiwgewogICAgVGl0bGUgPSAiSW5zdGFudCBUYWtlIiwKICAgIERlc2NyaXB0aW9uID0gIkluc3RhbnQgVGFrZSBGZWF0dXJlIE5ldyIsCiAgICBEZWZhdWx0ID0gZmFsc2UsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIGluc3RhbnRQcm9tcHRFbmFibGVkID0gVmFsdWUKICAgICAgICAKICAgICAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgICAgIGVuYWJsZUluc3RhbnRQcm94aW1pdHlQcm9tcHQoKQogICAgICAgICAgICBMaWJyYXJ5Ok5vdGlmeSh7CiAgICAgICAgICAgICAgICBUaXRsZSA9ICJJbnN0YW50IFByb3hpbWl0eVByb21wdCIsCiAgICAgICAgICAgICAgICBDb250ZW50ID0gIkRpYWt0aWZrYW4gLSBTZW11YSBwcm9tcHQgamFkaSAxeCBrbGlrISIsCiAgICAgICAgICAgICAgICBEdXJhdGlvbiA9IDMKICAgICAgICAgICAgfSkKICAgICAgICBlbHNlCiAgICAgICAgICAgIGRpc2FibGVJbnN0YW50UHJveGltaXR5UHJvbXB0KCkKICAgICAgICAgICAgTGlicmFyeTpOb3RpZnkoewogICAgICAgICAgICAgICAgVGl0bGUgPSAiSW5zdGFudCBQcm94aW1pdHlQcm9tcHQiLAogICAgICAgICAgICAgICAgQ29udGVudCA9ICJEaW5vbmFrdGlma2FuIiwKICAgICAgICAgICAgICAgIER1cmF0aW9uID0gMgogICAgICAgICAgICB9KQogICAgICAgIGVuZAogICAgZW5kCn0pCgpIZWxwZXJTZWN0aW9uOkFkZFRvZ2dsZSgiTWFnbmV0UHJveGltaXR5UHJvbXB0IiwgewogICAgVGl0bGUgPSAiQXV0byBwcm94aW1pdHkiLAogICAgRGVzY3JpcHRpb24gPSAiVGFrZSBCcmFpbnJvdCBhdXRvbWF0aWMgcHJveGltaXR5IiwKICAgIERlZmF1bHQgPSBmYWxzZSwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpCiAgICAgICAgbWFnbmV0RW5hYmxlZCA9IFZhbHVlCiAgICAgICAgCiAgICAgICAgaWYgVmFsdWUgdGhlbgogICAgICAgICAgICBlbmFibGVNYWduZXRQcm94aW1pdHlQcm9tcHQoKQogICAgICAgICAgICAKICAgICAgICAgICAgLS0gQWt0aWZrYW4ganVnYSBpbnN0YW50IHByb21wdCBqaWthIGJlbHVtIGFrdGlmCiAgICAgICAgICAgIGlmIG5vdCBpbnN0YW50UHJvbXB0RW5hYmxlZCB0aGVuCiAgICAgICAgICAgICAgICBlbmFibGVJbnN0YW50UHJveGltaXR5UHJvbXB0KCkKICAgICAgICAgICAgICAgIGluc3RhbnRQcm9tcHRFbmFibGVkID0gdHJ1ZQogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlCiAgICAgICAgICAgIGRpc2FibGVNYWduZXRQcm94aW1pdHlQcm9tcHQoKQogICAgICAgIGVuZAogICAgZW5kCn0pCgpIZWxwZXJTZWN0aW9uOkFkZFRvZ2dsZSgiVW5sb2NrWm9vbVRvZ2dsZSIsIHsKICAgIFRpdGxlID0gIlVubG9jayBab29tIExpbWl0IiwKICAgIERlc2NyaXB0aW9uID0gIk9OID0gRnJlZSB6b29tIHwgT0ZGID0gTm9ybWFsIiwKICAgIERlZmF1bHQgPSBmYWxzZSwKICAgIENhbGxiYWNrID0gZnVuY3Rpb24odikKICAgICAgICBpZiB2IHRoZW4KICAgICAgICAgICAgVW5sb2NrWm9vbSgpCiAgICAgICAgICAgIExpYnJhcnk6Tm90aWZ5KHsKICAgICAgICAgICAgICAgIFRpdGxlID0gIlpvb20iLAogICAgICAgICAgICAgICAgQ29udGVudCA9ICJVbmxvY2tlZCIsCiAgICAgICAgICAgICAgICBEdXJhdGlvbiA9IDIKICAgICAgICAgICAgfSkKICAgICAgICBlbHNlCiAgICAgICAgICAgIExvY2tab29tKCkKICAgICAgICAgICAgTGlicmFyeTpOb3RpZnkoewogICAgICAgICAgICAgICAgVGl0bGUgPSAiWm9vbSIsCiAgICAgICAgICAgICAgICBDb250ZW50ID0gIlJlc3RvcmVkIHRvIGRlZmF1bHQiLAogICAgICAgICAgICAgICAgRHVyYXRpb24gPSAyCiAgICAgICAgICAgIH0pCiAgICAgICAgZW5kCiAgICBlbmQKfSkKCkhlbHBlclNlY3Rpb246QWRkQnV0dG9uKHsKICAgIFRpdGxlID0gIisxIEV4dHJhIExpZmUiLAogICAgRGVzY3JpcHRpb24gPSAiQWZ0ZXIgRGVhZCBDbGljayBBZ2FpbiIsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkKICAgICAgICBlbmFibGVGdWxsR29kTW9kZSgpCiAgICBlbmQKfSkKCiAgICAtLSBBZGQgdG9nZ2xlIHRvIEdVSQpFdmVudFNlY3Rpb246QWRkVG9nZ2xlKCJBdXRvQ29uc29sZUNvbGxlY3QiLCB7CiAgICAgICAgVGl0bGUgPSAiQXV0byBDb2xsZWN0IENvbnNvbGUiLAogICAgICAgIERlc2NyaXB0aW9uID0gIkF1dG9tYXRpY2FsbHkgY29sbGVjdCBnYW1lIGNvbnNvbGVzIGZyb20gYXJjYWRlIGV2ZW50cyIsCiAgICAgICAgRGVmYXVsdCA9IGZhbHNlLAogICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oc3RhdGUpCiAgICAgICAgICAgIGlmIHN0YXRlIHRoZW4KICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjUpIC0tIFNtYWxsIGRlbGF5IGZvciBzYWZldHkKICAgICAgICAgICAgICAgIGxvY2FsIHN1Y2Nlc3MsIGVyciA9IHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBDb25zb2xlQ29sbGVjdG9yQVBJLkFjdGl2YXRlKCkKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IHN1Y2Nlc3MgdGhlbgogICAgICAgICAgICAgICAgICAgIHdhcm4oIltDb25zb2xlQ29sbGVjdF0gRmFpbGVkIHRvIGFjdGl2YXRlOiIsIGVycikKICAgICAgICAgICAgICAgICAgICAtLSBSZXNldCB0b2dnbGUgaWYgZmFpbGVkCiAgICAgICAgICAgICAgICAgICAgaWYgU2VjdGlvbi5Ub2dnbGVzIGFuZCBTZWN0aW9uLlRvZ2dsZXMuQXV0b0NvbnNvbGVDb2xsZWN0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgU2VjdGlvbi5Ub2dnbGVzLkF1dG9Db25zb2xlQ29sbGVjdDpTZXQoZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIENvbnNvbGVDb2xsZWN0b3JBUEkuRGVhY3RpdmF0ZSgpCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgfSkKICAgIAotLSBUb2dnbGUgZGkgVUkKRXZlbnRTZWN0aW9uOkFkZFRvZ2dsZSgiQXV0b1ZhbGVudGluZUNhbmR5Q29sbGVjdCIsIHsKICAgIFRpdGxlID0gIkF1dG8gQ29sbGVjdCBWYWxlbnRpbmUgJiBDYW5keSIsCiAgICBEZXNjcmlwdGlvbiA9ICJDb2xsZWN0IGJvdGggVmFsZW50aW5lIGNvaW5zIGFuZCBDYW5keSBldmVudCBwYXJ0cyIsCiAgICBEZWZhdWx0ID0gZmFsc2UsCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICBsb2NhbCBzdWNjZXNzLCBlcnIgPSBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBzdGF0ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgVmFsZW50aW5lQ2FuZHlDb2xsZWN0b3JBUEkuQWN0aXZhdGUoNjUpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIuKchSBBdXRvIFZhbGVudGluZSAmIENhbmR5OiBPTiIpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgVmFsZW50aW5lQ2FuZHlDb2xsZWN0b3JBUEkuRGVhY3RpdmF0ZSgpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgc3RhdHMgPSBWYWxlbnRpbmVDYW5keUNvbGxlY3RvckFQSS5HZXRTdGF0dXMoKQogICAgICAgICAgICAgICAgICAgIHByaW50KHN0cmluZy5mb3JtYXQoIuKdjCBPRkYgfCBTdGF0czogVmFsZW50aW5lOiAlZCwgQ2FuZHk6ICVkLCBUb3RhbDogJWQiLAogICAgICAgICAgICAgICAgICAgICAgICBzdGF0cy5WYWxlbnRpbmVDb2xsZWN0ZWQsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRzLkNhbmR5Q29sbGVjdGVkLAogICAgICAgICAgICAgICAgICAgICAgICBzdGF0cy5Ub3RhbENvbGxlY3RlZAogICAgICAgICAgICAgICAgICAgICkpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgICAgICBpZiBub3Qgc3VjY2VzcyB0aGVuCiAgICAgICAgICAgICAgICB3YXJuKCJFcnJvciBpbiB0b2dnbGUgY2FsbGJhY2s6ICIgLi4gdG9zdHJpbmcoZXJyKSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCn0pCgotLSA9PT09PT09PT09PT09PT09PT09PT09PT0gSU5JVElBTCBOT1RJRklDQVRJT04gPT09PT09PT09PT09PT09PT09PT09PT09CnRhc2sud2FpdCgxKQoKTGlicmFyeTpOb3RpZnkoewogICAgVGl0bGUgPSAiQ3lydXMgSHViIFggLSBFc2NhcGUgVHN1bmFtaSBGb3IgQnJhaW5yb3QiLAogICAgQ29udGVudCA9ICJJbXByb3ZlLCBhbmQgTmV3IEZlYXR1cmUhIiwKICAgIFN1YkNvbnRlbnQgPSAiRXNjcGFlIFRzdW5hbWkgRm9yIEJyYWlucm90IiwKICAgIER1cmF0aW9uID0gNQp9KSAg"
local _hijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYDEFGHIJKLlmnopqrstuvwxyzAUjklmnopqrstuvwdefghijklmnopqrstuvwxyzA = _lmTUVWXyzABCDnopqrstuvwxyzABCDEFGHIJKLMNOPQwxyzAByzABCDEFGHIJKLMNOPDEFGHIJKLMNOPQRSTUVWXYZ(_bcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWcdefghijklmnbcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMstughijklmnopqrstu)
load(_hijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYDEFGHIJKLlmnopqrstuvwxyzAUjklmnopqrstuvwdefghijklmnopqrstuvwxyzA)()
